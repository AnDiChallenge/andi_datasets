<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.1.251">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>andi_datasets - utils_challenge</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1.6em;
  vertical-align: middle;
}
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" integrity="sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" crossorigin="anonymous"></script>
<script type="application/javascript">define('jquery', [],function() {return window.jQuery;})</script>
<script src="https://unpkg.com/@jupyter-widgets/html-manager@*/dist/embed-amd.js" crossorigin="anonymous"></script>

  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<link rel="stylesheet" href="styles.css">
<meta property="og:title" content="andi_datasets - utils_challenge">
<meta property="og:description" content="Here we treat the labels extracted from models_phenom such as to have smoother ones. For instance, we will define a minimum segment length.">
<meta property="og:site-name" content="andi_datasets">
<meta name="twitter:title" content="andi_datasets - utils_challenge">
<meta name="twitter:description" content="Here we treat the labels extracted from models_phenom such as to have smoother ones. For instance, we will define a minimum segment length.">
<meta name="twitter:card" content="summary">
</head>

<body class="nav-sidebar floating nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a class="navbar-brand" href="./index.html">
    <span class="navbar-title">andi_datasets</span>
    </a>
  </div>
          <div id="quarto-search" class="" title="Search"></div>
      </div> <!-- /container-fluid -->
    </nav>
  <nav class="quarto-secondary-nav" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
    <div class="container-fluid d-flex justify-content-between">
      <h1 class="quarto-secondary-nav-title">utils_challenge</h1>
      <button type="button" class="quarto-btn-toggle btn" aria-label="Show secondary navigation">
        <i class="bi bi-chevron-right"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse sidebar-navigation floating overflow-auto">
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./analysis.html" class="sidebar-item-text sidebar-link">analysis</a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./datasets_challenge.html" class="sidebar-item-text sidebar-link">datasets_challenge</a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./datasets_phenom.html" class="sidebar-item-text sidebar-link">datasets_phenom</a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./datasets_theory.html" class="sidebar-item-text sidebar-link">Generate datasets of theoretical models</a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./models_phenom.html" class="sidebar-item-text sidebar-link">models_phenom</a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./models_theory.html" class="sidebar-item-text sidebar-link">models_theory</a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./utils_challenge.html" class="sidebar-item-text sidebar-link active">utils_challenge</a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./utils_trajectories.html" class="sidebar-item-text sidebar-link">utils_trajectories</a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./utils_videos.html" class="sidebar-item-text sidebar-link">utils_videos</a>
  </div>
</li>
    </ul>
    </div>
</nav>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#filtering-labels" id="toc-filtering-labels" class="nav-link active" data-scroll-target="#filtering-labels">Filtering labels</a>
  <ul class="collapse">
  <li><a href="#label_filter" id="toc-label_filter" class="nav-link" data-scroll-target="#label_filter">label_filter</a></li>
  <li><a href="#majority_filter" id="toc-majority_filter" class="nav-link" data-scroll-target="#majority_filter">majority_filter</a></li>
  <li><a href="#calculating-new-transition-rates-after-filtering" id="toc-calculating-new-transition-rates-after-filtering" class="nav-link" data-scroll-target="#calculating-new-transition-rates-after-filtering">Calculating new transition rates after filtering</a></li>
  <li><a href="#from-step-wise-labels-to-list-of-properties" id="toc-from-step-wise-labels-to-list-of-properties" class="nav-link" data-scroll-target="#from-step-wise-labels-to-list-of-properties">From step-wise labels to list of properties</a>
  <ul class="collapse">
  <li><a href="#stepwise_to_list" id="toc-stepwise_to_list" class="nav-link" data-scroll-target="#stepwise_to_list">stepwise_to_list</a></li>
  </ul></li>
  </ul></li>
  <li><a href="#continuous-labels-to-list-of-features" id="toc-continuous-labels-to-list-of-features" class="nav-link" data-scroll-target="#continuous-labels-to-list-of-features">Continuous labels to list of features</a>
  <ul class="collapse">
  <li><a href="#continuous_label_to_list" id="toc-continuous_label_to_list" class="nav-link" data-scroll-target="#continuous_label_to_list"><code>continuous_label_to_list</code></a></li>
  <li><a href="#continuous_label_to_list-1" id="toc-continuous_label_to_list-1" class="nav-link" data-scroll-target="#continuous_label_to_list-1">continuous_label_to_list</a></li>
  </ul></li>
  <li><a href="#list-of-features-to-continuous-labels" id="toc-list-of-features-to-continuous-labels" class="nav-link" data-scroll-target="#list-of-features-to-continuous-labels">List of features to continuous labels</a>
  <ul class="collapse">
  <li><a href="#list_to_continuous" id="toc-list_to_continuous" class="nav-link" data-scroll-target="#list_to_continuous">list_to_continuous</a></li>
  </ul></li>
  <li><a href="#storing-data-in-dataframe" id="toc-storing-data-in-dataframe" class="nav-link" data-scroll-target="#storing-data-in-dataframe">Storing data in DataFrame</a>
  <ul class="collapse">
  <li><a href="#data_to_df" id="toc-data_to_df" class="nav-link" data-scroll-target="#data_to_df"><code>data_to_df</code></a></li>
  <li><a href="#data_to_df-1" id="toc-data_to_df-1" class="nav-link" data-scroll-target="#data_to_df-1">data_to_df</a></li>
  </ul></li>
  <li><a href="#transform-dataframe-to-array-with-padding" id="toc-transform-dataframe-to-array-with-padding" class="nav-link" data-scroll-target="#transform-dataframe-to-array-with-padding">Transform dataframe to array with padding</a>
  <ul class="collapse">
  <li><a href="#df_to_array" id="toc-df_to_array" class="nav-link" data-scroll-target="#df_to_array">df_to_array</a></li>
  </ul></li>
  <li><a href="#get_vip" id="toc-get_vip" class="nav-link" data-scroll-target="#get_vip"><code>get_VIP</code></a>
  <ul class="collapse">
  <li><a href="#get_vip-1" id="toc-get_vip-1" class="nav-link" data-scroll-target="#get_vip-1">get_VIP</a></li>
  </ul></li>
  <li><a href="#challenge-2022-metrics" id="toc-challenge-2022-metrics" class="nav-link" data-scroll-target="#challenge-2022-metrics">Challenge 2022 metrics</a>
  <ul class="collapse">
  <li><a href="#changepoint-pairing" id="toc-changepoint-pairing" class="nav-link" data-scroll-target="#changepoint-pairing">Changepoint pairing</a>
  <ul class="collapse">
  <li><a href="#changepoint_assignment-1" id="toc-changepoint_assignment-1" class="nav-link" data-scroll-target="#changepoint_assignment-1">changepoint_assignment</a></li>
  <li><a href="#changepoint_alpha_beta-1" id="toc-changepoint_alpha_beta-1" class="nav-link" data-scroll-target="#changepoint_alpha_beta-1">changepoint_alpha_beta</a></li>
  <li><a href="#jaccard_index-1" id="toc-jaccard_index-1" class="nav-link" data-scroll-target="#jaccard_index-1">jaccard_index</a></li>
  <li><a href="#ensemble_changepoint_error-1" id="toc-ensemble_changepoint_error-1" class="nav-link" data-scroll-target="#ensemble_changepoint_error-1">ensemble_changepoint_error</a></li>
  <li><a href="#changepoint_error" id="toc-changepoint_error" class="nav-link" data-scroll-target="#changepoint_error">changepoint_error</a></li>
  </ul></li>
  <li><a href="#segments-pairing" id="toc-segments-pairing" class="nav-link" data-scroll-target="#segments-pairing">Segments pairing</a>
  <ul class="collapse">
  <li><a href="#segment_distance-1" id="toc-segment_distance-1" class="nav-link" data-scroll-target="#segment_distance-1">segment_distance</a></li>
  <li><a href="#create_binary_segment-1" id="toc-create_binary_segment-1" class="nav-link" data-scroll-target="#create_binary_segment-1">create_binary_segment</a></li>
  <li><a href="#jaccard_between_segments-1" id="toc-jaccard_between_segments-1" class="nav-link" data-scroll-target="#jaccard_between_segments-1">jaccard_between_segments</a></li>
  <li><a href="#segment_assignment-1" id="toc-segment_assignment-1" class="nav-link" data-scroll-target="#segment_assignment-1">segment_assignment</a></li>
  </ul></li>
  <li><a href="#segment-properties-comparison" id="toc-segment-properties-comparison" class="nav-link" data-scroll-target="#segment-properties-comparison">Segment properties comparison</a>
  <ul class="collapse">
  <li><a href="#metric_diffusive_state" id="toc-metric_diffusive_state" class="nav-link" data-scroll-target="#metric_diffusive_state">metric_diffusive_state</a></li>
  <li><a href="#metric_diffusion_coefficient" id="toc-metric_diffusion_coefficient" class="nav-link" data-scroll-target="#metric_diffusion_coefficient">metric_diffusion_coefficient</a></li>
  <li><a href="#metric_anomalous_exponent" id="toc-metric_anomalous_exponent" class="nav-link" data-scroll-target="#metric_anomalous_exponent">metric_anomalous_exponent</a></li>
  <li><a href="#check_no_changepoints-1" id="toc-check_no_changepoints-1" class="nav-link" data-scroll-target="#check_no_changepoints-1">check_no_changepoints</a></li>
  <li><a href="#segment_property_errors-1" id="toc-segment_property_errors-1" class="nav-link" data-scroll-target="#segment_property_errors-1">segment_property_errors</a></li>
  </ul></li>
  <li><a href="#ensemble-metrics" id="toc-ensemble-metrics" class="nav-link" data-scroll-target="#ensemble-metrics">Ensemble metrics</a>
  <ul class="collapse">
  <li><a href="#extract_ensemble" id="toc-extract_ensemble" class="nav-link" data-scroll-target="#extract_ensemble"><code>extract_ensemble</code></a></li>
  <li><a href="#extract_ensemble-1" id="toc-extract_ensemble-1" class="nav-link" data-scroll-target="#extract_ensemble-1">extract_ensemble</a></li>
  <li><a href="#generating-multimodal-from-mean-and-variance" id="toc-generating-multimodal-from-mean-and-variance" class="nav-link" data-scroll-target="#generating-multimodal-from-mean-and-variance">Generating multimodal from mean and variance</a></li>
  <li><a href="#multimode_dist" id="toc-multimode_dist" class="nav-link" data-scroll-target="#multimode_dist">multimode_dist</a></li>
  <li><a href="#distance-between-distributions" id="toc-distance-between-distributions" class="nav-link" data-scroll-target="#distance-between-distributions">Distance between distributions</a></li>
  <li><a href="#distribution_distance" id="toc-distribution_distance" class="nav-link" data-scroll-target="#distribution_distance">distribution_distance</a></li>
  <li><a href="#calculate-ensemble-metric" id="toc-calculate-ensemble-metric" class="nav-link" data-scroll-target="#calculate-ensemble-metric">Calculate ensemble metric</a></li>
  <li><a href="#error_ensemble_dataset" id="toc-error_ensemble_dataset" class="nav-link" data-scroll-target="#error_ensemble_dataset">error_Ensemble_dataset</a></li>
  </ul></li>
  <li><a href="#reading-participants-predictions" id="toc-reading-participants-predictions" class="nav-link" data-scroll-target="#reading-participants-predictions">Reading participants predictions</a>
  <ul class="collapse">
  <li><a href="#check_prediction_length-1" id="toc-check_prediction_length-1" class="nav-link" data-scroll-target="#check_prediction_length-1">check_prediction_length</a></li>
  <li><a href="#separate_prediction_values-1" id="toc-separate_prediction_values-1" class="nav-link" data-scroll-target="#separate_prediction_values-1">separate_prediction_values</a></li>
  <li><a href="#load_file_to_df-1" id="toc-load_file_to_df-1" class="nav-link" data-scroll-target="#load_file_to_df-1">load_file_to_df</a></li>
  <li><a href="#error_singletraj_dataset-1" id="toc-error_singletraj_dataset-1" class="nav-link" data-scroll-target="#error_singletraj_dataset-1">error_SingleTraj_dataset</a></li>
  </ul></li>
  </ul></li>
  <li><a href="#codalab-scoring-program" id="toc-codalab-scoring-program" class="nav-link" data-scroll-target="#codalab-scoring-program">Codalab scoring program</a>
  <ul class="collapse">
  <li><a href="#listdir_nohidden" id="toc-listdir_nohidden" class="nav-link" data-scroll-target="#listdir_nohidden">listdir_nohidden</a></li>
  <li><a href="#codalab_scoring" id="toc-codalab_scoring" class="nav-link" data-scroll-target="#codalab_scoring">codalab_scoring</a></li>
  </ul></li>
  <li><a href="#nbdev-export" id="toc-nbdev-export" class="nav-link" data-scroll-target="#nbdev-export">NBDEV Export</a></li>
  </ul>
<div class="toc-actions"><div><i class="bi bi-github"></i></div><div class="action-links"><p><a href="https://github.com/AnDiChallenge/andi_datasets/issues/new" class="toc-action">Report an issue</a></p></div></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title d-none d-lg-block">utils_challenge</h1>
</div>



<div class="quarto-title-meta">

    
    
  </div>
  

</header>

<!-- WARNING: THIS FILE WAS AUTOGENERATED! DO NOT EDIT! -->
<section id="filtering-labels" class="level1">
<h1>Filtering labels</h1>
<p>Here we treat the labels extracted from <code>models_phenom</code> such as to have smoother ones. For instance, we will define a minimum segment length.</p>
<hr>
<section id="label_filter" class="level3">
<h3 class="anchored" data-anchor-id="label_filter">label_filter</h3>
<blockquote class="blockquote">
<pre><code> label_filter (label, window_size=5, min_seg=3)</code></pre>
</blockquote>
<hr>
</section>
<section id="majority_filter" class="level3">
<h3 class="anchored" data-anchor-id="majority_filter">majority_filter</h3>
<blockquote class="blockquote">
<pre><code> majority_filter (seq, width)</code></pre>
</blockquote>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>fig, axs <span class="op">=</span> plt.subplots(<span class="dv">10</span>, <span class="dv">1</span>, figsize <span class="op">=</span> (<span class="dv">20</span>, <span class="dv">20</span>))</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>window_size <span class="op">=</span> <span class="dv">5</span></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> ax <span class="kw">in</span> axs:    </span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>    traj, labs <span class="op">=</span> models_phenom()._multiple_state_traj(alphas <span class="op">=</span> [<span class="fl">0.7</span>, <span class="fl">0.8</span>], Ds <span class="op">=</span> [<span class="fl">0.01</span>, <span class="fl">0.1</span>])</span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>    filtered_d <span class="op">=</span> label_filter(labs[:,<span class="dv">1</span>])</span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>    filtered_a <span class="op">=</span> label_filter(labs[:,<span class="dv">0</span>])</span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a>    ax.plot(labs[:, <span class="dv">1</span>], <span class="st">'o'</span>, label <span class="op">=</span> <span class="st">'True label'</span>)</span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a>    ax.plot(filtered_d, label <span class="op">=</span> <span class="vs">r'$D$'</span>)</span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a>    ax.plot(filtered_a, label <span class="op">=</span> <span class="vs">r'$\alpha$'</span>)</span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a>axs[<span class="dv">0</span>].set_title(<span class="ss">f'Majority filter with window size = </span><span class="sc">{</span>window_size<span class="sc">}</span><span class="ss">'</span>)</span>
<span id="cb3-14"><a href="#cb3-14" aria-hidden="true" tabindex="-1"></a>axs[<span class="dv">0</span>].legend()</span>
<span id="cb3-15"><a href="#cb3-15" aria-hidden="true" tabindex="-1"></a>plt.setp(axs, xticklabels <span class="op">=</span> [])<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="utils_challenge_files/figure-html/cell-4-output-1.png" class="img-fluid"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>fig, axs <span class="op">=</span> plt.subplots(<span class="dv">10</span>, <span class="dv">1</span>, figsize <span class="op">=</span> (<span class="dv">20</span>, <span class="dv">20</span>))</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>filt_size <span class="op">=</span> <span class="dv">5</span></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>M <span class="op">=</span> [[<span class="fl">0.8</span>, <span class="fl">0.1</span>, <span class="fl">0.1</span>],[<span class="fl">0.05</span>, <span class="fl">0.9</span>, <span class="fl">0.05</span>], [<span class="fl">0.05</span>, <span class="fl">0.05</span>, <span class="fl">0.9</span>]]</span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>alphas <span class="op">=</span> [<span class="fl">0.7</span>, <span class="dv">1</span>, <span class="fl">1.2</span>]</span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>Ds <span class="op">=</span> [<span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">2</span>]</span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> ax <span class="kw">in</span> axs:    </span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a>    traj, labs <span class="op">=</span> models_phenom._multiple_state_traj(alphas <span class="op">=</span> alphas, Ds <span class="op">=</span> Ds, M <span class="op">=</span> M)</span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a>    filtered <span class="op">=</span> label_filter(labs[:,<span class="dv">1</span>], window_size<span class="op">=</span>filt_size)</span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a>    ax.plot(labs[:, <span class="dv">1</span>], <span class="st">'o'</span>, label <span class="op">=</span> <span class="st">'True label'</span>)</span>
<span id="cb4-13"><a href="#cb4-13" aria-hidden="true" tabindex="-1"></a>    ax.plot(filtered, <span class="st">'o-'</span>, ms <span class="op">=</span> <span class="dv">2</span>, label <span class="op">=</span> <span class="ss">f'median filter with window size = </span><span class="sc">{</span>filt_size<span class="sc">}</span><span class="ss">'</span>, lw <span class="op">=</span> <span class="dv">2</span>)</span>
<span id="cb4-14"><a href="#cb4-14" aria-hidden="true" tabindex="-1"></a>axs[<span class="dv">0</span>].legend()</span>
<span id="cb4-15"><a href="#cb4-15" aria-hidden="true" tabindex="-1"></a>plt.setp(axs, xticklabels <span class="op">=</span> [])<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="utils_challenge_files/figure-html/cell-5-output-1.png" class="img-fluid"></p>
</div>
</div>
</section>
<section id="calculating-new-transition-rates-after-filtering" class="level2">
<h2 class="anchored" data-anchor-id="calculating-new-transition-rates-after-filtering">Calculating new transition rates after filtering</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>T <span class="op">=</span> <span class="dv">1000</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>traj, labs <span class="op">=</span> models_phenom().multi_state(N <span class="op">=</span> <span class="dv">500</span>, alphas <span class="op">=</span> [<span class="fl">0.7</span>, <span class="dv">1</span>], Ds <span class="op">=</span> [<span class="dv">0</span>, <span class="dv">1</span>], T <span class="op">=</span> T)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-error">
<pre><code>NameError: name 'label' is not defined</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>res_t <span class="op">=</span> np.array([])</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>res_ft <span class="op">=</span> np.array([])</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> label <span class="kw">in</span> tqdm(labs.transpose(<span class="dv">1</span>,<span class="dv">0</span>,<span class="dv">2</span>)[:,:,<span class="dv">0</span>]):</span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>    <span class="co"># raw labels</span></span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>    CP <span class="op">=</span> np.argwhere(label[<span class="dv">1</span>:] <span class="op">!=</span> label[:<span class="op">-</span><span class="dv">1</span>]).flatten()</span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> CP[<span class="op">-</span><span class="dv">1</span>] <span class="op">!=</span> <span class="dv">199</span>: CP <span class="op">=</span> np.append(CP, T<span class="op">-</span><span class="dv">1</span>)</span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a>    CP <span class="op">=</span> np.append(<span class="dv">0</span>, CP)</span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a>    res_t <span class="op">=</span> np.append(res_t, CP[<span class="dv">1</span>:] <span class="op">-</span> CP[:<span class="op">-</span><span class="dv">1</span>])</span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb7-12"><a href="#cb7-12" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb7-13"><a href="#cb7-13" aria-hidden="true" tabindex="-1"></a>    <span class="co"># filtered labels</span></span>
<span id="cb7-14"><a href="#cb7-14" aria-hidden="true" tabindex="-1"></a>    filt <span class="op">=</span> label_filter(label)</span>
<span id="cb7-15"><a href="#cb7-15" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb7-16"><a href="#cb7-16" aria-hidden="true" tabindex="-1"></a>    CP_f <span class="op">=</span> np.argwhere(filt[<span class="dv">1</span>:] <span class="op">!=</span> filt[:<span class="op">-</span><span class="dv">1</span>]).flatten()</span>
<span id="cb7-17"><a href="#cb7-17" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> CP_f[<span class="op">-</span><span class="dv">1</span>] <span class="op">!=</span> <span class="dv">199</span>: CP_f <span class="op">=</span> np.append(CP_f, T<span class="op">-</span><span class="dv">1</span>)</span>
<span id="cb7-18"><a href="#cb7-18" aria-hidden="true" tabindex="-1"></a>    CP_f <span class="op">=</span> np.append(<span class="dv">0</span>, CP_f)</span>
<span id="cb7-19"><a href="#cb7-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-20"><a href="#cb7-20" aria-hidden="true" tabindex="-1"></a>    res_ft <span class="op">=</span> np.append(res_ft, CP_f[<span class="dv">1</span>:] <span class="op">-</span> CP_f[:<span class="op">-</span><span class="dv">1</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"cdd62df619124cca8bc13287a4eb957c","version_major":2,"version_minor":0}
</script>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f' True transition rate: </span><span class="sc">{</span><span class="dv">1</span><span class="op">/</span>np<span class="sc">.</span>mean(res_t)<span class="sc">}</span><span class="ch">\n</span><span class="ss">'</span>,</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>      <span class="ss">f'Filtered transition rate: </span><span class="sc">{</span><span class="dv">1</span><span class="op">/</span>np<span class="sc">.</span>mean(res_ft)<span class="sc">}</span><span class="ch">\n</span><span class="ss">'</span>,</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>      <span class="ss">f'True rate x 2/3: </span><span class="sc">{</span><span class="dv">1</span><span class="op">/</span>np<span class="sc">.</span>mean(res_t)<span class="op">*</span>(<span class="dv">2</span><span class="op">/</span><span class="dv">3</span>)<span class="sc">}</span><span class="ss">'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> True transition rate: 0.10091711711711712
 Filtered transition rate: 0.06881721721721722
 True rate x 2/3: 0.06727807807807808</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span><span class="op">/</span><span class="fl">0.10091711711711712</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>9.909121748290453</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span><span class="op">/</span><span class="fl">0.06881721721721722</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>14.5312472726638</code></pre>
</div>
</div>
</section>
<section id="from-step-wise-labels-to-list-of-properties" class="level2">
<h2 class="anchored" data-anchor-id="from-step-wise-labels-to-list-of-properties">From step-wise labels to list of properties</h2>
<hr>
<section id="stepwise_to_list" class="level3">
<h3 class="anchored" data-anchor-id="stepwise_to_list">stepwise_to_list</h3>
<blockquote class="blockquote">
<pre><code> stepwise_to_list (labels)</code></pre>
</blockquote>
<div class="cell">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>traj, labs <span class="op">=</span> models_phenom._multiple_state_traj(alphas <span class="op">=</span> [<span class="fl">0.7</span>, <span class="dv">1</span>], Ds <span class="op">=</span> [<span class="dv">0</span>, <span class="dv">1</span>])</span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>filt_alpha <span class="op">=</span> label_filter(labs[:,<span class="dv">0</span>])</span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>filt_D <span class="op">=</span> label_filter(labs[:,<span class="dv">1</span>])</span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a>CP, Ds, alphas <span class="op">=</span> stepwise_to_list(np.vstack((filt_alpha, filt_D)).transpose())</span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots(figsize <span class="op">=</span> (<span class="dv">20</span>, <span class="dv">3</span>))</span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a>ax.plot(filt_alpha, zorder <span class="op">=</span> <span class="op">-</span><span class="dv">1</span>)</span>
<span id="cb15-10"><a href="#cb15-10" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> idx, cp <span class="kw">in</span> <span class="bu">enumerate</span>(CP): </span>
<span id="cb15-11"><a href="#cb15-11" aria-hidden="true" tabindex="-1"></a>    ax.axvline(cp, c <span class="op">=</span> <span class="st">'k'</span>, ls <span class="op">=</span> <span class="st">'--'</span>, alpha <span class="op">=</span> <span class="fl">0.8</span>, zorder <span class="op">=</span> <span class="op">-</span><span class="dv">1</span>)</span>
<span id="cb15-12"><a href="#cb15-12" aria-hidden="true" tabindex="-1"></a>    plt.scatter(cp, alphas[idx<span class="op">+</span><span class="dv">1</span>], c <span class="op">=</span> <span class="st">'C1'</span>, zorder <span class="op">=</span> <span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="utils_challenge_files/figure-html/cell-12-output-1.png" class="img-fluid"></p>
</div>
</div>
</section>
</section>
</section>
<section id="continuous-labels-to-list-of-features" class="level1">
<h1>Continuous labels to list of features</h1>
<p>The labels in the challenge will be the list of <span class="math inline">\(n\)</span> changepoints as well as the <span class="math inline">\(n+1\)</span> diffusion properties (<span class="math inline">\(D\)</span> and <span class="math inline">\(\alpha\)</span>) for each segment. This function transforms the stepwise labels into three lists: CPs, <span class="math inline">\(\alpha\)</span>s and <span class="math inline">\(D\)</span>s.</p>
<section id="continuous_label_to_list" class="level3">
<h3 class="anchored" data-anchor-id="continuous_label_to_list"><code>continuous_label_to_list</code></h3>
<hr>
</section>
<section id="continuous_label_to_list-1" class="level3">
<h3 class="anchored" data-anchor-id="continuous_label_to_list-1">continuous_label_to_list</h3>
<blockquote class="blockquote">
<pre><code> continuous_label_to_list (labs)</code></pre>
</blockquote>
<p>Given an array of T x 2 labels containing the anomalous exponent and diffusion coefficient at each timestep, returns 3 arrays, each containing the changepoints, exponents and coefficient, respectively. If labs is size T x 3, then we consider that diffusive states are given and also return those.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>T <span class="op">=</span> <span class="dv">50</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>trajs, labels <span class="op">=</span> models_phenom().multi_state(N <span class="op">=</span> <span class="dv">1</span>, T <span class="op">=</span> T)</span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>CP, alphas, Ds, _ <span class="op">=</span> continuous_label_to_list(labels[:,<span class="op">-</span><span class="dv">1</span>,:])</span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a>plt.plot(labels[:, <span class="op">-</span><span class="dv">1</span>, <span class="dv">1</span>], <span class="st">'o'</span>, alpha <span class="op">=</span> <span class="fl">0.4</span>, label <span class="op">=</span> <span class="st">'Continuous label'</span>)</span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a>plt.scatter(CP<span class="op">-</span><span class="dv">1</span>, Ds, c <span class="op">=</span> <span class="st">'C1'</span>, label <span class="op">=</span> <span class="st">'CP-1 and value of previous segment'</span>)</span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a>plt.legend()<span class="op">;</span> plt.xlabel(<span class="st">'T'</span>)<span class="op">;</span> plt.ylabel(<span class="vs">r'$\alpha$'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>Text(0, 0.5, '$\\alpha$')</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="utils_challenge_files/figure-html/cell-14-output-2.png" class="img-fluid"></p>
</div>
</div>
</section>
</section>
<section id="list-of-features-to-continuous-labels" class="level1">
<h1>List of features to continuous labels</h1>
<p>This function does the opposite from the previous. From a list of properties as the one used in ANDI 2022, creates continuous labels</p>
<hr>
<section id="list_to_continuous" class="level3">
<h3 class="anchored" data-anchor-id="list_to_continuous">list_to_continuous</h3>
<blockquote class="blockquote">
<pre><code> list_to_continuous (CP, label)</code></pre>
</blockquote>
<div class="cell">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>CP <span class="op">=</span> [<span class="dv">3</span>,<span class="dv">24</span>,<span class="dv">34</span>]</span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>label <span class="op">=</span> [<span class="fl">0.5</span>, <span class="fl">0.4</span>, <span class="dv">1</span>]</span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>cont <span class="op">=</span> list_to_continuous(CP, label)</span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a>plt.plot(cont)</span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a>[plt.axvline(c, c <span class="op">=</span> <span class="st">'k'</span>, ls <span class="op">=</span> <span class="st">'--'</span>, alpha <span class="op">=</span> <span class="fl">0.3</span>) <span class="cf">for</span> c <span class="kw">in</span> CP[:<span class="op">-</span><span class="dv">1</span>]]<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="utils_challenge_files/figure-html/cell-16-output-1.png" class="img-fluid"></p>
</div>
</div>
</section>
</section>
<section id="storing-data-in-dataframe" class="level1">
<h1>Storing data in DataFrame</h1>
<section id="data_to_df" class="level3">
<h3 class="anchored" data-anchor-id="data_to_df"><code>data_to_df</code></h3>
<hr>
</section>
<section id="data_to_df-1" class="level3">
<h3 class="anchored" data-anchor-id="data_to_df-1">data_to_df</h3>
<blockquote class="blockquote">
<pre><code> data_to_df (trajs, labels, label_values, diff_states, min_length=10,
             fov_origin=[0, 0], fov_length=100, cutoff_length=10)</code></pre>
</blockquote>
<p>Inputs: :trajs (dimension: T x N x2): :labels (dimension: T x N x 2): :label_values (array) (size: # of states): values of any property for every existing state. :diff_states (array) (size: # of states): labels correspoding to each state as defined in the ANDI 2022 state labels: 0: immobile; 1: confined; 2: free diffusion; 3: directed.</p>
<p>Outputs: :df_in (dataframe): dataframe with trajectories :df_out (datafram): datafram with label and information</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="co">#trajs, labels = models_phenom().multi_state(T = 200, N = 10, alphas=[0.5, 1], Ds = [1,1], L = 100)</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>trajs, labels <span class="op">=</span> models_phenom().single_state(T <span class="op">=</span> <span class="dv">200</span>, N <span class="op">=</span> <span class="dv">10</span>)</span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a>trajs <span class="op">=</span> trajs.transpose((<span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">2</span>)).copy()</span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a>labels <span class="op">=</span> labels.transpose(<span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>df_in, df_out <span class="op">=</span> data_to_df(trajs, labels, label_values<span class="op">=</span>[<span class="fl">0.5</span>, <span class="dv">1</span>], diff_states<span class="op">=</span>[<span class="dv">3</span>, <span class="dv">2</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"7e33bd68f62a43a083b295362c045299","version_major":2,"version_minor":0}
</script>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>df_out</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th>traj_idx</th>
      <th>Ds</th>
      <th>alphas</th>
      <th>states</th>
      <th>changepoints</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>0</td>
      <td>[1.0]</td>
      <td>[1.0]</td>
      <td>[2.0]</td>
      <td>[12]</td>
    </tr>
    <tr>
      <th>1</th>
      <td>1</td>
      <td>[1.0]</td>
      <td>[1.0]</td>
      <td>[2.0]</td>
      <td>[29]</td>
    </tr>
    <tr>
      <th>2</th>
      <td>2</td>
      <td>[1.0]</td>
      <td>[1.0]</td>
      <td>[2.0]</td>
      <td>[37]</td>
    </tr>
    <tr>
      <th>3</th>
      <td>3</td>
      <td>[1.0]</td>
      <td>[1.0]</td>
      <td>[2.0]</td>
      <td>[16]</td>
    </tr>
    <tr>
      <th>4</th>
      <td>4</td>
      <td>[1.0]</td>
      <td>[1.0]</td>
      <td>[2.0]</td>
      <td>[33]</td>
    </tr>
    <tr>
      <th>5</th>
      <td>5</td>
      <td>[1.0]</td>
      <td>[1.0]</td>
      <td>[2.0]</td>
      <td>[92]</td>
    </tr>
    <tr>
      <th>6</th>
      <td>6</td>
      <td>[1.0]</td>
      <td>[1.0]</td>
      <td>[2.0]</td>
      <td>[79]</td>
    </tr>
    <tr>
      <th>7</th>
      <td>7</td>
      <td>[1.0]</td>
      <td>[1.0]</td>
      <td>[2.0]</td>
      <td>[15]</td>
    </tr>
    <tr>
      <th>8</th>
      <td>8</td>
      <td>[1.0]</td>
      <td>[1.0]</td>
      <td>[2.0]</td>
      <td>[37]</td>
    </tr>
  </tbody>
</table>
</div>
</div>
</div>
</section>
</section>
<section id="transform-dataframe-to-array-with-padding" class="level1">
<h1>Transform dataframe to array with padding</h1>
<hr>
<section id="df_to_array" class="level3">
<h3 class="anchored" data-anchor-id="df_to_array">df_to_array</h3>
<blockquote class="blockquote">
<pre><code> df_to_array (df, pad=-1)</code></pre>
</blockquote>
<p>Transform a dataframe as the ones given in the ANDI challenge 2 (i.e.&nbsp;4 columns: traj_idx, frame, x, y) into a numpy array. To deal with irregular temporal supports, we pad the array whenever the trajectory is not present. The output array has the typical shape of ANDI datasets: TxNx2</p>
</section>
</section>
<section id="get_vip" class="level1">
<h1><code>get_VIP</code></h1>
<hr>
<section id="get_vip-1" class="level3">
<h3 class="anchored" data-anchor-id="get_vip-1">get_VIP</h3>
<blockquote class="blockquote">
<pre><code> get_VIP (array_trajs, num_vip=5, min_distance=2, pad=-1)</code></pre>
</blockquote>
<p>Given an array of trajectories, finds the particles that have exists at frame 0 (i.e.&nbsp;that their first value is different from pad). Then, iterates over this particles to find num_vip that are at distance &gt; than min_distance in the first frame.</p>
</section>
</section>
<section id="challenge-2022-metrics" class="level1">
<h1>Challenge 2022 metrics</h1>
<section id="changepoint-pairing" class="level2">
<h2 class="anchored" data-anchor-id="changepoint-pairing">Changepoint pairing</h2>
<p>We use an assignment algorithm to pair predicted and groundtruth changepoints. From there, we will calculate the various metrics of the challenge.</p>
<section id="changepoint_assignment" class="level4">
<h4 class="anchored" data-anchor-id="changepoint_assignment"><code>changepoint_assignment</code></h4>
<hr>
</section>
<section id="changepoint_assignment-1" class="level3">
<h3 class="anchored" data-anchor-id="changepoint_assignment-1">changepoint_assignment</h3>
<blockquote class="blockquote">
<pre><code> changepoint_assignment (GT, preds)</code></pre>
</blockquote>
<p>Given a list of groundtruth and predicted changepoints, solves the assignment problem via the Munkres algorithm (aka Hungarian algorithm) and returns two arrays containing the index of the paired groundtruth and predicted changepoints, respectively.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a>ngts <span class="op">=</span> <span class="dv">10</span><span class="op">;</span> npreds <span class="op">=</span> <span class="dv">6</span><span class="op">;</span> T <span class="op">=</span> <span class="dv">100</span></span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a>GT <span class="op">=</span> np.sort(np.random.choice(np.arange(<span class="dv">1</span>,T), ngts, replace <span class="op">=</span> <span class="va">False</span>))</span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a>preds <span class="op">=</span> np.sort(np.random.choice(np.arange(<span class="dv">1</span>,T)<span class="op">*</span><span class="fl">0.5</span>, npreds, replace <span class="op">=</span> <span class="va">False</span>))</span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a>assig <span class="op">=</span> changepoint_assignment(GT, preds)[<span class="dv">0</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a>GT[assig[<span class="dv">0</span>]]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>array([ 7, 13, 24, 30, 48, 55])</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a>preds[assig[<span class="dv">1</span>]]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>array([ 2.5,  5. ,  8. , 11.5, 30. , 34.5])</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a>changepoint_assignment(GT, preds)[<span class="dv">0</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>(array([4, 5, 6, 7, 8, 9], dtype=int64),
 array([5, 0, 1, 2, 4, 3], dtype=int64))</code></pre>
</div>
</div>
<section id="changepoint_alpha_beta" class="level4">
<h4 class="anchored" data-anchor-id="changepoint_alpha_beta"><code>changepoint_alpha_beta</code></h4>
<hr>
</section>
</section>
<section id="changepoint_alpha_beta-1" class="level3">
<h3 class="anchored" data-anchor-id="changepoint_alpha_beta-1">changepoint_alpha_beta</h3>
<blockquote class="blockquote">
<pre><code> changepoint_alpha_beta (GT, preds, treshold=10)</code></pre>
</blockquote>
<p>Calculate the alpha and beta measure of paired changepoints. Inspired from Supplemantary Note 3 in https://www.nature.com/articles/nmeth.2808</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a>labels <span class="op">=</span> [<span class="vs">r'Random Guess + $N_p&gt;N_</span><span class="sc">{gt}</span><span class="vs">$'</span>,</span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a>          <span class="vs">r'Random Guess + $N_p&lt;N_</span><span class="sc">{gt}</span><span class="vs">$'</span>,</span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a>          <span class="vs">r'GT + rand $\in [-3, 3]$'</span>,</span>
<span id="cb36-4"><a href="#cb36-4" aria-hidden="true" tabindex="-1"></a>          <span class="vs">r'GT + rand $\in [-1, 1]$'</span>]</span>
<span id="cb36-5"><a href="#cb36-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-6"><a href="#cb36-6" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots()</span>
<span id="cb36-7"><a href="#cb36-7" aria-hidden="true" tabindex="-1"></a>alpha <span class="op">=</span> <span class="fl">0.2</span></span>
<span id="cb36-8"><a href="#cb36-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-9"><a href="#cb36-9" aria-hidden="true" tabindex="-1"></a>T <span class="op">=</span> <span class="dv">200</span><span class="op">;</span> ngts <span class="op">=</span> <span class="dv">15</span><span class="op">;</span> </span>
<span id="cb36-10"><a href="#cb36-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-11"><a href="#cb36-11" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> case, (label, color) <span class="kw">in</span> <span class="bu">enumerate</span>(<span class="bu">zip</span>(labels, [<span class="st">'C0'</span>, <span class="st">'C1'</span>, <span class="st">'C2'</span>, <span class="st">'C3'</span>])):</span>
<span id="cb36-12"><a href="#cb36-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-13"><a href="#cb36-13" aria-hidden="true" tabindex="-1"></a>    alphas, betas <span class="op">=</span> [], []</span>
<span id="cb36-14"><a href="#cb36-14" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> _ <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">100</span>):</span>
<span id="cb36-15"><a href="#cb36-15" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb36-16"><a href="#cb36-16" aria-hidden="true" tabindex="-1"></a>        GT <span class="op">=</span> np.sort(np.random.choice(np.arange(<span class="dv">1</span>,T), ngts, replace <span class="op">=</span> <span class="va">False</span>))</span>
<span id="cb36-17"><a href="#cb36-17" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> case <span class="op">==</span> <span class="dv">0</span>:</span>
<span id="cb36-18"><a href="#cb36-18" aria-hidden="true" tabindex="-1"></a>            npreds <span class="op">=</span> np.random.randint(low <span class="op">=</span> ngts, high <span class="op">=</span> ngts<span class="op">*</span><span class="dv">2</span>)</span>
<span id="cb36-19"><a href="#cb36-19" aria-hidden="true" tabindex="-1"></a>            preds <span class="op">=</span> np.sort(np.random.choice(np.arange(<span class="dv">1</span>,T), npreds, replace <span class="op">=</span> <span class="va">False</span>)) </span>
<span id="cb36-20"><a href="#cb36-20" aria-hidden="true" tabindex="-1"></a>        <span class="cf">elif</span> case <span class="op">==</span> <span class="dv">1</span>:</span>
<span id="cb36-21"><a href="#cb36-21" aria-hidden="true" tabindex="-1"></a>            npreds <span class="op">=</span> np.random.randint(low <span class="op">=</span> <span class="dv">1</span>, high <span class="op">=</span> ngts)</span>
<span id="cb36-22"><a href="#cb36-22" aria-hidden="true" tabindex="-1"></a>            preds <span class="op">=</span> np.sort(np.random.choice(np.arange(<span class="dv">1</span>,T), npreds, replace <span class="op">=</span> <span class="va">False</span>))     </span>
<span id="cb36-23"><a href="#cb36-23" aria-hidden="true" tabindex="-1"></a>        <span class="cf">elif</span> case <span class="op">==</span> <span class="dv">2</span>:</span>
<span id="cb36-24"><a href="#cb36-24" aria-hidden="true" tabindex="-1"></a>            preds <span class="op">=</span> GT <span class="op">+</span> np.random.randint(<span class="op">-</span><span class="dv">3</span>, <span class="dv">3</span>, ngts)</span>
<span id="cb36-25"><a href="#cb36-25" aria-hidden="true" tabindex="-1"></a>        <span class="cf">elif</span> case <span class="op">==</span> <span class="dv">3</span>:</span>
<span id="cb36-26"><a href="#cb36-26" aria-hidden="true" tabindex="-1"></a>            preds <span class="op">=</span> GT <span class="op">+</span> np.random.randint(<span class="op">-</span><span class="dv">1</span>, <span class="dv">1</span>, ngts)</span>
<span id="cb36-27"><a href="#cb36-27" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb36-28"><a href="#cb36-28" aria-hidden="true" tabindex="-1"></a>        alpha, beta <span class="op">=</span> changepoint_alpha_beta(GT, preds)</span>
<span id="cb36-29"><a href="#cb36-29" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb36-30"><a href="#cb36-30" aria-hidden="true" tabindex="-1"></a>        alphas.append(alpha)</span>
<span id="cb36-31"><a href="#cb36-31" aria-hidden="true" tabindex="-1"></a>        betas.append(beta)</span>
<span id="cb36-32"><a href="#cb36-32" aria-hidden="true" tabindex="-1"></a>     </span>
<span id="cb36-33"><a href="#cb36-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-34"><a href="#cb36-34" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb36-35"><a href="#cb36-35" aria-hidden="true" tabindex="-1"></a>    ax.scatter(alphas, betas, c <span class="op">=</span> color, alpha <span class="op">=</span> alpha)</span>
<span id="cb36-36"><a href="#cb36-36" aria-hidden="true" tabindex="-1"></a>    ax.scatter(np.mean(alphas), np.mean(betas), c <span class="op">=</span> color, label <span class="op">=</span> label, s <span class="op">=</span> <span class="dv">50</span>, marker <span class="op">=</span> <span class="st">'s'</span>, edgecolors <span class="op">=</span> <span class="st">'k'</span>)</span>
<span id="cb36-37"><a href="#cb36-37" aria-hidden="true" tabindex="-1"></a>plt.setp(ax, xlabel <span class="op">=</span> <span class="vs">r'$\alpha$'</span>, ylabel <span class="op">=</span> <span class="vs">r'$\beta$'</span>)</span>
<span id="cb36-38"><a href="#cb36-38" aria-hidden="true" tabindex="-1"></a>ax.legend(loc <span class="op">=</span> (<span class="fl">0.91</span>,<span class="fl">0.4</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>&lt;matplotlib.legend.Legend&gt;</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="utils_challenge_files/figure-html/cell-29-output-2.png" class="img-fluid"></p>
</div>
</div>
<section id="jaccard_index" class="level4">
<h4 class="anchored" data-anchor-id="jaccard_index"><code>jaccard_index</code></h4>
<hr>
</section>
</section>
<section id="jaccard_index-1" class="level3">
<h3 class="anchored" data-anchor-id="jaccard_index-1">jaccard_index</h3>
<blockquote class="blockquote">
<pre><code> jaccard_index (TP, FP, FN)</code></pre>
</blockquote>
<p>Given the true positive, false positive and false negative rates, calculates the Jaccard Index</p>
<section id="ensemble_changepoint_error" class="level4">
<h4 class="anchored" data-anchor-id="ensemble_changepoint_error"><code>ensemble_changepoint_error</code></h4>
<hr>
</section>
</section>
<section id="ensemble_changepoint_error-1" class="level3">
<h3 class="anchored" data-anchor-id="ensemble_changepoint_error-1">ensemble_changepoint_error</h3>
<blockquote class="blockquote">
<pre><code> ensemble_changepoint_error (GT_ensemble, pred_ensemble, threshold=5)</code></pre>
</blockquote>
<p>Given an ensemble of groundtruth and predicted changepoints, iterates over each trajectory’s changepoints. For each, it solves the assignment problem between changepoints. Then, calculates the RMSE of the true positive pairs and the Jaccard index over the ensemble of changepoints (i.e.&nbsp;not the mean of them w.r.t. to the trajectories)</p>
<hr>
</section>
<section id="changepoint_error" class="level3">
<h3 class="anchored" data-anchor-id="changepoint_error">changepoint_error</h3>
<blockquote class="blockquote">
<pre><code> changepoint_error (GT, preds, threshold=5)</code></pre>
</blockquote>
<p>Given the groundtruth and predicted changepoints for a single trajectory, first solves the assignment problem between changepoints, then calculates the RMSE of the true positive pairs and the Jaccard index</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a>labels <span class="op">=</span> [<span class="st">'Random Guess + Incorrect number'</span>,</span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a>          <span class="vs">r'GT + rand $\in [-3, 3]$'</span>,</span>
<span id="cb41-3"><a href="#cb41-3" aria-hidden="true" tabindex="-1"></a>          <span class="vs">r'GT + rand $\in [-1, 1]$'</span>]</span>
<span id="cb41-4"><a href="#cb41-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-5"><a href="#cb41-5" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots()</span>
<span id="cb41-6"><a href="#cb41-6" aria-hidden="true" tabindex="-1"></a>alpha <span class="op">=</span> <span class="fl">0.2</span></span>
<span id="cb41-7"><a href="#cb41-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-8"><a href="#cb41-8" aria-hidden="true" tabindex="-1"></a>T <span class="op">=</span> <span class="dv">200</span><span class="op">;</span> ngts <span class="op">=</span> <span class="dv">10</span><span class="op">;</span> npreds <span class="op">=</span> <span class="dv">8</span></span>
<span id="cb41-9"><a href="#cb41-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-10"><a href="#cb41-10" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> case, (label, color) <span class="kw">in</span> <span class="bu">enumerate</span>(<span class="bu">zip</span>(labels, [<span class="st">'C0'</span>, <span class="st">'C1'</span>, <span class="st">'C2'</span>])):</span>
<span id="cb41-11"><a href="#cb41-11" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb41-12"><a href="#cb41-12" aria-hidden="true" tabindex="-1"></a>    rmse, ji <span class="op">=</span> [], []</span>
<span id="cb41-13"><a href="#cb41-13" aria-hidden="true" tabindex="-1"></a>    GT, preds <span class="op">=</span> [], []</span>
<span id="cb41-14"><a href="#cb41-14" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> _ <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">100</span>):</span>
<span id="cb41-15"><a href="#cb41-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-16"><a href="#cb41-16" aria-hidden="true" tabindex="-1"></a>        GT.append(np.sort(np.random.choice(np.arange(<span class="dv">1</span>,T), ngts, replace <span class="op">=</span> <span class="va">False</span>)))</span>
<span id="cb41-17"><a href="#cb41-17" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> case <span class="op">==</span> <span class="dv">0</span>:</span>
<span id="cb41-18"><a href="#cb41-18" aria-hidden="true" tabindex="-1"></a>            preds.append(np.sort(np.random.choice(np.arange(<span class="dv">1</span>,T), npreds, replace <span class="op">=</span> <span class="va">False</span>)))                  </span>
<span id="cb41-19"><a href="#cb41-19" aria-hidden="true" tabindex="-1"></a>        <span class="cf">elif</span> case <span class="op">==</span> <span class="dv">1</span>:</span>
<span id="cb41-20"><a href="#cb41-20" aria-hidden="true" tabindex="-1"></a>            preds.append(GT[<span class="op">-</span><span class="dv">1</span>] <span class="op">+</span> np.random.randint(<span class="op">-</span><span class="dv">3</span>, <span class="dv">3</span>, ngts))</span>
<span id="cb41-21"><a href="#cb41-21" aria-hidden="true" tabindex="-1"></a>        <span class="cf">elif</span> case <span class="op">==</span> <span class="dv">2</span>:</span>
<span id="cb41-22"><a href="#cb41-22" aria-hidden="true" tabindex="-1"></a>            preds.append(GT[<span class="op">-</span><span class="dv">1</span>] <span class="op">+</span> np.random.randint(<span class="op">-</span><span class="dv">1</span>, <span class="dv">1</span>, ngts))</span>
<span id="cb41-23"><a href="#cb41-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-24"><a href="#cb41-24" aria-hidden="true" tabindex="-1"></a>        assignment, _ <span class="op">=</span> changepoint_assignment(GT[<span class="op">-</span><span class="dv">1</span>], preds[<span class="op">-</span><span class="dv">1</span>])</span>
<span id="cb41-25"><a href="#cb41-25" aria-hidden="true" tabindex="-1"></a>        assignment <span class="op">=</span> np.array(assignment)</span>
<span id="cb41-26"><a href="#cb41-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-27"><a href="#cb41-27" aria-hidden="true" tabindex="-1"></a>        RMSE, JI <span class="op">=</span> changepoint_error(GT[<span class="op">-</span><span class="dv">1</span>], preds[<span class="op">-</span><span class="dv">1</span>], threshold <span class="op">=</span> <span class="dv">5</span>)     </span>
<span id="cb41-28"><a href="#cb41-28" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb41-29"><a href="#cb41-29" aria-hidden="true" tabindex="-1"></a>        rmse.append(RMSE)</span>
<span id="cb41-30"><a href="#cb41-30" aria-hidden="true" tabindex="-1"></a>        ji.append(JI)</span>
<span id="cb41-31"><a href="#cb41-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-32"><a href="#cb41-32" aria-hidden="true" tabindex="-1"></a>    rmse_e, ji_e <span class="op">=</span> ensemble_changepoint_error(GT, preds, threshold <span class="op">=</span> <span class="dv">5</span>)</span>
<span id="cb41-33"><a href="#cb41-33" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb41-34"><a href="#cb41-34" aria-hidden="true" tabindex="-1"></a>    ax.scatter(rmse, ji, c <span class="op">=</span> color, alpha <span class="op">=</span> alpha)</span>
<span id="cb41-35"><a href="#cb41-35" aria-hidden="true" tabindex="-1"></a>    ax.scatter(rmse_e, ji_e, c <span class="op">=</span> color, label <span class="op">=</span> label, s <span class="op">=</span> <span class="dv">50</span>, marker <span class="op">=</span> <span class="st">'s'</span>, edgecolors <span class="op">=</span> <span class="st">'k'</span>)</span>
<span id="cb41-36"><a href="#cb41-36" aria-hidden="true" tabindex="-1"></a>plt.setp(ax, xlabel <span class="op">=</span> <span class="st">'TP RMSE'</span>, ylabel <span class="op">=</span> <span class="st">'Jaccard'</span>)</span>
<span id="cb41-37"><a href="#cb41-37" aria-hidden="true" tabindex="-1"></a>ax.legend(loc <span class="op">=</span> (<span class="fl">0.91</span>,<span class="fl">0.4</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>&lt;matplotlib.legend.Legend&gt;</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="utils_challenge_files/figure-html/cell-33-output-2.png" class="img-fluid"></p>
</div>
</div>
</section>
</section>
<section id="segments-pairing" class="level2">
<h2 class="anchored" data-anchor-id="segments-pairing">Segments pairing</h2>
<p>Here we focus on pairing the segments arising from a list of changepoints. We will use this to latter compare the predicted physical properties for each segment</p>
<section id="segment_distance" class="level4">
<h4 class="anchored" data-anchor-id="segment_distance"><code>segment_distance</code></h4>
<hr>
</section>
<section id="segment_distance-1" class="level3">
<h3 class="anchored" data-anchor-id="segment_distance-1">segment_distance</h3>
<blockquote class="blockquote">
<pre><code> segment_distance (seg1, seg2, epsilon=nan)</code></pre>
</blockquote>
<section id="create_binary_segment" class="level4">
<h4 class="anchored" data-anchor-id="create_binary_segment"><code>create_binary_segment</code></h4>
<hr>
</section>
</section>
<section id="create_binary_segment-1" class="level3">
<h3 class="anchored" data-anchor-id="create_binary_segment-1">create_binary_segment</h3>
<blockquote class="blockquote">
<pre><code> create_binary_segment (CP, T)</code></pre>
</blockquote>
<p>Given a set of changepoints and the lenght of the trajectory, create segments which are equal to one if the segment takes place at that position and zero otherwise</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a>T<span class="op">=</span> <span class="dv">50</span></span>
<span id="cb45-2"><a href="#cb45-2" aria-hidden="true" tabindex="-1"></a>GT <span class="op">=</span> np.sort(np.random.choice(np.arange(<span class="dv">1</span>,T), <span class="dv">10</span>, replace <span class="op">=</span> <span class="va">False</span>))</span>
<span id="cb45-3"><a href="#cb45-3" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> x <span class="kw">in</span> create_binary_segment(GT, T):</span>
<span id="cb45-4"><a href="#cb45-4" aria-hidden="true" tabindex="-1"></a>    plt.plot(x, <span class="st">'o'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="utils_challenge_files/figure-html/cell-36-output-1.png" class="img-fluid"></p>
</div>
</div>
<section id="jaccard_between_segments" class="level4">
<h4 class="anchored" data-anchor-id="jaccard_between_segments"><code>jaccard_between_segments</code></h4>
<hr>
</section>
</section>
<section id="jaccard_between_segments-1" class="level3">
<h3 class="anchored" data-anchor-id="jaccard_between_segments-1">jaccard_between_segments</h3>
<blockquote class="blockquote">
<pre><code> jaccard_between_segments (gt, pred)</code></pre>
</blockquote>
<p>Given two segments, calculates the Jaccard index between them by considering TP as correct labeling, FN as missed events and FP leftover predictions</p>
<section id="segment_assignment" class="level4">
<h4 class="anchored" data-anchor-id="segment_assignment"><code>segment_assignment</code></h4>
<hr>
</section>
</section>
<section id="segment_assignment-1" class="level3">
<h3 class="anchored" data-anchor-id="segment_assignment-1">segment_assignment</h3>
<blockquote class="blockquote">
<pre><code> segment_assignment (GT, preds, T=None)</code></pre>
</blockquote>
<p>Given a list of groundtruth and predicted changepoints, generates a set of segments. Then constructs a cost matrix by calculting the Jaccard Index between segments. From this cost matrix, we solve the assignment problem via the Munkres algorithm (aka Hungarian algorithm) and returns two arrays containing the index of the groundtruth and predicted segments, respectively.</p>
<p>If T = None, then we consider that GT and preds may have different lenghts. In that case, the end of the segments is the the last CP of each set of CPs.</p>
<p><strong>Easy case</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a>T <span class="op">=</span> <span class="dv">200</span><span class="op">;</span> </span>
<span id="cb48-2"><a href="#cb48-2" aria-hidden="true" tabindex="-1"></a>ngts <span class="op">=</span> <span class="dv">10</span><span class="op">;</span> </span>
<span id="cb48-3"><a href="#cb48-3" aria-hidden="true" tabindex="-1"></a>GT <span class="op">=</span> np.sort(np.random.choice(np.arange(<span class="dv">1</span>,T), ngts, replace <span class="op">=</span> <span class="va">False</span>))</span>
<span id="cb48-4"><a href="#cb48-4" aria-hidden="true" tabindex="-1"></a>preds <span class="op">=</span> np.sort(GT <span class="op">+</span> np.random.randint(<span class="op">-</span><span class="dv">5</span>, <span class="dv">5</span>, <span class="dv">1</span>) )</span>
<span id="cb48-5"><a href="#cb48-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-6"><a href="#cb48-6" aria-hidden="true" tabindex="-1"></a>seg_GT <span class="op">=</span> create_binary_segment(GT, T)</span>
<span id="cb48-7"><a href="#cb48-7" aria-hidden="true" tabindex="-1"></a>seg_preds <span class="op">=</span> create_binary_segment(preds, T)   </span>
<span id="cb48-8"><a href="#cb48-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-9"><a href="#cb48-9" aria-hidden="true" tabindex="-1"></a>[row_ind, col_ind], cost_matrix <span class="op">=</span> segment_assignment(GT, preds, T)</span>
<span id="cb48-10"><a href="#cb48-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-11"><a href="#cb48-11" aria-hidden="true" tabindex="-1"></a>fig, axs <span class="op">=</span> plt.subplots(<span class="dv">2</span>, <span class="dv">5</span>, figsize <span class="op">=</span> (<span class="dv">15</span>, <span class="dv">6</span>))</span>
<span id="cb48-12"><a href="#cb48-12" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> r, c, ax <span class="kw">in</span> <span class="bu">zip</span>(row_ind, col_ind, axs.flatten()):</span>
<span id="cb48-13"><a href="#cb48-13" aria-hidden="true" tabindex="-1"></a>    ax.set_title(<span class="ss">f'1 - JI = </span><span class="sc">{</span>np<span class="sc">.</span><span class="bu">round</span>(cost_matrix[r, c], <span class="dv">2</span>)<span class="sc">}</span><span class="ss">'</span>)</span>
<span id="cb48-14"><a href="#cb48-14" aria-hidden="true" tabindex="-1"></a>    ax.plot(seg_GT[r])</span>
<span id="cb48-15"><a href="#cb48-15" aria-hidden="true" tabindex="-1"></a>    ax.plot(seg_preds[c])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="utils_challenge_files/figure-html/cell-39-output-1.png" class="img-fluid"></p>
</div>
</div>
<p>Different size pred / true</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a>T1 <span class="op">=</span> <span class="dv">200</span><span class="op">;</span> T2 <span class="op">=</span> <span class="dv">100</span></span>
<span id="cb49-2"><a href="#cb49-2" aria-hidden="true" tabindex="-1"></a>ngts <span class="op">=</span> <span class="dv">10</span><span class="op">;</span> </span>
<span id="cb49-3"><a href="#cb49-3" aria-hidden="true" tabindex="-1"></a>GT <span class="op">=</span> np.sort(np.random.choice(np.arange(<span class="dv">1</span>,T1), ngts, replace <span class="op">=</span> <span class="va">False</span>))</span>
<span id="cb49-4"><a href="#cb49-4" aria-hidden="true" tabindex="-1"></a>preds <span class="op">=</span> np.sort(np.random.choice(np.arange(<span class="dv">1</span>,T2), <span class="dv">5</span>, replace <span class="op">=</span> <span class="va">False</span>))</span>
<span id="cb49-5"><a href="#cb49-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-6"><a href="#cb49-6" aria-hidden="true" tabindex="-1"></a>seg_GT <span class="op">=</span> create_binary_segment(GT, T1)</span>
<span id="cb49-7"><a href="#cb49-7" aria-hidden="true" tabindex="-1"></a>seg_preds <span class="op">=</span> create_binary_segment(preds, T2)   </span>
<span id="cb49-8"><a href="#cb49-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-9"><a href="#cb49-9" aria-hidden="true" tabindex="-1"></a>[row_ind, col_ind], cost_matrix <span class="op">=</span> segment_assignment(GT, preds)</span>
<span id="cb49-10"><a href="#cb49-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-11"><a href="#cb49-11" aria-hidden="true" tabindex="-1"></a>fig, axs <span class="op">=</span> plt.subplots(<span class="dv">2</span>, <span class="dv">5</span>, figsize <span class="op">=</span> (<span class="dv">15</span>, <span class="dv">6</span>))</span>
<span id="cb49-12"><a href="#cb49-12" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> r, c, ax <span class="kw">in</span> <span class="bu">zip</span>(row_ind, col_ind, axs.flatten()):</span>
<span id="cb49-13"><a href="#cb49-13" aria-hidden="true" tabindex="-1"></a>    ax.set_title(<span class="ss">f'1 - JI = </span><span class="sc">{</span>np<span class="sc">.</span><span class="bu">round</span>(cost_matrix[r, c], <span class="dv">2</span>)<span class="sc">}</span><span class="ss">'</span>)</span>
<span id="cb49-14"><a href="#cb49-14" aria-hidden="true" tabindex="-1"></a>    ax.plot(seg_GT[r])</span>
<span id="cb49-15"><a href="#cb49-15" aria-hidden="true" tabindex="-1"></a>    ax.plot(seg_preds[c])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="utils_challenge_files/figure-html/cell-40-output-1.png" class="img-fluid"></p>
</div>
</div>
<p><strong>Difficult case</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a>T <span class="op">=</span> <span class="dv">200</span><span class="op">;</span></span>
<span id="cb50-2"><a href="#cb50-2" aria-hidden="true" tabindex="-1"></a>ngts <span class="op">=</span> <span class="dv">5</span><span class="op">;</span> npreds <span class="op">=</span> <span class="dv">6</span><span class="op">;</span></span>
<span id="cb50-3"><a href="#cb50-3" aria-hidden="true" tabindex="-1"></a>GT <span class="op">=</span> np.sort(np.random.choice(np.arange(<span class="dv">1</span>,T), ngts, replace <span class="op">=</span> <span class="va">False</span>))</span>
<span id="cb50-4"><a href="#cb50-4" aria-hidden="true" tabindex="-1"></a>preds <span class="op">=</span> np.sort(np.random.choice(np.arange(<span class="dv">1</span>,T), npreds, replace <span class="op">=</span> <span class="va">False</span>))  </span>
<span id="cb50-5"><a href="#cb50-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-6"><a href="#cb50-6" aria-hidden="true" tabindex="-1"></a><span class="co"># fig, ax = plt.subplots()</span></span>
<span id="cb50-7"><a href="#cb50-7" aria-hidden="true" tabindex="-1"></a><span class="co"># plt.plot(GT, np.ones(ngts), 'o')</span></span>
<span id="cb50-8"><a href="#cb50-8" aria-hidden="true" tabindex="-1"></a><span class="co"># plt.plot(preds, np.ones(npreds)*0.9, 'o')</span></span>
<span id="cb50-9"><a href="#cb50-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-10"><a href="#cb50-10" aria-hidden="true" tabindex="-1"></a>seg_GT <span class="op">=</span> create_binary_segment(GT, T)</span>
<span id="cb50-11"><a href="#cb50-11" aria-hidden="true" tabindex="-1"></a>seg_preds <span class="op">=</span> create_binary_segment(preds, T)</span>
<span id="cb50-12"><a href="#cb50-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-13"><a href="#cb50-13" aria-hidden="true" tabindex="-1"></a>[row_ind, col_ind], cost_matrix <span class="op">=</span> segment_assignment(GT, preds, T)</span>
<span id="cb50-14"><a href="#cb50-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-15"><a href="#cb50-15" aria-hidden="true" tabindex="-1"></a>fig, axs <span class="op">=</span> plt.subplots(<span class="dv">2</span>, <span class="dv">5</span>, figsize <span class="op">=</span> (<span class="dv">15</span>, <span class="dv">6</span>))</span>
<span id="cb50-16"><a href="#cb50-16" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> r, c, ax <span class="kw">in</span> <span class="bu">zip</span>(row_ind, col_ind, axs.flatten()):</span>
<span id="cb50-17"><a href="#cb50-17" aria-hidden="true" tabindex="-1"></a>    ax.set_title(<span class="ss">f'1 - JI = </span><span class="sc">{</span>np<span class="sc">.</span><span class="bu">round</span>(cost_matrix[r, c], <span class="dv">2</span>)<span class="sc">}</span><span class="ss">'</span>)</span>
<span id="cb50-18"><a href="#cb50-18" aria-hidden="true" tabindex="-1"></a>    ax.plot(seg_GT[r], label <span class="op">=</span> <span class="st">'GT'</span>)</span>
<span id="cb50-19"><a href="#cb50-19" aria-hidden="true" tabindex="-1"></a>    ax.plot(seg_preds[c], label <span class="op">=</span> <span class="st">'Assigned pred'</span>, alpha <span class="op">=</span> <span class="fl">0.6</span>)</span>
<span id="cb50-20"><a href="#cb50-20" aria-hidden="true" tabindex="-1"></a>axs[<span class="dv">0</span>,<span class="dv">0</span>].legend()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>&lt;matplotlib.legend.Legend&gt;</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="utils_challenge_files/figure-html/cell-41-output-2.png" class="img-fluid"></p>
</div>
</div>
</section>
</section>
<section id="segment-properties-comparison" class="level2">
<h2 class="anchored" data-anchor-id="segment-properties-comparison">Segment properties comparison</h2>
<section id="metrics-of-segment-properties" class="level4">
<h4 class="anchored" data-anchor-id="metrics-of-segment-properties">Metrics of segment properties</h4>
<hr>
</section>
<section id="metric_diffusive_state" class="level3">
<h3 class="anchored" data-anchor-id="metric_diffusive_state">metric_diffusive_state</h3>
<blockquote class="blockquote">
<pre><code> metric_diffusive_state (gt=None, pred=None, max_error=False)</code></pre>
</blockquote>
<hr>
</section>
<section id="metric_diffusion_coefficient" class="level3">
<h3 class="anchored" data-anchor-id="metric_diffusion_coefficient">metric_diffusion_coefficient</h3>
<blockquote class="blockquote">
<pre><code> metric_diffusion_coefficient (gt=None, pred=None, threshold_min=1e-12,
                               max_error=False)</code></pre>
</blockquote>
<hr>
</section>
<section id="metric_anomalous_exponent" class="level3">
<h3 class="anchored" data-anchor-id="metric_anomalous_exponent">metric_anomalous_exponent</h3>
<blockquote class="blockquote">
<pre><code> metric_anomalous_exponent (gt=None, pred=None, max_error=False)</code></pre>
</blockquote>
<div class="cell">
<div class="sourceCode cell-code" id="cb55"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a>x <span class="op">=</span> np.random.rand(<span class="dv">100</span>)</span>
<span id="cb55-2"><a href="#cb55-2" aria-hidden="true" tabindex="-1"></a>y <span class="op">=</span> np.random.rand(<span class="dv">100</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb56"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a>mean_squared_log_error([<span class="fl">1e6</span>],[<span class="fl">1e-12</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>190.86835960820298</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb58"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a>metric_diffusion_coefficient(x<span class="op">+</span><span class="dv">2</span>,y<span class="op">+</span><span class="dv">2</span>, threshold_min<span class="op">=-</span><span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>0.01379558958923705</code></pre>
</div>
</div>
<section id="check_no_changepoints" class="level4">
<h4 class="anchored" data-anchor-id="check_no_changepoints"><code>check_no_changepoints</code></h4>
<hr>
</section>
</section>
<section id="check_no_changepoints-1" class="level3">
<h3 class="anchored" data-anchor-id="check_no_changepoints-1">check_no_changepoints</h3>
<blockquote class="blockquote">
<pre><code> check_no_changepoints (GT_cp, GT_alpha, GT_D, GT_s, preds_cp,
                        preds_alpha, preds_D, preds_s, T=None)</code></pre>
</blockquote>
<p>Given predicionts over changepoints and variables, checks if in both GT and preds there is an absence of changepoint. If so, takes that into account to pair variables.</p>
<section id="segment_property_errors" class="level4">
<h4 class="anchored" data-anchor-id="segment_property_errors"><code>segment_property_errors</code></h4>
<hr>
</section>
</section>
<section id="segment_property_errors-1" class="level3">
<h3 class="anchored" data-anchor-id="segment_property_errors-1">segment_property_errors</h3>
<blockquote class="blockquote">
<pre><code> segment_property_errors (GT_cp, GT_alpha, GT_D, GT_s, preds_cp,
                          preds_alpha, preds_D, preds_s,
                          return_pairs=False, T=None)</code></pre>
</blockquote>
<div class="cell">
<div class="sourceCode cell-code" id="cb62"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb62-1"><a href="#cb62-1" aria-hidden="true" tabindex="-1"></a>T <span class="op">=</span> <span class="dv">200</span><span class="op">;</span> </span>
<span id="cb62-2"><a href="#cb62-2" aria-hidden="true" tabindex="-1"></a>ngts <span class="op">=</span> <span class="dv">10</span><span class="op">;</span> </span>
<span id="cb62-3"><a href="#cb62-3" aria-hidden="true" tabindex="-1"></a>errors_alpha <span class="op">=</span> np.linspace(<span class="dv">0</span>, <span class="dv">1</span>, ngts)</span>
<span id="cb62-4"><a href="#cb62-4" aria-hidden="true" tabindex="-1"></a>errors_d <span class="op">=</span> np.linspace(<span class="dv">0</span>, <span class="dv">10</span>, ngts)</span>
<span id="cb62-5"><a href="#cb62-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-6"><a href="#cb62-6" aria-hidden="true" tabindex="-1"></a>metric_a, metric_d <span class="op">=</span> [], []</span>
<span id="cb62-7"><a href="#cb62-7" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> error_a, error_d <span class="kw">in</span> <span class="bu">zip</span>(errors_alpha, errors_d):</span>
<span id="cb62-8"><a href="#cb62-8" aria-hidden="true" tabindex="-1"></a>    la, ld <span class="op">=</span> [], []</span>
<span id="cb62-9"><a href="#cb62-9" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> _ <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">100</span>):</span>
<span id="cb62-10"><a href="#cb62-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-11"><a href="#cb62-11" aria-hidden="true" tabindex="-1"></a>        GT_cp <span class="op">=</span> np.sort(np.random.choice(np.arange(<span class="dv">1</span>,T<span class="op">-</span><span class="dv">1</span>), ngts, replace <span class="op">=</span> <span class="va">False</span>))</span>
<span id="cb62-12"><a href="#cb62-12" aria-hidden="true" tabindex="-1"></a>        preds_cp <span class="op">=</span> np.sort(np.random.choice(np.arange(<span class="dv">1</span>,T<span class="op">-</span><span class="dv">1</span>), ngts, replace <span class="op">=</span> <span class="va">False</span>)) </span>
<span id="cb62-13"><a href="#cb62-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-14"><a href="#cb62-14" aria-hidden="true" tabindex="-1"></a>        GT_alpha <span class="op">=</span> np.random.rand(GT_cp.shape[<span class="dv">0</span>]<span class="op">+</span><span class="dv">1</span>)</span>
<span id="cb62-15"><a href="#cb62-15" aria-hidden="true" tabindex="-1"></a>        preds_alpha <span class="op">=</span> GT_alpha <span class="op">+</span> np.random.randn(preds_cp.shape[<span class="dv">0</span>]<span class="op">+</span><span class="dv">1</span>)<span class="op">*</span>error_a</span>
<span id="cb62-16"><a href="#cb62-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-17"><a href="#cb62-17" aria-hidden="true" tabindex="-1"></a>        GT_D <span class="op">=</span> np.<span class="bu">abs</span>(np.random.randn(GT_cp.shape[<span class="dv">0</span>]<span class="op">+</span><span class="dv">1</span>)<span class="op">*</span><span class="dv">10</span>)</span>
<span id="cb62-18"><a href="#cb62-18" aria-hidden="true" tabindex="-1"></a>        preds_D <span class="op">=</span> GT_D <span class="op">+</span> np.<span class="bu">abs</span>(np.random.randn(preds_cp.shape[<span class="dv">0</span>]<span class="op">+</span><span class="dv">1</span>))<span class="op">*</span>error_d</span>
<span id="cb62-19"><a href="#cb62-19" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb62-20"><a href="#cb62-20" aria-hidden="true" tabindex="-1"></a>        GT_s <span class="op">=</span> np.random.randint(<span class="dv">0</span>, <span class="dv">5</span>, GT_cp.shape[<span class="dv">0</span>]<span class="op">+</span><span class="dv">1</span>)</span>
<span id="cb62-21"><a href="#cb62-21" aria-hidden="true" tabindex="-1"></a>        pred_s <span class="op">=</span> np.random.randint(<span class="dv">0</span>, <span class="dv">5</span>, preds_cp.shape[<span class="dv">0</span>]<span class="op">+</span><span class="dv">1</span>)</span>
<span id="cb62-22"><a href="#cb62-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-23"><a href="#cb62-23" aria-hidden="true" tabindex="-1"></a>        m_a, m_d, m_s <span class="op">=</span> segment_property_errors(GT_cp, GT_alpha, GT_D, GT_s, preds_cp, preds_alpha, preds_D, preds_s, T <span class="op">=</span> T)</span>
<span id="cb62-24"><a href="#cb62-24" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb62-25"><a href="#cb62-25" aria-hidden="true" tabindex="-1"></a>        la.append(m_a)<span class="op">;</span> ld.append(m_d)</span>
<span id="cb62-26"><a href="#cb62-26" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb62-27"><a href="#cb62-27" aria-hidden="true" tabindex="-1"></a>    metric_a.append(np.mean(la))</span>
<span id="cb62-28"><a href="#cb62-28" aria-hidden="true" tabindex="-1"></a>    metric_d.append(np.mean(ld))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb63"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb63-1"><a href="#cb63-1" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots(<span class="dv">1</span>, <span class="dv">2</span>, figsize <span class="op">=</span> (<span class="dv">10</span>, <span class="dv">5</span>))</span>
<span id="cb63-2"><a href="#cb63-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-3"><a href="#cb63-3" aria-hidden="true" tabindex="-1"></a>ax[<span class="dv">0</span>].plot(np.arange(ngts), errors_alpha, c <span class="op">=</span> <span class="st">'C0'</span>, ls <span class="op">=</span> <span class="st">'--'</span>)</span>
<span id="cb63-4"><a href="#cb63-4" aria-hidden="true" tabindex="-1"></a>ax[<span class="dv">0</span>].plot(np.arange(ngts), metric_a, c <span class="op">=</span> <span class="st">'C0'</span>)</span>
<span id="cb63-5"><a href="#cb63-5" aria-hidden="true" tabindex="-1"></a>ax[<span class="dv">0</span>].set_title(<span class="vs">r'Error in $\alpha$'</span>)</span>
<span id="cb63-6"><a href="#cb63-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-7"><a href="#cb63-7" aria-hidden="true" tabindex="-1"></a><span class="co"># ax[1].plot(np.arange(ngts), errors_d, c = 'C1', ls = '--')</span></span>
<span id="cb63-8"><a href="#cb63-8" aria-hidden="true" tabindex="-1"></a>ax[<span class="dv">1</span>].plot(np.arange(ngts), metric_d, c <span class="op">=</span> <span class="st">'C1'</span>)</span>
<span id="cb63-9"><a href="#cb63-9" aria-hidden="true" tabindex="-1"></a>ax[<span class="dv">1</span>].set_title(<span class="vs">r'Error in $D$'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>Text(0.5, 1.0, 'Error in $D$')</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="utils_challenge_files/figure-html/cell-51-output-2.png" class="img-fluid"></p>
</div>
</div>
</section>
</section>
<section id="ensemble-metrics" class="level2">
<h2 class="anchored" data-anchor-id="ensemble-metrics">Ensemble metrics</h2>
<section id="extract_ensemble" class="level3">
<h3 class="anchored" data-anchor-id="extract_ensemble"><code>extract_ensemble</code></h3>
<hr>
</section>
<section id="extract_ensemble-1" class="level3">
<h3 class="anchored" data-anchor-id="extract_ensemble-1">extract_ensemble</h3>
<blockquote class="blockquote">
<pre><code> extract_ensemble (state_label, dic)</code></pre>
</blockquote>
<p>Given an array of the diffusive state and a dictionary with the diffusion information, returns a summary of the ensemble properties for the current dataset.</p>
<p>Args: :state_label (array): Array containing the diffusive state of the particles in the dataset. For multi-state and dimerization, this must be the number associated to the state (for dimerization, 0 is free, 1 is dimerized). For the rest, we follow the numeration of models_phenom().lab_state. :dic (dictionary): Dictionary containing the information of the input dataset. Returns: :ensemble (array): Matrix containing the ensemble information of the input dataset. It has the following shape: |mu_alpha1 mu_alpha2 … | |sigma_alpha1 sigma_alpha2 … | |mu_D1 mu_D1 … | |sigma_D1 sigma_D2 … | |counts_state1 counts_state2 … |</p>
</section>
<section id="generating-multimodal-from-mean-and-variance" class="level3">
<h3 class="anchored" data-anchor-id="generating-multimodal-from-mean-and-variance">Generating multimodal from mean and variance</h3>
<hr>
</section>
<section id="multimode_dist" class="level3">
<h3 class="anchored" data-anchor-id="multimode_dist">multimode_dist</h3>
<blockquote class="blockquote">
<pre><code> multimode_dist (params, weights, bound, x, normalized=False)</code></pre>
</blockquote>
</section>
<section id="distance-between-distributions" class="level3">
<h3 class="anchored" data-anchor-id="distance-between-distributions">Distance between distributions</h3>
<hr>
</section>
<section id="distribution_distance" class="level3">
<h3 class="anchored" data-anchor-id="distribution_distance">distribution_distance</h3>
<blockquote class="blockquote">
<pre><code> distribution_distance (p, q)</code></pre>
</blockquote>
<p>https://stackoverflow.com/questions/44549369/kullback-leibler-divergence-from-gaussian-pm-pv-to-gaussian-qm-qv</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb68"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb68-1"><a href="#cb68-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> scipy</span>
<span id="cb68-2"><a href="#cb68-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> scipy <span class="im">import</span> stats</span>
<span id="cb68-3"><a href="#cb68-3" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> scipy.stats <span class="im">import</span> beta <span class="im">as</span> beta_func</span>
<span id="cb68-4"><a href="#cb68-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb68-5"><a href="#cb68-5" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> random</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb69"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb69-1"><a href="#cb69-1" aria-hidden="true" tabindex="-1"></a>minimum <span class="op">=</span> <span class="dv">1</span></span>
<span id="cb69-2"><a href="#cb69-2" aria-hidden="true" tabindex="-1"></a>mode <span class="op">=</span> <span class="dv">2</span></span>
<span id="cb69-3"><a href="#cb69-3" aria-hidden="true" tabindex="-1"></a>maximum <span class="op">=</span> <span class="dv">3</span></span>
<span id="cb69-4"><a href="#cb69-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-5"><a href="#cb69-5" aria-hidden="true" tabindex="-1"></a>d <span class="op">=</span> (minimum <span class="op">+</span> <span class="dv">4</span><span class="op">*</span>mode <span class="op">+</span> maximum)<span class="op">/</span><span class="dv">6</span></span>
<span id="cb69-6"><a href="#cb69-6" aria-hidden="true" tabindex="-1"></a>alpha <span class="op">=</span> <span class="dv">6</span><span class="op">*</span>((d <span class="op">-</span> minimum)<span class="op">/</span>(maximum <span class="op">-</span> minimum))</span>
<span id="cb69-7"><a href="#cb69-7" aria-hidden="true" tabindex="-1"></a>beta <span class="op">=</span> <span class="dv">6</span><span class="op">*</span>((maximum <span class="op">-</span> d)<span class="op">/</span>(maximum <span class="op">-</span> minimum))</span>
<span id="cb69-8"><a href="#cb69-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-9"><a href="#cb69-9" aria-hidden="true" tabindex="-1"></a>location <span class="op">=</span> minimum</span>
<span id="cb69-10"><a href="#cb69-10" aria-hidden="true" tabindex="-1"></a>scale <span class="op">=</span> maximum <span class="op">-</span> minimum</span>
<span id="cb69-11"><a href="#cb69-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-12"><a href="#cb69-12" aria-hidden="true" tabindex="-1"></a>x <span class="op">=</span> np.arange(<span class="op">-</span><span class="dv">1</span>, <span class="dv">5</span>, <span class="fl">0.001</span>)</span>
<span id="cb69-13"><a href="#cb69-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-14"><a href="#cb69-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-15"><a href="#cb69-15" aria-hidden="true" tabindex="-1"></a>pert <span class="op">=</span> beta_func.pdf(x, alpha, beta, location, scale)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb70"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb70-1"><a href="#cb70-1" aria-hidden="true" tabindex="-1"></a>means <span class="op">=</span> np.linspace(<span class="dv">0</span>, <span class="dv">2</span>, <span class="dv">30</span>)</span>
<span id="cb70-2"><a href="#cb70-2" aria-hidden="true" tabindex="-1"></a>normalize <span class="op">=</span> <span class="va">False</span></span>
<span id="cb70-3"><a href="#cb70-3" aria-hidden="true" tabindex="-1"></a>fig <span class="op">=</span> plt.figure(figsize<span class="op">=</span>(<span class="dv">20</span>, <span class="dv">5</span>))</span>
<span id="cb70-4"><a href="#cb70-4" aria-hidden="true" tabindex="-1"></a>gs <span class="op">=</span> fig.add_gridspec(<span class="dv">2</span>, <span class="dv">10</span>)</span>
<span id="cb70-5"><a href="#cb70-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-6"><a href="#cb70-6" aria-hidden="true" tabindex="-1"></a><span class="co"># True distribution</span></span>
<span id="cb70-7"><a href="#cb70-7" aria-hidden="true" tabindex="-1"></a>x <span class="op">=</span> np.arange(<span class="dv">0</span>, <span class="dv">3</span>, <span class="fl">0.01</span>)</span>
<span id="cb70-8"><a href="#cb70-8" aria-hidden="true" tabindex="-1"></a>params <span class="op">=</span> [[<span class="fl">1.7</span>,<span class="fl">0.01</span>]]</span>
<span id="cb70-9"><a href="#cb70-9" aria-hidden="true" tabindex="-1"></a>weights <span class="op">=</span> [<span class="dv">1</span>]</span>
<span id="cb70-10"><a href="#cb70-10" aria-hidden="true" tabindex="-1"></a>true <span class="op">=</span> multimode_dist(params, weights, bound <span class="op">=</span> [<span class="dv">0</span>, <span class="dv">3</span>], x <span class="op">=</span> x, normalized <span class="op">=</span> normalize)</span>
<span id="cb70-11"><a href="#cb70-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-12"><a href="#cb70-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-13"><a href="#cb70-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-14"><a href="#cb70-14" aria-hidden="true" tabindex="-1"></a>KL <span class="op">=</span> []</span>
<span id="cb70-15"><a href="#cb70-15" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> idx, mean <span class="kw">in</span> <span class="bu">enumerate</span>(means):</span>
<span id="cb70-16"><a href="#cb70-16" aria-hidden="true" tabindex="-1"></a>    params <span class="op">=</span> [[mean, <span class="fl">0.01</span>]]</span>
<span id="cb70-17"><a href="#cb70-17" aria-hidden="true" tabindex="-1"></a>    weights <span class="op">=</span> [<span class="dv">1</span>]</span>
<span id="cb70-18"><a href="#cb70-18" aria-hidden="true" tabindex="-1"></a>    pred <span class="op">=</span> multimode_dist(params, weights, bound <span class="op">=</span> [<span class="dv">0</span>, <span class="dv">3</span>], x <span class="op">=</span> x, normalized <span class="op">=</span> normalize)  </span>
<span id="cb70-19"><a href="#cb70-19" aria-hidden="true" tabindex="-1"></a>    KL.append(distribution_distance(true, pred))  </span>
<span id="cb70-20"><a href="#cb70-20" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb70-21"><a href="#cb70-21" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> idx <span class="op">%</span> <span class="dv">3</span> <span class="op">==</span> <span class="dv">0</span>:</span>
<span id="cb70-22"><a href="#cb70-22" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb70-23"><a href="#cb70-23" aria-hidden="true" tabindex="-1"></a>        ax <span class="op">=</span> fig.add_subplot(gs[<span class="dv">0</span>, <span class="bu">int</span>(idx<span class="op">/</span><span class="dv">3</span>)])</span>
<span id="cb70-24"><a href="#cb70-24" aria-hidden="true" tabindex="-1"></a>        ax.plot(x, true, label <span class="op">=</span> <span class="st">'True'</span>)</span>
<span id="cb70-25"><a href="#cb70-25" aria-hidden="true" tabindex="-1"></a>        ax.plot(x, pred, label <span class="op">=</span> <span class="st">'Predicted'</span>)        </span>
<span id="cb70-26"><a href="#cb70-26" aria-hidden="true" tabindex="-1"></a>        plt.setp(ax, yticks <span class="op">=</span> [])<span class="op">;</span></span>
<span id="cb70-27"><a href="#cb70-27" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb70-28"><a href="#cb70-28" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb70-29"><a href="#cb70-29" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> idx <span class="op">==</span> <span class="dv">0</span>:</span>
<span id="cb70-30"><a href="#cb70-30" aria-hidden="true" tabindex="-1"></a>        ax.legend()</span>
<span id="cb70-31"><a href="#cb70-31" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb70-32"><a href="#cb70-32" aria-hidden="true" tabindex="-1"></a>ax_kl <span class="op">=</span> fig.add_subplot(gs[<span class="dv">1</span>, :])</span>
<span id="cb70-33"><a href="#cb70-33" aria-hidden="true" tabindex="-1"></a>ax_kl.plot(KL, <span class="st">'-o'</span>)</span>
<span id="cb70-34"><a href="#cb70-34" aria-hidden="true" tabindex="-1"></a>plt.setp(ax_kl, ylabel <span class="op">=</span> <span class="st">'MAE'</span>)</span>
<span id="cb70-35"><a href="#cb70-35" aria-hidden="true" tabindex="-1"></a>ax_kl.grid()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="utils_challenge_files/figure-html/cell-57-output-1.png" class="img-fluid"></p>
</div>
</div>
</section>
<section id="calculate-ensemble-metric" class="level3">
<h3 class="anchored" data-anchor-id="calculate-ensemble-metric">Calculate ensemble metric</h3>
<p>Inputs are matrices of form:</p>
<p><span class="math inline">\(\mu_\alpha^1\)</span>; <span class="math inline">\(\mu_\alpha^2\)</span> ; …<br>
<span class="math inline">\(\sigma_\alpha^1\)</span>; <span class="math inline">\(\sigma_\alpha^2\)</span> ; …<br>
<span class="math inline">\(\mu_D^1\)</span> ; <span class="math inline">\(\mu_D^2\)</span> ; …<br>
<span class="math inline">\(\sigma_D^1\)</span> ; <span class="math inline">\(\sigma_D^2\)</span> ; …<br>
<span class="math inline">\(N_1\)</span>, <span class="math inline">\(N_2\)</span>, …</p>
<hr>
</section>
<section id="error_ensemble_dataset" class="level3">
<h3 class="anchored" data-anchor-id="error_ensemble_dataset">error_Ensemble_dataset</h3>
<blockquote class="blockquote">
<pre><code> error_Ensemble_dataset (true_data, pred_data, return_distributions=False)</code></pre>
</blockquote>
</section>
</section>
<section id="reading-participants-predictions" class="level2">
<h2 class="anchored" data-anchor-id="reading-participants-predictions">Reading participants predictions</h2>
<p>The participants will have to output predictions in a .txt file were each line corresponds to the predictions of a trajectory. The latter have to be ordered as:</p>
<p>0, d<span class="math inline">\(_0\)</span>, a<span class="math inline">\(_0\)</span>, s<span class="math inline">\(_0\)</span>, t<span class="math inline">\(_1\)</span>, d<span class="math inline">\(_1\)</span>, a<span class="math inline">\(_1\)</span>, s<span class="math inline">\(_1\)</span>, t<span class="math inline">\(_2\)</span>, d<span class="math inline">\(_2\)</span>, a<span class="math inline">\(_2\)</span>, s<span class="math inline">\(_2\)</span>, …. t<span class="math inline">\(_n\)</span>, d<span class="math inline">\(_n\)</span>, a<span class="math inline">\(_n\)</span>, s<span class="math inline">\(_n\)</span></p>
<p>where the first number corresponds to the trajectory index, then d<span class="math inline">\(_i\)</span>, a<span class="math inline">\(_i\)</span>, s<span class="math inline">\(_i\)</span> correspond to the diffusion coefficient, anomalous exponent and diffusive state of the <span class="math inline">\(i\)</span>-th segment. For the latter, we have the following code: - 0: immobile - 1: confined - 2: brownian - 3: anomalous</p>
<p>Last, t<span class="math inline">\(_j\)</span> corresponds to the <span class="math inline">\(j\)</span>-th changepoints. Each prediction <strong>must</strong> contain <span class="math inline">\(C\)</span> changepoints and <span class="math inline">\(C+1\)</span> segments property values. If this is not fulfilled, the whole trajectory is considered as mispredicted.</p>
<p>The .txt file will be first inspected. The data will then be collected into a dataframe</p>
<section id="check_prediction_length" class="level4">
<h4 class="anchored" data-anchor-id="check_prediction_length"><code>check_prediction_length</code></h4>
<hr>
</section>
<section id="check_prediction_length-1" class="level3">
<h3 class="anchored" data-anchor-id="check_prediction_length-1">check_prediction_length</h3>
<blockquote class="blockquote">
<pre><code> check_prediction_length (pred)</code></pre>
</blockquote>
<p>Given a trajectory segments prediction, checks whether it has C changepoints and C+1 segments properties values. As it must also contain the index of the trajectory, this is summarized by being multiple of 4. In some cases, the user needs to also predict the final point of the trajectory. In this case, we will have a residu of 1</p>
<section id="separate_prediction_values" class="level4">
<h4 class="anchored" data-anchor-id="separate_prediction_values"><code>separate_prediction_values</code></h4>
<hr>
</section>
</section>
<section id="separate_prediction_values-1" class="level3">
<h3 class="anchored" data-anchor-id="separate_prediction_values-1">separate_prediction_values</h3>
<blockquote class="blockquote">
<pre><code> separate_prediction_values (pred)</code></pre>
</blockquote>
<p>Given a trajectory segments prediction, extracts the predictions for each segment property as well as the changepoint values</p>
<section id="load_file_to_df" class="level4">
<h4 class="anchored" data-anchor-id="load_file_to_df"><code>load_file_to_df</code></h4>
<hr>
</section>
</section>
<section id="load_file_to_df-1" class="level3">
<h3 class="anchored" data-anchor-id="load_file_to_df-1">load_file_to_df</h3>
<blockquote class="blockquote">
<pre><code> load_file_to_df (path_file, columns=['traj_idx', 'Ds', 'alphas',
                  'states', 'changepoints'])</code></pre>
</blockquote>
<p>Given the path of a .txt file, extract the segmentation predictions based on the rules of the ANDI Challenge 2022</p>
<p>Saving fake data for test</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb75"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb75-1"><a href="#cb75-1" aria-hidden="true" tabindex="-1"></a>file_gt, file_p <span class="op">=</span> [], []</span>
<span id="cb75-2"><a href="#cb75-2" aria-hidden="true" tabindex="-1"></a>T <span class="op">=</span> <span class="dv">200</span><span class="op">;</span> ngts <span class="op">=</span> <span class="dv">10</span><span class="op">;</span></span>
<span id="cb75-3"><a href="#cb75-3" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> traj <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">100</span>):</span>
<span id="cb75-4"><a href="#cb75-4" aria-hidden="true" tabindex="-1"></a>    GT_cp <span class="op">=</span> np.sort(np.random.choice(np.arange(<span class="dv">1</span>,T), ngts, replace <span class="op">=</span> <span class="va">False</span>))</span>
<span id="cb75-5"><a href="#cb75-5" aria-hidden="true" tabindex="-1"></a>    preds_cp <span class="op">=</span> np.sort(np.random.choice(np.arange(<span class="dv">1</span>,T<span class="op">+</span><span class="dv">50</span>), ngts, replace <span class="op">=</span> <span class="va">False</span>)) </span>
<span id="cb75-6"><a href="#cb75-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-7"><a href="#cb75-7" aria-hidden="true" tabindex="-1"></a>    GT_alpha <span class="op">=</span> np.random.rand(GT_cp.shape[<span class="dv">0</span>]<span class="op">+</span><span class="dv">1</span>)</span>
<span id="cb75-8"><a href="#cb75-8" aria-hidden="true" tabindex="-1"></a>    preds_alpha <span class="op">=</span> GT_alpha<span class="co"># + 0.1 #np.random.randn(preds_cp.shape[0]+1)*0.1</span></span>
<span id="cb75-9"><a href="#cb75-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-10"><a href="#cb75-10" aria-hidden="true" tabindex="-1"></a>    GT_D <span class="op">=</span> np.<span class="bu">abs</span>(np.random.randn(GT_cp.shape[<span class="dv">0</span>]<span class="op">+</span><span class="dv">1</span>)<span class="op">*</span><span class="dv">10</span>)</span>
<span id="cb75-11"><a href="#cb75-11" aria-hidden="true" tabindex="-1"></a>    preds_D <span class="op">=</span> GT_D <span class="op">+</span> <span class="fl">1.5</span> <span class="co">#np.abs(np.random.randn(preds_cp.shape[0]+1))*1.6</span></span>
<span id="cb75-12"><a href="#cb75-12" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb75-13"><a href="#cb75-13" aria-hidden="true" tabindex="-1"></a>    GT_state <span class="op">=</span> np.random.randint(<span class="dv">0</span>, high <span class="op">=</span> <span class="dv">5</span>, size <span class="op">=</span> GT_cp.shape[<span class="dv">0</span>]<span class="op">+</span><span class="dv">1</span>)</span>
<span id="cb75-14"><a href="#cb75-14" aria-hidden="true" tabindex="-1"></a>    preds_state <span class="op">=</span> np.random.randint(<span class="dv">0</span>, high <span class="op">=</span> <span class="dv">5</span>, size <span class="op">=</span> preds_cp.shape[<span class="dv">0</span>]<span class="op">+</span><span class="dv">1</span>)</span>
<span id="cb75-15"><a href="#cb75-15" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb75-16"><a href="#cb75-16" aria-hidden="true" tabindex="-1"></a>    list_gt, list_p <span class="op">=</span> [traj, GT_D[<span class="dv">0</span>], GT_alpha[<span class="dv">0</span>], GT_state[<span class="dv">0</span>]], [traj, preds_D[<span class="dv">0</span>], preds_alpha[<span class="dv">0</span>], preds_state[<span class="dv">0</span>]]</span>
<span id="cb75-17"><a href="#cb75-17" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> gtc, gta, gtd, gts, pc, pa, pd, ps <span class="kw">in</span> <span class="bu">zip</span>(GT_cp, GT_alpha[<span class="dv">1</span>:], GT_D[<span class="dv">1</span>:], GT_state[<span class="dv">1</span>:], preds_cp, preds_alpha[<span class="dv">1</span>:], preds_D[<span class="dv">1</span>:], preds_state[<span class="dv">1</span>:]):</span>
<span id="cb75-18"><a href="#cb75-18" aria-hidden="true" tabindex="-1"></a>        list_gt <span class="op">+=</span> [gtc, gtd, gta, gts]</span>
<span id="cb75-19"><a href="#cb75-19" aria-hidden="true" tabindex="-1"></a>        list_p <span class="op">+=</span> [pc, pd, pa, ps]</span>
<span id="cb75-20"><a href="#cb75-20" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb75-21"><a href="#cb75-21" aria-hidden="true" tabindex="-1"></a>    file_gt.append(list_gt)</span>
<span id="cb75-22"><a href="#cb75-22" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> traj <span class="op">!=</span> <span class="dv">6</span>:</span>
<span id="cb75-23"><a href="#cb75-23" aria-hidden="true" tabindex="-1"></a>        file_p.append(list_p)</span>
<span id="cb75-24"><a href="#cb75-24" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb75-25"><a href="#cb75-25" aria-hidden="true" tabindex="-1"></a>pred_path, true_path <span class="op">=</span> <span class="st">'pred_test.txt'</span>, <span class="st">'true_test.txt'</span></span>
<span id="cb75-26"><a href="#cb75-26" aria-hidden="true" tabindex="-1"></a>np.savetxt(true_path, file_gt, delimiter<span class="op">=</span><span class="st">','</span>)</span>
<span id="cb75-27"><a href="#cb75-27" aria-hidden="true" tabindex="-1"></a>np.savetxt(pred_path, file_p, delimiter<span class="op">=</span><span class="st">','</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Recovering the data</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb76"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb76-1"><a href="#cb76-1" aria-hidden="true" tabindex="-1"></a>pred_path, true_path <span class="op">=</span> <span class="st">'pred_test.txt'</span>, <span class="st">'true_test.txt'</span></span>
<span id="cb76-2"><a href="#cb76-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-3"><a href="#cb76-3" aria-hidden="true" tabindex="-1"></a>df_pred <span class="op">=</span> load_file_to_df(pred_path)</span>
<span id="cb76-4"><a href="#cb76-4" aria-hidden="true" tabindex="-1"></a>df_true <span class="op">=</span> load_file_to_df(true_path)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="error_singletraj_dataset" class="level4">
<h4 class="anchored" data-anchor-id="error_singletraj_dataset"><code>error_SingleTraj_dataset</code></h4>
<hr>
</section>
</section>
<section id="error_singletraj_dataset-1" class="level3">
<h3 class="anchored" data-anchor-id="error_singletraj_dataset-1">error_SingleTraj_dataset</h3>
<blockquote class="blockquote">
<pre><code> error_SingleTraj_dataset (df_pred, df_true, threshold_error_alpha=2,
                           max_val_alpha=2, min_val_alpha=0,
                           threshold_error_D=100000.0,
                           max_val_D=1000000.0, min_val_D=1e-06,
                           threshold_error_s=-1, threshold_cp=10,
                           prints=True, disable_tqdm=False)</code></pre>
</blockquote>
<p>Given two dataframes, corresponding to the predictions and true labels of a set of trajectories from the ANDI challenge 2022, calculates the corresponding metrics Columns must be for both (no order needed): traj_idx | alphas | Ds | changepoints | states df_true must also contain a column ‘T’</p>
<table class="table">
<colgroup>
<col style="width: 6%">
<col style="width: 25%">
<col style="width: 34%">
<col style="width: 34%">
</colgroup>
<thead>
<tr class="header">
<th></th>
<th><strong>Type</strong></th>
<th><strong>Default</strong></th>
<th><strong>Details</strong></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>df_pred</td>
<td></td>
<td></td>
<td></td>
</tr>
<tr class="even">
<td>df_true</td>
<td></td>
<td></td>
<td></td>
</tr>
<tr class="odd">
<td>threshold_error_alpha</td>
<td>int</td>
<td>2</td>
<td></td>
</tr>
<tr class="even">
<td>max_val_alpha</td>
<td>int</td>
<td>2</td>
<td></td>
</tr>
<tr class="odd">
<td>min_val_alpha</td>
<td>int</td>
<td>0</td>
<td></td>
</tr>
<tr class="even">
<td>threshold_error_D</td>
<td>float</td>
<td>100000.0</td>
<td></td>
</tr>
<tr class="odd">
<td>max_val_D</td>
<td>float</td>
<td>1000000.0</td>
<td></td>
</tr>
<tr class="even">
<td>min_val_D</td>
<td>float</td>
<td>1e-06</td>
<td>this is in linear scale</td>
</tr>
<tr class="odd">
<td>threshold_error_s</td>
<td>int</td>
<td>-1</td>
<td>this will transform nan into non-existing state</td>
</tr>
<tr class="even">
<td>threshold_cp</td>
<td>int</td>
<td>10</td>
<td></td>
</tr>
<tr class="odd">
<td>prints</td>
<td>bool</td>
<td>True</td>
<td></td>
</tr>
<tr class="even">
<td>disable_tqdm</td>
<td>bool</td>
<td>False</td>
<td></td>
</tr>
</tbody>
</table>
<section id="test" class="level4">
<h4 class="anchored" data-anchor-id="test">Test</h4>
<p><strong>Two datasets with same number of trajs</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb78"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb78-1"><a href="#cb78-1" aria-hidden="true" tabindex="-1"></a>trajs, labels <span class="op">=</span> models_phenom().immobile_traps(T <span class="op">=</span> <span class="dv">200</span>, N <span class="op">=</span> <span class="dv">250</span>, alphas<span class="op">=</span><span class="fl">0.5</span>, Ds <span class="op">=</span> <span class="dv">1</span>, L <span class="op">=</span> <span class="dv">20</span>, Nt <span class="op">=</span> <span class="dv">100</span>, Pb <span class="op">=</span> <span class="dv">1</span>, Pu <span class="op">=</span> <span class="fl">0.5</span>)</span>
<span id="cb78-2"><a href="#cb78-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-3"><a href="#cb78-3" aria-hidden="true" tabindex="-1"></a>trajs <span class="op">=</span> trajs.transpose((<span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">2</span>)).copy()</span>
<span id="cb78-4"><a href="#cb78-4" aria-hidden="true" tabindex="-1"></a>labels <span class="op">=</span> labels.transpose(<span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">2</span>)</span>
<span id="cb78-5"><a href="#cb78-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-6"><a href="#cb78-6" aria-hidden="true" tabindex="-1"></a>df_in, df_trues <span class="op">=</span> data_to_df(trajs, labels, label_values<span class="op">=</span>[<span class="fl">0.5</span>, <span class="dv">1</span>], diff_states<span class="op">=</span>[<span class="dv">3</span>, <span class="dv">2</span>])</span>
<span id="cb78-7"><a href="#cb78-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-8"><a href="#cb78-8" aria-hidden="true" tabindex="-1"></a>trajs, labels <span class="op">=</span> models_phenom().immobile_traps(T <span class="op">=</span> <span class="dv">200</span>, N <span class="op">=</span> <span class="dv">250</span>, alphas<span class="op">=</span>[<span class="fl">0.5</span>, <span class="fl">0.1</span>], Ds <span class="op">=</span> <span class="dv">1</span>, L <span class="op">=</span> <span class="dv">20</span>, Nt <span class="op">=</span> <span class="dv">100</span>, Pb <span class="op">=</span> <span class="dv">1</span>, Pu <span class="op">=</span> <span class="fl">0.5</span>)</span>
<span id="cb78-9"><a href="#cb78-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-10"><a href="#cb78-10" aria-hidden="true" tabindex="-1"></a>trajs <span class="op">=</span> trajs.transpose((<span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">2</span>)).copy()</span>
<span id="cb78-11"><a href="#cb78-11" aria-hidden="true" tabindex="-1"></a>labels <span class="op">=</span> labels.transpose(<span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">2</span>)</span>
<span id="cb78-12"><a href="#cb78-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-13"><a href="#cb78-13" aria-hidden="true" tabindex="-1"></a>df_in, df_preds <span class="op">=</span> data_to_df(trajs, labels, label_values<span class="op">=</span>[<span class="fl">0.5</span>, <span class="dv">1</span>], diff_states<span class="op">=</span>[<span class="dv">3</span>, <span class="dv">2</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"6a1fe6ab3cb4431d936c84bc5eeac373","version_major":2,"version_minor":0}
</script>
</div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"b96abba5a68a465f9a82d8b998313914","version_major":2,"version_minor":0}
</script>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb79"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb79-1"><a href="#cb79-1" aria-hidden="true" tabindex="-1"></a>error_SingleTraj_dataset(df_preds, df_trues, prints <span class="op">=</span> <span class="va">True</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"78c03fa768e54e0a810e1fdf6b683520","version_major":2,"version_minor":0}
</script>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Summary of metrics assesments:

Changepoint Metrics 
RMSE: 3.977 
Jaccard Index: 0.436 

Diffusion property metrics 
Metric anomalous exponent: 0.3196485708934536 
Metric diffusion coefficient: 0.233730617081089 
Metric diffusive state: 0.5135203436947182</code></pre>
</div>
<div class="cell-output cell-output-display">
<pre><code>(3.9773268837631606,
 0.43570617804443,
 0.3196485708934536,
 0.233730617081089,
 0.5135203436947182)</code></pre>
</div>
</div>
<p><strong>Two datasets with different number of trajectories</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb82"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb82-1"><a href="#cb82-1" aria-hidden="true" tabindex="-1"></a>trajs, labels <span class="op">=</span> models_phenom().immobile_traps(T <span class="op">=</span> <span class="dv">200</span>, N <span class="op">=</span> <span class="dv">350</span>, alphas<span class="op">=</span>[<span class="fl">0.5</span>,<span class="fl">0.01</span>], Ds <span class="op">=</span> [<span class="fl">1.</span>, <span class="fl">0.1</span>], L <span class="op">=</span> <span class="dv">20</span>, Nt <span class="op">=</span> <span class="dv">100</span>, Pb <span class="op">=</span> <span class="dv">1</span>, Pu <span class="op">=</span> <span class="fl">0.5</span>)</span>
<span id="cb82-2"><a href="#cb82-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-3"><a href="#cb82-3" aria-hidden="true" tabindex="-1"></a>trajs <span class="op">=</span> trajs.transpose((<span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">2</span>)).copy()</span>
<span id="cb82-4"><a href="#cb82-4" aria-hidden="true" tabindex="-1"></a>labels <span class="op">=</span> labels.transpose(<span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">2</span>)</span>
<span id="cb82-5"><a href="#cb82-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-6"><a href="#cb82-6" aria-hidden="true" tabindex="-1"></a>df_in, df_trues <span class="op">=</span> data_to_df(trajs, labels, label_values<span class="op">=</span>[<span class="fl">0.5</span>, <span class="dv">1</span>], diff_states<span class="op">=</span>[<span class="dv">3</span>, <span class="dv">2</span>])</span>
<span id="cb82-7"><a href="#cb82-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-8"><a href="#cb82-8" aria-hidden="true" tabindex="-1"></a>trajs, labels <span class="op">=</span> models_phenom().immobile_traps(T <span class="op">=</span> <span class="dv">200</span>, N <span class="op">=</span> <span class="dv">250</span>, alphas<span class="op">=</span>[<span class="fl">0.5</span>, <span class="fl">0.1</span>], Ds <span class="op">=</span> <span class="dv">1</span>, L <span class="op">=</span> <span class="dv">20</span>, Nt <span class="op">=</span> <span class="dv">100</span>, Pb <span class="op">=</span> <span class="dv">1</span>, Pu <span class="op">=</span> <span class="fl">0.5</span>)</span>
<span id="cb82-9"><a href="#cb82-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-10"><a href="#cb82-10" aria-hidden="true" tabindex="-1"></a>trajs <span class="op">=</span> trajs.transpose((<span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">2</span>)).copy()</span>
<span id="cb82-11"><a href="#cb82-11" aria-hidden="true" tabindex="-1"></a>labels <span class="op">=</span> labels.transpose(<span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">2</span>)</span>
<span id="cb82-12"><a href="#cb82-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-13"><a href="#cb82-13" aria-hidden="true" tabindex="-1"></a>df_in, df_preds <span class="op">=</span> data_to_df(trajs, labels, label_values<span class="op">=</span>[<span class="fl">0.5</span>, <span class="dv">1</span>], diff_states<span class="op">=</span>[<span class="dv">3</span>, <span class="dv">2</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"722f2ef9f7d54fd3a6f961ac438180cb","version_major":2,"version_minor":0}
</script>
</div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"382ad7f1f9404a3b8280ad939e0971eb","version_major":2,"version_minor":0}
</script>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb83"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb83-1"><a href="#cb83-1" aria-hidden="true" tabindex="-1"></a>error_SingleTraj_dataset(df_preds, df_trues, prints <span class="op">=</span> <span class="va">True</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"32b2c930add14fe0a78d340fc2095149","version_major":2,"version_minor":0}
</script>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Summary of metrics assesments:

100 missing trajectory/ies. 

Changepoint Metrics 
RMSE: 4.051 
Jaccard Index: 0.441 

Diffusion property metrics 
Metric anomalous exponent: 0.35483874584715985 
Metric diffusion coefficient: 3.1690909054732668 
Metric diffusive state: 0.4913685263947961</code></pre>
</div>
<div class="cell-output cell-output-display">
<pre><code>(4.050708208970335,
 0.4407643312101911,
 0.35483874584715985,
 3.1690909054732668,
 0.4913685263947961)</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb86"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb86-1"><a href="#cb86-1" aria-hidden="true" tabindex="-1"></a>trajs, labels <span class="op">=</span> models_phenom().immobile_traps(T <span class="op">=</span> <span class="dv">200</span>, N <span class="op">=</span> <span class="dv">5</span>, alphas<span class="op">=</span>[<span class="fl">0.5</span>,<span class="fl">0.01</span>], Ds <span class="op">=</span> [<span class="fl">1.</span>, <span class="fl">0.1</span>], L <span class="op">=</span> <span class="dv">20</span>, Nt <span class="op">=</span> <span class="dv">100</span>, Pb <span class="op">=</span> <span class="dv">1</span>, Pu <span class="op">=</span> <span class="fl">0.5</span>)</span>
<span id="cb86-2"><a href="#cb86-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-3"><a href="#cb86-3" aria-hidden="true" tabindex="-1"></a>trajs <span class="op">=</span> trajs.transpose((<span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">2</span>)).copy()</span>
<span id="cb86-4"><a href="#cb86-4" aria-hidden="true" tabindex="-1"></a>labels <span class="op">=</span> labels.transpose(<span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">2</span>)</span>
<span id="cb86-5"><a href="#cb86-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-6"><a href="#cb86-6" aria-hidden="true" tabindex="-1"></a>df_in, df_preds  <span class="op">=</span> data_to_df(trajs, labels, label_values<span class="op">=</span>[<span class="fl">0.5</span>, <span class="dv">1</span>], diff_states<span class="op">=</span>[<span class="dv">3</span>, <span class="dv">2</span>])</span>
<span id="cb86-7"><a href="#cb86-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-8"><a href="#cb86-8" aria-hidden="true" tabindex="-1"></a>trajs, labels <span class="op">=</span> models_phenom().multi_state(T <span class="op">=</span> <span class="dv">200</span>, N <span class="op">=</span> <span class="dv">7</span>, L <span class="op">=</span> <span class="dv">20</span>, M <span class="op">=</span> np.array([[<span class="fl">0.9</span>,<span class="fl">0.1</span>],[<span class="fl">0.9</span>,<span class="fl">0.1</span>]]))</span>
<span id="cb86-9"><a href="#cb86-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-10"><a href="#cb86-10" aria-hidden="true" tabindex="-1"></a>trajs <span class="op">=</span> trajs.transpose((<span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">2</span>)).copy()</span>
<span id="cb86-11"><a href="#cb86-11" aria-hidden="true" tabindex="-1"></a>labels <span class="op">=</span> labels.transpose(<span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">2</span>)</span>
<span id="cb86-12"><a href="#cb86-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-13"><a href="#cb86-13" aria-hidden="true" tabindex="-1"></a>df_in, df_trues  <span class="op">=</span> data_to_df(trajs, labels, label_values<span class="op">=</span>[<span class="fl">0.5</span>, <span class="dv">1</span>], diff_states<span class="op">=</span>[<span class="dv">3</span>, <span class="dv">2</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"e7158e67f9d74360a3dca327fbaf70ad","version_major":2,"version_minor":0}
</script>
</div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"047e0943b55341579c3ecbab3bd6aad5","version_major":2,"version_minor":0}
</script>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb87"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb87-1"><a href="#cb87-1" aria-hidden="true" tabindex="-1"></a>error_SingleTraj_dataset(df_preds, df_trues, prints <span class="op">=</span> <span class="va">True</span>)<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"00329cc314f149939b4c5971fbfb2ae9","version_major":2,"version_minor":0}
</script>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Summary of metrics assesments:

2 missing trajectory/ies. 

Changepoint Metrics 
RMSE: 2.903 
Jaccard Index: 0.188 

Diffusion property metrics 
Metric anomalous exponent: 0.8269399281523714 
Metric diffusion coefficient: 8.262443034681892 
Metric diffusive state: 0.41379310344827586</code></pre>
</div>
</div>
</section>
</section>
</section>
</section>
<section id="codalab-scoring-program" class="level1">
<h1>Codalab scoring program</h1>
<p><strong>File organization</strong></p>
<p>Names: <code>Ti_ens_exp_XXX_fov_yyy.txt</code> and <code>Ti_st_exp_XXX_fov_yyy.txt</code>, where <code>i</code> refers to the track and can be 1 (video track) or 2 (trajectory track)</p>
<p><strong>Extra information</strong></p>
<p>We will have an extra reference file which gives the model of each experiment. This is done to avoid considering Single state in the averages of change point metrics</p>
<hr>
<section id="listdir_nohidden" class="level3">
<h3 class="anchored" data-anchor-id="listdir_nohidden">listdir_nohidden</h3>
<blockquote class="blockquote">
<pre><code> listdir_nohidden (path)</code></pre>
</blockquote>
<p><strong>CHECK TRELLO LIST: we need to introduce weighting of the FOVs w.r.t to number of trajectories?</strong></p>
<hr>
</section>
<section id="codalab_scoring" class="level3">
<h3 class="anchored" data-anchor-id="codalab_scoring">codalab_scoring</h3>
<blockquote class="blockquote">
<pre><code> codalab_scoring (input_dir, output_dir)</code></pre>
</blockquote>
<div class="cell">
<div class="sourceCode cell-code" id="cb91"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb91-1"><a href="#cb91-1" aria-hidden="true" tabindex="-1"></a>input_dir <span class="op">=</span> <span class="st">'C:/Users/Gorka/github/ANDI_datasets/testing/codalab_data'</span></span>
<span id="cb91-2"><a href="#cb91-2" aria-hidden="true" tabindex="-1"></a>output_dir <span class="op">=</span> <span class="st">'C:/Users/Gorka/github/ANDI_datasets/testing/codalab_data'</span></span>
<span id="cb91-3"><a href="#cb91-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-4"><a href="#cb91-4" aria-hidden="true" tabindex="-1"></a>codalab_scoring(input_dir<span class="op">=</span>input_dir, output_dir<span class="op">=</span>output_dir)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"e980f849bcdf4c45b745663d6ddb0ebf","version_major":2,"version_minor":0}
</script>
</div>
</div>
</section>
</section>
<section id="nbdev-export" class="level1">
<h1>NBDEV Export</h1>
<div class="cell">
<div class="sourceCode cell-code" id="cb92"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb92-1"><a href="#cb92-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> nbdev<span class="op">;</span> nbdev.nbdev_export()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    setTimeout(function() {
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const cites = ref.parentNode.getAttribute('data-cites').split(' ');
    tippyHover(ref, function() {
      var popup = window.document.createElement('div');
      cites.forEach(function(cite) {
        var citeDiv = window.document.createElement('div');
        citeDiv.classList.add('hanging-indent');
        citeDiv.classList.add('csl-entry');
        var biblioDiv = window.document.getElementById('ref-' + cite);
        if (biblioDiv) {
          citeDiv.innerHTML = biblioDiv.innerHTML;
        }
        popup.appendChild(citeDiv);
      });
      return popup.innerHTML;
    });
  }
});
</script>
</div> <!-- /content -->



</body></html>