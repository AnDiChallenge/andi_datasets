<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.1.251">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>andi_datasets - Examples of use of ANDI</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1.6em;
  vertical-align: middle;
}
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<script src="../site_libs/quarto-html/quarto.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script>

  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<meta property="og:title" content="andi_datasets - Examples of use of ANDI">
<meta property="og:description" content="*Copyright 2019 by Gorka Munoz-Gil under the MIT license. This file is part of the Anomalous Diffusion (AnDi) Challenge, and is released under the “MIT License Agreement”.">
<meta property="og:site-name" content="andi_datasets">
<meta name="twitter:title" content="andi_datasets - Examples of use of ANDI">
<meta name="twitter:description" content="*Copyright 2019 by Gorka Munoz-Gil under the MIT license. This file is part of the Anomalous Diffusion (AnDi) Challenge, and is released under the “MIT License Agreement”.">
<meta name="twitter:card" content="summary">
</head>

<body class="nav-sidebar docked nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a class="navbar-brand" href="../index.html">
    <span class="navbar-title">andi_datasets</span>
    </a>
  </div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link active" href="../Readme.html" aria-current="page">Documentation</a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../tutorials/tutorials.html">Tutorials</a>
  </li>  
</ul>
              <div id="quarto-search" class="" title="Search"></div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav>
  <nav class="quarto-secondary-nav" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
    <div class="container-fluid d-flex justify-content-between">
      <h1 class="quarto-secondary-nav-title">Examples of use of ANDI</h1>
      <button type="button" class="quarto-btn-toggle btn" aria-label="Show secondary navigation">
        <i class="bi bi-chevron-right"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse sidebar-navigation docked overflow-auto">
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="../Readme.html" class="sidebar-item-text sidebar-link">Documentation</a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="false">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 ">  
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="false">Theory datasets</a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="false">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth2 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../lib_nbs/models_theory.html" class="sidebar-item-text sidebar-link">models_theory</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../lib_nbs/datasets_theory.html" class="sidebar-item-text sidebar-link">Datasets of theoretical trajectories</a>
  </div>
</li>
      </ul>
  </li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" aria-expanded="false">Phenomenological datasets</a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" aria-expanded="false">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth2 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../lib_nbs/models_phenom.html" class="sidebar-item-text sidebar-link">models_phenom</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../lib_nbs/datasets_phenom.html" class="sidebar-item-text sidebar-link">datasets_phenom</a>
  </div>
</li>
      </ul>
  </li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" aria-expanded="false">ANDI challenge datasets</a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" aria-expanded="false">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-4" class="collapse list-unstyled sidebar-section depth2 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../lib_nbs/datasets_challenge.html" class="sidebar-item-text sidebar-link">datasets_challenge</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../lib_nbs/utils_challenge.html" class="sidebar-item-text sidebar-link">utils_challenge</a>
  </div>
</li>
      </ul>
  </li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" aria-expanded="false">Trajectory analysis</a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" aria-expanded="false">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-5" class="collapse list-unstyled sidebar-section depth2 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../lib_nbs/analysis.html" class="sidebar-item-text sidebar-link">analysis</a>
  </div>
</li>
      </ul>
  </li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-6" aria-expanded="false">Helpers</a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-6" aria-expanded="false">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-6" class="collapse list-unstyled sidebar-section depth2 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../lib_nbs/utils_trajectories.html" class="sidebar-item-text sidebar-link">utils_trajectories</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../lib_nbs/utils_videos.html" class="sidebar-item-text sidebar-link">utils_videos</a>
  </div>
</li>
      </ul>
  </li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="../tutorials/tutorials.html" class="sidebar-item-text sidebar-link">Tutorials</a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-7" aria-expanded="true">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-7" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../tutorials/challenge_one_datasets.html" class="sidebar-item-text sidebar-link active">Examples of use of ANDI</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../tutorials/challenge_one_submission.html" class="sidebar-item-text sidebar-link">Submitting to the ANDI challenge: from trajectories to predictions</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../tutorials/challenge_two_datasets.html" class="sidebar-item-text sidebar-link">ANDI challenge 2022 datasets</a>
  </div>
</li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#creating-the-andi-2020-challenge-dataset" id="toc-creating-the-andi-2020-challenge-dataset" class="nav-link active" data-scroll-target="#creating-the-andi-2020-challenge-dataset">Creating the ANDI 2020 challenge dataset</a></li>
  <li><a href="#creating-trajectories-from-theoretical-models" id="toc-creating-trajectories-from-theoretical-models" class="nav-link" data-scroll-target="#creating-trajectories-from-theoretical-models">Creating trajectories from theoretical models</a>
  <ul class="collapse">
  <li><a href="#saving-and-loading-datasets" id="toc-saving-and-loading-datasets" class="nav-link" data-scroll-target="#saving-and-loading-datasets">Saving and loading datasets</a></li>
  <li><a href="#creating-noisy-datasets" id="toc-creating-noisy-datasets" class="nav-link" data-scroll-target="#creating-noisy-datasets">Creating noisy datasets</a></li>
  <li><a href="#creating-segmented-datasets" id="toc-creating-segmented-datasets" class="nav-link" data-scroll-target="#creating-segmented-datasets">Creating segmented datasets</a></li>
  </ul></li>
  <li><a href="#accesing-the-diffusion-models-from-models_theory" id="toc-accesing-the-diffusion-models-from-models_theory" class="nav-link" data-scroll-target="#accesing-the-diffusion-models-from-models_theory">Accesing the diffusion models from <code>models_theory</code></a></li>
  </ul>
<div class="toc-actions"><div><i class="bi bi-github"></i></div><div class="action-links"><p><a href="https://github.com/AnDiChallenge/andi_datasets/issues/new" class="toc-action">Report an issue</a></p></div></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title d-none d-lg-block">Examples of use of ANDI</h1>
</div>



<div class="quarto-title-meta">

    
    
  </div>
  

</header>

<!-- WARNING: THIS FILE WAS AUTOGENERATED! DO NOT EDIT! -->
<p>*Copyright 2019 by Gorka Munoz-Gil under the MIT license. This file is part of the Anomalous Diffusion (AnDi) Challenge, and is released under the “MIT License Agreement”.</p>
<section id="creating-the-andi-2020-challenge-dataset" class="level2">
<h2 class="anchored" data-anchor-id="creating-the-andi-2020-challenge-dataset">Creating the ANDI 2020 challenge dataset</h2>
<p>Before starting, make sure that you know the details of the competition. You can learn about every in the associated webpage. A quick overview: there are three tasks: 1) inference of the anomalous diffusion exponent, 2) classification of the diffusion model and 3) segmentation of trajectories. For each task, there are three subtasks, one per dimension. To create a dataset for every task and dimension, each e.g.&nbsp;of <span class="math inline">\(N=10\)</span> trajectories, you just need to run</p>
<div class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> andi_datasets.datasets_theory <span class="im">import</span> datasets_theory</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="2">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>AD <span class="op">=</span> datasets_theory()</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>X1, Y1, X2, Y2, X3, Y3 <span class="op">=</span> AD.challenge_2020_dataset(N <span class="op">=</span> <span class="dv">10</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Creating a dataset for task(s) [1, 2, 3] and dimension(s) [1, 2, 3].
Generating dataset for dimension 1.</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>C:\Users\Gorka\anaconda3\lib\site-packages\fbm\fbm.py:171: UserWarning: Combination of increments n and Hurst value H invalid for Davies-Harte method. Reverting to Hosking method. Occurs when n is small and Hurst is close to 1. 
  warnings.warn(</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Generating dataset for dimension 2.
Generating dataset for dimension 3.</code></pre>
</div>
</div>
<p><code>X1</code>, <code>X2</code> and <code>X3</code> correspond to the trajectories of Task 1, 2 and 3, respectively, while <code>Y1</code>, <code>Y2</code> and <code>Y_3</code> correspond to the labels. Each of these list contains three list, each one containing the trajectories for each dimension, in ascending order. For example, <code>X2[2]</code> contains the trajectories for Task 2 for dimension 3. If you only want to generate trajectories for a specific Task and dimensions, you can specify it as</p>
<div class="cell" data-execution_count="4">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>X1, Y1, X2, Y2, X3, Y3 <span class="op">=</span> AD.challenge_2020_dataset(N <span class="op">=</span> <span class="dv">10</span>, tasks <span class="op">=</span> <span class="dv">1</span>, dimensions <span class="op">=</span> <span class="dv">3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Creating a dataset for task(s) 1 and dimension(s) 3.
Generating dataset for dimension 3.</code></pre>
</div>
</div>
<p>In this case <strong>all the lists but the ones specified will be empty.</strong> For example:</p>
<div class="cell" data-execution_count="5">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">'Task 3, dimension 1 is empty: len(X3[0]) = '</span><span class="op">+</span> <span class="bu">str</span>(<span class="bu">len</span>(X3[<span class="dv">0</span>])))</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">'But Task 1, dimension 3 has our 10 trajectories: len(X1[2]) = '</span><span class="op">+</span><span class="bu">str</span>(<span class="bu">len</span>(X1[<span class="dv">2</span>])))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Task 3, dimension 1 is empty: len(X3[0]) = 0
But Task 1, dimension 3 has our 10 trajectories: len(X1[2]) = 10</code></pre>
</div>
</div>
<p>To avoiding having to create a dataset every time we want to use it, you can use the option <code>save_dataset</code>, which will save a file for every dataset of trajectories (named task1.txt, task2.txt and task3.txt) and their corresponding labels (named ref1.txt, ref2.txt and ref3.txt). The first column of each file corresponds to the dimension of the trajectory.</p>
<div class="cell" data-execution_count="6">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>X1, Y1, X2, Y2, X3, Y3 <span class="op">=</span> AD.challenge_2020_dataset(N <span class="op">=</span> <span class="dv">10</span>, save_dataset <span class="op">=</span> <span class="va">True</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Creating a dataset for task(s) [1, 2, 3] and dimension(s) [1, 2, 3].
Generating dataset for dimension 1.</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>C:\Users\Gorka\anaconda3\lib\site-packages\fbm\fbm.py:171: UserWarning: Combination of increments n and Hurst value H invalid for Davies-Harte method. Reverting to Hosking method. Occurs when n is small and Hurst is close to 1. 
  warnings.warn(</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Generating dataset for dimension 2.
Generating dataset for dimension 3.</code></pre>
</div>
</div>
<p>Now that we saved the dataset, we can load it with the option <code>load_dataset</code>:</p>
<div class="cell" data-execution_count="8">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>X1, Y1, X2, Y2, X3, Y3 <span class="op">=</span> AD.challenge_2020_dataset(N <span class="op">=</span> <span class="dv">10</span>, load_dataset <span class="op">=</span> <span class="va">True</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Creating a dataset for task(s) [1, 2, 3] and dimension(s) [1, 2, 3].</code></pre>
</div>
</div>
<p>Take into account that if you saved <span class="math inline">\(N=10\)</span> trajectories, you will only be able to load this 10, even if you ask for <span class="math inline">\(N=20\)</span>.</p>
<p>By default, the trajectories in this dataset will have a maximum length of 1000 steps and a minimum length of 10. To change that, you can use the options <code>max_T</code> and <code>min_T</code>. Take into account that you will need trajectories of 200 steps for task 3. Shorter trajectories will raise an error.</p>
<div class="cell" data-execution_count="9">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>X1, Y1, X2, Y2, X3, Y3 <span class="op">=</span> AD.challenge_2020_dataset(N <span class="op">=</span> <span class="dv">10</span>, min_T <span class="op">=</span> <span class="dv">15</span>, max_T <span class="op">=</span> <span class="dv">200</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Creating a dataset for task(s) [1, 2, 3] and dimension(s) [1, 2, 3].
Generating dataset for dimension 1.
Generating dataset for dimension 2.
Generating dataset for dimension 3.</code></pre>
</div>
</div>
<p>The rests of the optional inputs of the function (<code>load_trajectories</code>, <code>save_trajectories</code>, <code>N_save</code> and <code>t_save</code>) refer to the saving/loading of the trajectories used to generate the datasets, in <code>numpy</code> format. See Section 2 for more details on this.</p>
</section>
<section id="creating-trajectories-from-theoretical-models" class="level2">
<h2 class="anchored" data-anchor-id="creating-trajectories-from-theoretical-models">Creating trajectories from theoretical models</h2>
<p>For this, we will the class <code>andi_datasets.datasets_theory</code> class. First, lets import some auxiliary packages:</p>
<div class="cell" data-execution_count="10">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> matplotlib <span class="im">import</span> pyplot <span class="im">as</span> plt</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>First, let’s define the class. One thing we can do is to access the available diffusion models:</p>
<div class="cell" data-execution_count="11">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> andi_datasets.datasets_theory <span class="im">import</span> datasets_theory</span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>AD <span class="op">=</span> datasets_theory()</span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a>AD.avail_models_name</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="11">
<pre><code>['attm', 'ctrw', 'fbm', 'lw', 'sbm']</code></pre>
</div>
</div>
<p>The label asigned to each model is given by its position in the previous list. Now, we will generate a dataset containing <span class="math inline">\(N=2\)</span> trajectories per model and exponent. We will consider anomalous exponents <span class="math inline">\(\alpha = [0.7, 0.9]\)</span> and lenghts <span class="math inline">\(T=5\)</span> from the models <code>attm</code> and <code>fbm</code>.</p>
<div class="cell" data-execution_count="13">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>dataset <span class="op">=</span> AD.create_dataset(T <span class="op">=</span> <span class="dv">4</span>, N_models <span class="op">=</span> <span class="dv">2</span>, exponents <span class="op">=</span> [<span class="fl">0.7</span>, <span class="fl">0.9</span>], models <span class="op">=</span> [<span class="dv">0</span>, <span class="dv">2</span>])</span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(np.<span class="bu">round</span>(dataset,<span class="dv">2</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[[ 0.    0.7   0.    0.3   2.39  3.53]
 [ 0.    0.7   0.   -3.17 -4.17 -4.25]
 [ 0.    0.9   0.    0.98  1.76  0.21]
 [ 0.    0.9   0.    0.88  0.35  0.49]
 [ 2.    0.7   0.   -0.23 -0.89 -1.02]
 [ 2.    0.7   0.    1.06  1.73  1.36]
 [ 2.    0.9   0.    0.   -0.85 -0.84]
 [ 2.    0.9   0.    0.51  0.48  0.27]]</code></pre>
</div>
</div>
<p>Each row corresponds to a trajectory. The first column is the model label, while the second column labels the exponent. The rest of the row is the trajectory. The default dimension for the trajectories is one. We will see later how to create trajectories with more dimensions.</p>
<p>To create datasets of trajectories with higher dimensions, you can use the input <code>dimensions</code>. The trajectories will be outputed as a single row of the dataset matrix. This means that if you create a dataset of trajectories of length <span class="math inline">\(T = 10\)</span> and dimensions 2, the number of columns of the dataset will be 2 (the labels) + <span class="math inline">\(2\cdot 10\)</span> (the trajectory). Here is an example:</p>
<div class="cell" data-execution_count="14">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>dataset <span class="op">=</span> AD.create_dataset(T <span class="op">=</span> <span class="dv">10</span>, N_models <span class="op">=</span> <span class="dv">1</span>, exponents <span class="op">=</span> [<span class="fl">0.7</span>], models <span class="op">=</span> [<span class="dv">2</span>], dimension <span class="op">=</span> <span class="dv">2</span>)</span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(np.<span class="bu">round</span>(dataset[<span class="dv">0</span>], <span class="dv">2</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[ 2.    0.7   0.    0.41 -0.36 -0.49 -0.52 -1.31 -2.24 -2.07 -1.87 -2.09
  0.    0.6   0.61  1.38  1.15  0.73  0.27 -0.02 -0.05  0.16]</code></pre>
</div>
</div>
<div class="cell" data-execution_count="15">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>plt.plot(dataset[<span class="dv">0</span>,<span class="dv">2</span>:<span class="dv">12</span>], dataset[<span class="dv">0</span>, <span class="dv">12</span>:], <span class="st">'-'</span>)</span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>plt.scatter(dataset[<span class="dv">0</span>,<span class="dv">2</span>:<span class="dv">12</span>], dataset[<span class="dv">0</span>,<span class="dv">12</span>:], c<span class="op">=</span>np.arange(<span class="dv">10</span>), s <span class="op">=</span> <span class="dv">250</span>)</span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a>plt.colorbar().set_label(<span class="st">'Time'</span>)<span class="op">;</span> plt.xlabel(<span class="st">'X'</span>)<span class="op">;</span> plt.ylabel(<span class="st">'Y'</span>)<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="challenge_one_datasets_files/figure-html/cell-13-output-1.png" class="img-fluid"></p>
</div>
</div>
<section id="saving-and-loading-datasets" class="level3">
<h3 class="anchored" data-anchor-id="saving-and-loading-datasets">Saving and loading datasets</h3>
<p><code>datasets_theory</code> allows also to save and load datasets, avoiding the need of generate new trajectories each time we want to create a dataset. There exist two optional inputs to the function <code>create_datasets</code>: <code>save_trajectories</code> and <code>load_trajectories</code>, which if <code>True</code>, save and load datasets, respectively. A dataset for each exponent and model considered are saved in a .h5py file whose name is the model considered. Each file contains datasets for each exponent.</p>
<p>In these cases, two important variables take also into play, <code>t_save</code> and <code>N_save</code>. These set the lenght and number of trajectories to save for each exponent and model. They are set as default to <code>t_save</code><span class="math inline">\(=10^3\)</span> and <code>N_save</code><span class="math inline">\(=10^4\)</span> as this allows to create any other combinantion of dataset. See that in the ANDI challenge we will never consider trajectories longer than <span class="math inline">\(T=10^3\)</span>.</p>
<p>The name of the datasets inside the .h5py file is then <code>(exponent)_(t_save)_(N_save)</code>.</p>
<p>Using the default values for this two variables, let’s save datasets for the previous examples:</p>
<div class="cell" data-execution_count="16">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a>dataset <span class="op">=</span> AD.create_dataset(T <span class="op">=</span> <span class="dv">4</span>, N_models <span class="op">=</span> <span class="dv">2</span>, exponents <span class="op">=</span> [<span class="fl">0.7</span>, <span class="fl">0.9</span>], models <span class="op">=</span> [<span class="dv">0</span>, <span class="dv">2</span>], </span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a>                              save_trajectories <span class="op">=</span> <span class="va">True</span>, path <span class="op">=</span> <span class="st">'datasets/'</span>)</span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(np.<span class="bu">round</span>(dataset,<span class="dv">2</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>100%|█████████████████████████████████████████| 1000/1000 [00:01&lt;00:00, 765.72it/s, exponent=0.7, model=attm, saving=1]
100%|█████████████████████████████████████████| 1000/1000 [00:02&lt;00:00, 345.68it/s, exponent=0.9, model=attm, saving=1]
100%|███████████████████████████████████████████| 1000/1000 [00:16&lt;00:00, 60.30it/s, exponent=0.7, model=fbm, saving=1]
100%|███████████████████████████████████████████| 1000/1000 [00:16&lt;00:00, 60.86it/s, exponent=0.9, model=fbm, saving=1]</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>[[ 0.    0.7   0.   -0.61 -0.39 -0.87]
 [ 0.    0.7   0.    0.57  1.12  0.57]
 [ 0.    0.9   0.    1.86  0.67 -0.56]
 [ 0.    0.9   0.   -0.13  0.04 -1.14]
 [ 2.    0.7   0.    0.08  0.17  0.22]
 [ 2.    0.7   0.    0.09  0.14  0.02]
 [ 2.    0.9   0.    0.03  0.02  0.1 ]
 [ 2.    0.9   0.    0.03  0.02 -0.07]]</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code></code></pre>
</div>
</div>
<p>If the datasets were already saved, we can load them instead:</p>
<div class="cell" data-scrolled="true" data-execution_count="17">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a>dataset <span class="op">=</span> AD.create_dataset(T <span class="op">=</span> <span class="dv">4</span>, N_models <span class="op">=</span> <span class="dv">2</span>, exponents <span class="op">=</span> [<span class="fl">0.7</span>, <span class="fl">0.9</span>], models <span class="op">=</span> [<span class="dv">0</span>, <span class="dv">2</span>], </span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a>                              load_trajectories <span class="op">=</span> <span class="va">True</span>, path <span class="op">=</span> <span class="st">'datasets/'</span>)</span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(np.<span class="bu">round</span>(dataset,<span class="dv">2</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[[ 0.    0.7   0.   -0.61 -0.39 -0.87]
 [ 0.    0.7   0.    0.57  1.12  0.57]
 [ 0.    0.9   0.    1.86  0.67 -0.56]
 [ 0.    0.9   0.   -0.13  0.04 -1.14]
 [ 2.    0.7   0.    0.08  0.17  0.22]
 [ 2.    0.7   0.    0.09  0.14  0.02]
 [ 2.    0.9   0.    0.03  0.02  0.1 ]
 [ 2.    0.9   0.    0.03  0.02 -0.07]]</code></pre>
</div>
</div>
</section>
<section id="creating-noisy-datasets" class="level3">
<h3 class="anchored" data-anchor-id="creating-noisy-datasets">Creating noisy datasets</h3>
<p>There are two ways of adding noise to the trajectories: either by varying their diffusion coefficient or by adding noise to each of the trahectory’s points. You can do it with the functions <code>create_noisy_diffusion_dataset</code> or <code>create_noisy_localization_dataset</code>, respectively. These functions allow to either create a new dataset to which we will add the noise or give as input the dataset. We will use now the dataset we created in previous cells.</p>
<p><strong>Noisy diffusion coefficients</strong> The function <code>create_noisy_diffusion_dataset</code> changes the diffusion coefficient of a given trajectory. This function works similarly to <code>create_dataset</code>, but has as optional input <code>diffusion_coefficients</code>. You can use this variable to change the diffusion coefficient of the input trajectories at your please. If you don’t give an input to it, they will be drawn randomly from a Gaussian distribution with variance 1. See that, as <span class="math inline">\(D\)</span> may be negative, the trajectories can be reversed.</p>
<div class="cell" data-execution_count="23">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a>dataset_noise_D <span class="op">=</span> AD.create_noisy_diffusion_dataset(dataset.copy(), T <span class="op">=</span> <span class="dv">4</span>)</span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-4"><a href="#cb32-4" aria-hidden="true" tabindex="-1"></a>plt.plot(dataset[<span class="dv">1</span>,<span class="dv">2</span>:],<span class="st">'o-'</span>, label <span class="op">=</span> <span class="st">'Original trajectory'</span>)</span>
<span id="cb32-5"><a href="#cb32-5" aria-hidden="true" tabindex="-1"></a>plt.plot(dataset_noise_D[<span class="dv">1</span>,<span class="dv">2</span>:],<span class="st">'o-'</span>, label <span class="op">=</span> <span class="vs">r'Trajectory with changed $D$'</span>)</span>
<span id="cb32-6"><a href="#cb32-6" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">'Time'</span>)<span class="op">;</span> plt.ylabel(<span class="st">'Position'</span>)</span>
<span id="cb32-7"><a href="#cb32-7" aria-hidden="true" tabindex="-1"></a>plt.legend()<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="challenge_one_datasets_files/figure-html/cell-16-output-1.png" class="img-fluid"></p>
</div>
</div>
<p><strong>Localization noise</strong> The class also allows to create noisy trajectories via <code>create_noisy_localization_dataset</code>. This functions works as <code>create_dataset</code> but has three extra optional input parameters: <code>noise_func</code>, <code>sigma</code> and <code>mu</code>. If <code>noise_func</code> is <code>False</code>, the function generates a dataset with Gaussian noise with variance <code>sigma</code> and mean <code>mu</code>. Keep in mind that the function will never save noisy trajectories. The saved/loaded trajectories will never have noise, which will be added a posteriori. Here is an example with Gaussian noise:</p>
<div class="cell" data-execution_count="19">
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="co"># The default value of noise_func is False, so we don't need to input it. </span></span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Default value of sigma is 1 and mu is 0.</span></span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a>dataset_noisy <span class="op">=</span> AD.create_noisy_localization_dataset(dataset.copy(), T <span class="op">=</span> <span class="dv">4</span>)</span>
<span id="cb33-4"><a href="#cb33-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-5"><a href="#cb33-5" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(np.<span class="bu">round</span>(dataset_noisy,<span class="dv">2</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[[ 0.    0.7  -1.71 -0.34 -1.22 -0.67]
 [ 0.    0.7   0.1   0.96  1.21  1.15]
 [ 0.    0.9  -0.7  -0.24  0.89 -0.79]
 [ 0.    0.9   0.19 -1.05 -0.25 -1.59]
 [ 2.    0.7   0.85  0.66 -1.11 -0.12]
 [ 2.    0.7  -1.35  0.33 -1.5   0.25]
 [ 2.    0.9  -0.36 -1.41 -0.95 -1.09]
 [ 2.    0.9   0.19 -1.19  0.96 -1.21]]</code></pre>
</div>
</div>
<div class="cell" data-execution_count="24">
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a>plt.plot(dataset[<span class="dv">1</span>,<span class="dv">2</span>:],<span class="st">'o-'</span>, label <span class="op">=</span> <span class="st">'Original trajectory'</span>)</span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a>plt.plot(dataset_noisy[<span class="dv">1</span>,<span class="dv">2</span>:],<span class="st">'o-'</span>, label <span class="op">=</span> <span class="st">'Trajectory + Gaussian noise'</span>)</span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a>plt.legend()<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="challenge_one_datasets_files/figure-html/cell-18-output-1.png" class="img-fluid"></p>
</div>
</div>
<p>You can also define your own noise function. The noise created by this functions will be added to each of the trajectories of the dataset. The ouput must be a matrix of size given as input:</p>
<div class="cell" data-execution_count="27">
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Uniformly distributed noise</span></span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> uniform_noise(N, M):</span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> np.random.rand(N, M)<span class="op">*</span>(<span class="dv">2</span><span class="op">*</span>np.random.randint(<span class="dv">2</span>, size <span class="op">=</span> (N, M))<span class="op">-</span><span class="dv">1</span>) </span>
<span id="cb36-4"><a href="#cb36-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-5"><a href="#cb36-5" aria-hidden="true" tabindex="-1"></a>dataset_uniform <span class="op">=</span> AD.create_noisy_localization_dataset(dataset.copy(), T <span class="op">=</span> <span class="dv">4</span>, </span>
<span id="cb36-6"><a href="#cb36-6" aria-hidden="true" tabindex="-1"></a>                                                       noise_func<span class="op">=</span>uniform_noise)</span>
<span id="cb36-7"><a href="#cb36-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-8"><a href="#cb36-8" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(np.<span class="bu">round</span>(dataset_uniform,<span class="dv">2</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[[ 0.    0.7   0.63 -1.41  0.13 -1.21]
 [ 0.    0.7  -0.49  1.54  1.72  0.66]
 [ 0.    0.9   0.6   1.7   0.27 -0.07]
 [ 0.    0.9  -0.15  0.7   0.08 -1.59]
 [ 2.    0.7   0.84 -0.02 -0.25  0.04]
 [ 2.    0.7  -0.14 -0.39  1.01 -0.61]
 [ 2.    0.9  -0.86  0.83 -0.32 -0.35]
 [ 2.    0.9   0.72 -0.9   0.88 -0.21]]</code></pre>
</div>
</div>
<div class="cell" data-execution_count="28">
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a>plt.plot(dataset[<span class="dv">1</span>,<span class="dv">2</span>:],<span class="st">'o-'</span>, label <span class="op">=</span> <span class="st">'Original trajectory'</span>)</span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a>plt.plot(dataset_noisy[<span class="dv">1</span>,<span class="dv">2</span>:],<span class="st">'o-'</span>, label <span class="op">=</span> <span class="st">'Trajectory + Gaussian noise'</span>)</span>
<span id="cb38-3"><a href="#cb38-3" aria-hidden="true" tabindex="-1"></a>plt.plot(dataset_uniform[<span class="dv">1</span>,<span class="dv">2</span>:],<span class="st">'o-'</span>, label <span class="op">=</span> <span class="st">'Trajectory + uniform noise'</span>)</span>
<span id="cb38-4"><a href="#cb38-4" aria-hidden="true" tabindex="-1"></a>plt.legend()<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="challenge_one_datasets_files/figure-html/cell-20-output-1.png" class="img-fluid"></p>
</div>
</div>
</section>
<section id="creating-segmented-datasets" class="level3">
<h3 class="anchored" data-anchor-id="creating-segmented-datasets">Creating segmented datasets</h3>
<p>The class <code>datasets_theory</code> also allows to create trajectories which are made of two different diffusion models or anomalous exponent, at a given changing point. Such function has the name <code>create_segmented_dataset</code>. Following the ANDI challenge guidelines, the output trajectories will have length 200. However, you can choose an arbitrary length with the variable <code>final_length</code>. The input datasets must have at least the same size as <code>final_length</code>. There is also the option to randomly shuffle the input datasets from which the segmented output dataset will be generate, throught the variable <code>random_shuffle</code>.</p>
<div class="cell" data-execution_count="30">
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a><span class="co"># First we define two datasets. Let's take same anomalous exponent but various models</span></span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a>dataset1 <span class="op">=</span> AD.create_dataset(T <span class="op">=</span> <span class="dv">200</span>, N_models <span class="op">=</span> <span class="dv">2</span>, exponents <span class="op">=</span> [<span class="fl">0.7</span>], models <span class="op">=</span> [<span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">4</span>])</span>
<span id="cb39-3"><a href="#cb39-3" aria-hidden="true" tabindex="-1"></a>dataset2 <span class="op">=</span> AD.create_dataset(T <span class="op">=</span> <span class="dv">200</span>, N_models <span class="op">=</span> <span class="dv">2</span>, exponents <span class="op">=</span> [<span class="fl">0.7</span>], models <span class="op">=</span> [<span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">4</span>])</span>
<span id="cb39-4"><a href="#cb39-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Now we give them to the desired function</span></span>
<span id="cb39-5"><a href="#cb39-5" aria-hidden="true" tabindex="-1"></a>seg <span class="op">=</span> AD.create_segmented_dataset(dataset1, dataset2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The first 5 elements of every row of the variable <code>seg</code> label the trajectory. First point is the changing time, second and third, and fourth and fifthe are the labels of the model and exponent of the input trajectories, respectevely.</p>
<div class="cell" data-execution_count="31">
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a>seg[:, :<span class="dv">5</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="31">
<pre><code>array([[ 13. ,   0. ,   0.7,   0. ,   0.7],
       [ 97. ,   0. ,   0.7,   0. ,   0.7],
       [124. ,   1. ,   0.7,   1. ,   0.7],
       [133. ,   1. ,   0.7,   1. ,   0.7],
       [192. ,   2. ,   0.7,   2. ,   0.7],
       [171. ,   2. ,   0.7,   2. ,   0.7],
       [117. ,   4. ,   0.7,   4. ,   0.7],
       [151. ,   4. ,   0.7,   4. ,   0.7]])</code></pre>
</div>
</div>
<p>As we did not shuffle data and <code>dataset1</code> and <code>dataset2</code> have the trajectories ordered by model, there are no mixes between different models. This can be done thanks to the <code>random_shuffle</code> variable:</p>
<div class="cell" data-execution_count="38">
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a>seg <span class="op">=</span> AD.create_segmented_dataset(dataset1, dataset2, random_shuffle <span class="op">=</span> <span class="va">True</span>)</span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a>seg[:, :<span class="dv">5</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="38">
<pre><code>array([[179. ,   2. ,   0.7,   0. ,   0.7],
       [188. ,   4. ,   0.7,   2. ,   0.7],
       [176. ,   0. ,   0.7,   0. ,   0.7],
       [142. ,   0. ,   0.7,   1. ,   0.7],
       [185. ,   4. ,   0.7,   2. ,   0.7],
       [179. ,   1. ,   0.7,   4. ,   0.7],
       [167. ,   1. ,   0.7,   1. ,   0.7],
       [116. ,   2. ,   0.7,   4. ,   0.7]])</code></pre>
</div>
</div>
<div class="cell" data-execution_count="39">
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a>plt.plot(seg[<span class="dv">0</span>,<span class="dv">5</span>:], label <span class="op">=</span> <span class="st">'Model 1 = '</span><span class="op">+</span>AD.avail_models_name[<span class="bu">int</span>(seg[<span class="dv">0</span>, <span class="dv">1</span>])]<span class="op">+</span><span class="st">', Model 2 = '</span><span class="op">+</span>AD.avail_models_name[<span class="bu">int</span>(seg[<span class="dv">0</span>, <span class="dv">3</span>])])</span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a>plt.axvline(seg[<span class="dv">0</span>,<span class="dv">0</span>], c <span class="op">=</span> <span class="st">'C1'</span>, ls <span class="op">=</span> <span class="st">'--'</span>, label <span class="op">=</span> <span class="st">'Changing point'</span>)</span>
<span id="cb44-3"><a href="#cb44-3" aria-hidden="true" tabindex="-1"></a>plt.legend()<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="challenge_one_datasets_files/figure-html/cell-24-output-1.png" class="img-fluid"></p>
</div>
</div>
</section>
</section>
<section id="accesing-the-diffusion-models-from-models_theory" class="level2">
<h2 class="anchored" data-anchor-id="accesing-the-diffusion-models-from-models_theory">Accesing the diffusion models from <code>models_theory</code></h2>
<p>All the theoretical diffusion models available in <code>andi</code> are collected in the class <code>models_theory()</code>. We can access them with a simple import :</p>
<div class="cell" data-execution_count="41">
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> andi.models_theory <span class="im">import</span> models_theory</span>
<span id="cb45-2"><a href="#cb45-2" aria-hidden="true" tabindex="-1"></a><span class="co"># We will also need the following libraries</span></span>
<span id="cb45-3"><a href="#cb45-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> inspect</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>There exist three subclasses, one for each dimensions. To see the available models for each dimension, you can use the following:</p>
<div class="cell" data-execution_count="43">
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> dimensions <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">3</span>):</span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> dimensions <span class="op">==</span> <span class="dv">0</span>:</span>
<span id="cb46-3"><a href="#cb46-3" aria-hidden="true" tabindex="-1"></a>        models <span class="op">=</span> models_theory()._oneD()</span>
<span id="cb46-4"><a href="#cb46-4" aria-hidden="true" tabindex="-1"></a>    <span class="cf">elif</span> dimensions <span class="op">==</span> <span class="dv">1</span>:</span>
<span id="cb46-5"><a href="#cb46-5" aria-hidden="true" tabindex="-1"></a>        models <span class="op">=</span> models_theory()._twoD()</span>
<span id="cb46-6"><a href="#cb46-6" aria-hidden="true" tabindex="-1"></a>    <span class="cf">elif</span> dimensions <span class="op">==</span> <span class="dv">2</span>:</span>
<span id="cb46-7"><a href="#cb46-7" aria-hidden="true" tabindex="-1"></a>        models <span class="op">=</span> models_theory()._threeD()</span>
<span id="cb46-8"><a href="#cb46-8" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb46-9"><a href="#cb46-9" aria-hidden="true" tabindex="-1"></a>    available_models <span class="op">=</span> inspect.getmembers(models, inspect.ismethod)</span>
<span id="cb46-10"><a href="#cb46-10" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb46-11"><a href="#cb46-11" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">'</span><span class="ch">\n</span><span class="st">The availailabe models for dimension '</span><span class="op">+</span><span class="bu">str</span>(dimensions<span class="op">+</span><span class="dv">1</span>)<span class="op">+</span><span class="st">' are:'</span>)</span>
<span id="cb46-12"><a href="#cb46-12" aria-hidden="true" tabindex="-1"></a>    [<span class="bu">print</span>(<span class="st">'- '</span><span class="op">+</span>x[<span class="dv">0</span>]) <span class="cf">for</span> x <span class="kw">in</span> available_models]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
The availailabe models for dimension 1 are:
- attm
- ctrw
- fbm
- lw
- sbm

The availailabe models for dimension 2 are:
- attm
- ctrw
- fbm
- lw
- sbm

The availailabe models for dimension 3 are:
- attm
- ctrw
- fbm
- lw
- sbm</code></pre>
</div>
</div>
<p><strong>One dimensional trajectories</strong></p>
<p>For this example, we will create a trajectory of a 1D continuous time random walk (ctrw). All the model functions must have as inputs the length of the trajectories and the anomalous exponent <span class="math inline">\(\alpha\)</span>:</p>
<div class="cell" data-execution_count="45">
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a>oneD <span class="op">=</span> models_theory()._oneD()</span>
<span id="cb48-2"><a href="#cb48-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-3"><a href="#cb48-3" aria-hidden="true" tabindex="-1"></a>traj <span class="op">=</span> oneD.ctrw(T <span class="op">=</span> <span class="dv">100</span>, alpha <span class="op">=</span> <span class="fl">0.8</span>)</span>
<span id="cb48-4"><a href="#cb48-4" aria-hidden="true" tabindex="-1"></a>plt.plot(traj)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="challenge_one_datasets_files/figure-html/cell-27-output-1.png" class="img-fluid"></p>
</div>
</div>
<p>Some diffusion models are constructed from a collection of positions at different sampling times. This means that their output array does not have <span class="math inline">\(T\)</span> points, but rather number <span class="math inline">\(m\)</span> of sampled posisition. In order to acces such kind of information, some model generators have the optional parameter <code>regulare_time</code>, which if <code>False</code>, makes the function to return an array with two rows and <span class="math inline">\(m\)</span> columns. The first row are the sampling times and the second are the positions. CTRW is an example of these models:</p>
<div class="cell" data-execution_count="49">
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a>traj_nonR <span class="op">=</span> oneD.ctrw(T <span class="op">=</span> <span class="dv">100</span>, alpha <span class="op">=</span> <span class="fl">0.8</span>, regular_time <span class="op">=</span> <span class="va">False</span>)</span>
<span id="cb49-2"><a href="#cb49-2" aria-hidden="true" tabindex="-1"></a>traj_nonR.shape</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="49">
<pre><code>(2, 10)</code></pre>
</div>
</div>
<p>If <code>regulare_time = True</code> (default value), the trajectory is fed to the function <code>regularize</code> from <code>utils_trajectories</code>, which transforms the trajectory to regular sampling times. Below is an example with the previously defined trajectory. The offset is due to the need of rounding the times coming from the variable <code>traj_nonR[1]</code>.</p>
<div class="cell" data-execution_count="50">
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> andi.utils_trajectories <span class="im">import</span> regularize</span>
<span id="cb51-2"><a href="#cb51-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-3"><a href="#cb51-3" aria-hidden="true" tabindex="-1"></a>traj_R <span class="op">=</span> regularize(positions <span class="op">=</span> traj_nonR[<span class="dv">1</span>,:], times <span class="op">=</span> traj_nonR[<span class="dv">0</span>, :], T <span class="op">=</span> <span class="dv">100</span>)</span>
<span id="cb51-4"><a href="#cb51-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-5"><a href="#cb51-5" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots()</span>
<span id="cb51-6"><a href="#cb51-6" aria-hidden="true" tabindex="-1"></a>ax.scatter(traj_nonR[<span class="dv">0</span>,:], traj_nonR[<span class="dv">1</span>, :], c <span class="op">=</span> <span class="st">'C0'</span>, label <span class="op">=</span> <span class="st">'Irregular sampling'</span>)</span>
<span id="cb51-7"><a href="#cb51-7" aria-hidden="true" tabindex="-1"></a>ax.plot(traj_R, c <span class="op">=</span> <span class="st">'C1'</span>, label <span class="op">=</span> <span class="st">'Regularized sampling'</span>)</span>
<span id="cb51-8"><a href="#cb51-8" aria-hidden="true" tabindex="-1"></a>ax.set_xlabel(<span class="st">'Positions'</span>)<span class="op">;</span> ax.set_ylabel(<span class="st">'Time'</span>)<span class="op">;</span> ax.axvline(<span class="dv">100</span>,ls <span class="op">=</span> <span class="st">'--'</span>, c <span class="op">=</span> <span class="st">'C2'</span>)</span>
<span id="cb51-9"><a href="#cb51-9" aria-hidden="true" tabindex="-1"></a>ax.legend()<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="challenge_one_datasets_files/figure-html/cell-29-output-1.png" class="img-fluid"></p>
</div>
</div>
<p><strong>Two dimensional trajectories</strong></p>
<p>We will proceed with an example of a 2D trajectory coming from the ATTM model. 2D trajectories are output as an array of length <span class="math inline">\(2\times T\)</span>.</p>
<div class="cell" data-execution_count="52">
<div class="sourceCode cell-code" id="cb52"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a>T <span class="op">=</span> <span class="dv">20</span></span>
<span id="cb52-2"><a href="#cb52-2" aria-hidden="true" tabindex="-1"></a>traj <span class="op">=</span> models_theory()._twoD().attm(T <span class="op">=</span> T, alpha <span class="op">=</span> <span class="fl">0.8</span>)</span>
<span id="cb52-3"><a href="#cb52-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(traj.shape)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>(40,)</code></pre>
</div>
</div>
<div class="cell" data-execution_count="53">
<div class="sourceCode cell-code" id="cb54"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> mpl_toolkits.mplot3d <span class="im">import</span> Axes3D</span>
<span id="cb54-2"><a href="#cb54-2" aria-hidden="true" tabindex="-1"></a>fig <span class="op">=</span> plt.figure(figsize <span class="op">=</span> (<span class="dv">6</span>,<span class="dv">5</span>))</span>
<span id="cb54-3"><a href="#cb54-3" aria-hidden="true" tabindex="-1"></a>ax <span class="op">=</span> fig.gca(projection<span class="op">=</span><span class="st">'3d'</span>)</span>
<span id="cb54-4"><a href="#cb54-4" aria-hidden="true" tabindex="-1"></a>ax.plot(traj[:T], traj[T:], np.arange(T))</span>
<span id="cb54-5"><a href="#cb54-5" aria-hidden="true" tabindex="-1"></a>scat <span class="op">=</span> ax.scatter3D(traj[:T], traj[T:], np.arange(T), c<span class="op">=</span>np.arange(T), s <span class="op">=</span> <span class="dv">250</span>)<span class="op">;</span></span>
<span id="cb54-6"><a href="#cb54-6" aria-hidden="true" tabindex="-1"></a>ax.set_xlabel(<span class="st">'Position X'</span>)</span>
<span id="cb54-7"><a href="#cb54-7" aria-hidden="true" tabindex="-1"></a>ax.set_ylabel(<span class="st">'Position Y'</span>)</span>
<span id="cb54-8"><a href="#cb54-8" aria-hidden="true" tabindex="-1"></a>ax.set_zlabel(<span class="st">'Time'</span>)</span>
<span id="cb54-9"><a href="#cb54-9" aria-hidden="true" tabindex="-1"></a>ax.xaxis.set_ticklabels([])</span>
<span id="cb54-10"><a href="#cb54-10" aria-hidden="true" tabindex="-1"></a>ax.yaxis.set_ticklabels([])</span>
<span id="cb54-11"><a href="#cb54-11" aria-hidden="true" tabindex="-1"></a>ax.zaxis.set_ticklabels([])</span>
<span id="cb54-12"><a href="#cb54-12" aria-hidden="true" tabindex="-1"></a>plt.tight_layout()<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="challenge_one_datasets_files/figure-html/cell-31-output-1.png" class="img-fluid"></p>
</div>
</div>
<p><strong>Ensemble averages of <code>diffusion_models</code> trajectories</strong></p>
<p>In the ANDI challenge, one of the parameters to be extracted is the anomalous exponent <span class="math inline">\(\alpha\)</span>. This exponents corresponds to the proportionality relation between the mean squared displacement averaged over <span class="math inline">\(N\)</span> trajectories (eMSD) and time: <span class="math inline">\(\left&lt; x^2(t) \right&gt;\sim t^\alpha\)</span>. Here are a series of examples of eMSD calculated for various models:</p>
<p><em>(If your viewer does not allow you to see the following images, you can see them in the folder <code>figures/</code>)</em></p>
<p><em>Subdiffusive trajectories:</em></p>
<p><img src="../figures/eMSD_0.8.png" width="600"></p>
<p><em>Superdiffusive trajectories:</em></p>
<p><img src="../figures/eMSD_1.4.png" width="600"></p>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    setTimeout(function() {
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const cites = ref.parentNode.getAttribute('data-cites').split(' ');
    tippyHover(ref, function() {
      var popup = window.document.createElement('div');
      cites.forEach(function(cite) {
        var citeDiv = window.document.createElement('div');
        citeDiv.classList.add('hanging-indent');
        citeDiv.classList.add('csl-entry');
        var biblioDiv = window.document.getElementById('ref-' + cite);
        if (biblioDiv) {
          citeDiv.innerHTML = biblioDiv.innerHTML;
        }
        popup.appendChild(citeDiv);
      });
      return popup.innerHTML;
    });
  }
});
</script>
</div> <!-- /content -->



</body></html>