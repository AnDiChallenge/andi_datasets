<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.1.251">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>andi_datasets - Help functions</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1.6em;
  vertical-align: middle;
}
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<script src="../site_libs/quarto-html/quarto.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" integrity="sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" crossorigin="anonymous"></script>
<script type="application/javascript">define('jquery', [],function() {return window.jQuery;})</script>
<script src="https://unpkg.com/@jupyter-widgets/html-manager@*/dist/embed-amd.js" crossorigin="anonymous"></script>

  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<meta property="og:title" content="andi_datasets - Help functions">
<meta property="og:description" content="source">
<meta property="og:site-name" content="andi_datasets">
<meta name="twitter:title" content="andi_datasets - Help functions">
<meta name="twitter:description" content="source">
<meta name="twitter:card" content="summary">
</head>

<body class="nav-sidebar docked nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a href="../index.html" class="navbar-brand navbar-brand-logo">
    <img src="../figures/logo_noname.svg" alt="" class="navbar-logo">
    </a>
    <a class="navbar-brand" href="../index.html">
    <span class="navbar-title">andi_datasets</span>
    </a>
  </div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link active" href="../lib_nbs/index_docs.html" aria-current="page">Documentation</a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../tutorials/index_tutorials.html">Tutorials</a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="https://andi-app.herokuapp.com/andi_app">ANDI interactive tool</a>
  </li>  
</ul>
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/andichallenge/andi_datasets"><i class="bi bi-github" role="img">
</i> 
 </a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://twitter.com/AndiChallenge"><i class="bi bi-twitter" role="img">
</i> 
 </a>
  </li>  
</ul>
              <div id="quarto-search" class="" title="Search"></div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav>
  <nav class="quarto-secondary-nav" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
    <div class="container-fluid d-flex justify-content-between">
      <h1 class="quarto-secondary-nav-title">Help functions</h1>
      <button type="button" class="quarto-btn-toggle btn" aria-label="Show secondary navigation">
        <i class="bi bi-chevron-right"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse sidebar-navigation docked overflow-auto">
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="../lib_nbs/index_docs.html" class="sidebar-item-text sidebar-link">Documentation</a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="false">Theory datasets</a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="false">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth2 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../lib_nbs/models_theory.html" class="sidebar-item-text sidebar-link"><code>models_theory</code></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../lib_nbs/datasets_theory.html" class="sidebar-item-text sidebar-link"><code>datasets_theory</code></a>
  </div>
</li>
      </ul>
  </li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" aria-expanded="false">Phenomenological datasets</a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" aria-expanded="false">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth2 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../lib_nbs/models_phenom.html" class="sidebar-item-text sidebar-link"><code>models_phenom</code></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../lib_nbs/datasets_phenom.html" class="sidebar-item-text sidebar-link"><code>datasets_phenom</code></a>
  </div>
</li>
      </ul>
  </li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" aria-expanded="true">ANDI challenge datasets</a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" aria-expanded="true">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-4" class="collapse list-unstyled sidebar-section depth2 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../lib_nbs/datasets_challenge.html" class="sidebar-item-text sidebar-link">datasets_challenge</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../lib_nbs/utils_challenge.html" class="sidebar-item-text sidebar-link active">Help functions</a>
  </div>
</li>
      </ul>
  </li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" aria-expanded="false">Trajectory analysis</a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" aria-expanded="false">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-5" class="collapse list-unstyled sidebar-section depth2 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../lib_nbs/analysis.html" class="sidebar-item-text sidebar-link">analysis</a>
  </div>
</li>
      </ul>
  </li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-6" aria-expanded="false">Helpers</a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-6" aria-expanded="false">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-6" class="collapse list-unstyled sidebar-section depth2 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../lib_nbs/utils_trajectories.html" class="sidebar-item-text sidebar-link">utils_trajectories</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../lib_nbs/utils_videos.html" class="sidebar-item-text sidebar-link">utils_videos</a>
  </div>
</li>
      </ul>
  </li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="../tutorials/index_tutorials.html" class="sidebar-item-text sidebar-link">Tutorials</a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-7" aria-expanded="false">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-7" class="collapse list-unstyled sidebar-section depth1 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../tutorials/challenge_one_datasets.html" class="sidebar-item-text sidebar-link">Theory models and AnDi 2020</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../tutorials/challenge_one_submission.html" class="sidebar-item-text sidebar-link">ANDI 2020 submission: from trajectories to predictions</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../tutorials/challenge_two_datasets.html" class="sidebar-item-text sidebar-link">Phenom models and ANDI 2022</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../tutorials/creating_videos_phenom.html" class="sidebar-item-text sidebar-link">Creating videos tutorial</a>
  </div>
</li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#managing-data" id="toc-managing-data" class="nav-link active" data-scroll-target="#managing-data">Managing data</a>
  <ul class="collapse">
  <li><a href="#smoothing-labels" id="toc-smoothing-labels" class="nav-link" data-scroll-target="#smoothing-labels">Smoothing labels</a>
  <ul class="collapse">
  <li><a href="#label_filter" id="toc-label_filter" class="nav-link" data-scroll-target="#label_filter">label_filter</a></li>
  <li><a href="#majority_filter" id="toc-majority_filter" class="nav-link" data-scroll-target="#majority_filter">majority_filter</a></li>
  <li><a href="#new-population-percentages-after-filtering" id="toc-new-population-percentages-after-filtering" class="nav-link" data-scroll-target="#new-population-percentages-after-filtering">New population percentages after filtering</a></li>
  </ul></li>
  <li><a href="#continuous-labels-to-list-of-features" id="toc-continuous-labels-to-list-of-features" class="nav-link" data-scroll-target="#continuous-labels-to-list-of-features">Continuous labels to list of features</a>
  <ul class="collapse">
  <li><a href="#label_continuous_to_list" id="toc-label_continuous_to_list" class="nav-link" data-scroll-target="#label_continuous_to_list">label_continuous_to_list</a></li>
  </ul></li>
  <li><a href="#list-of-features-to-continuous-labels" id="toc-list-of-features-to-continuous-labels" class="nav-link" data-scroll-target="#list-of-features-to-continuous-labels">List of features to continuous labels</a>
  <ul class="collapse">
  <li><a href="#label_list_to_continuous" id="toc-label_list_to_continuous" class="nav-link" data-scroll-target="#label_list_to_continuous">label_list_to_continuous</a></li>
  </ul></li>
  <li><a href="#storing-array-data-in-dataframe" id="toc-storing-array-data-in-dataframe" class="nav-link" data-scroll-target="#storing-array-data-in-dataframe">Storing array data in dataframe</a>
  <ul class="collapse">
  <li><a href="#array_to_df" id="toc-array_to_df" class="nav-link" data-scroll-target="#array_to_df">array_to_df</a></li>
  </ul></li>
  <li><a href="#transform-andi-dataframe-to-array-with-padding" id="toc-transform-andi-dataframe-to-array-with-padding" class="nav-link" data-scroll-target="#transform-andi-dataframe-to-array-with-padding">Transform ANDI dataframe to array with padding</a>
  <ul class="collapse">
  <li><a href="#df_to_array" id="toc-df_to_array" class="nav-link" data-scroll-target="#df_to_array">df_to_array</a></li>
  </ul></li>
  </ul></li>
  <li><a href="#isolate-vip-particles" id="toc-isolate-vip-particles" class="nav-link" data-scroll-target="#isolate-vip-particles">Isolate VIP particles</a>
  <ul class="collapse">
  <li><a href="#get_vip" id="toc-get_vip" class="nav-link" data-scroll-target="#get_vip">get_VIP</a></li>
  </ul></li>
  <li><a href="#challenge-2022-metrics" id="toc-challenge-2022-metrics" class="nav-link" data-scroll-target="#challenge-2022-metrics">Challenge 2022 metrics</a>
  <ul class="collapse">
  <li><a href="#changepoint-pairing" id="toc-changepoint-pairing" class="nav-link" data-scroll-target="#changepoint-pairing">Changepoint pairing</a>
  <ul class="collapse">
  <li><a href="#changepoint_assignment" id="toc-changepoint_assignment" class="nav-link" data-scroll-target="#changepoint_assignment">changepoint_assignment</a></li>
  <li><a href="#changepoint_alpha_beta" id="toc-changepoint_alpha_beta" class="nav-link" data-scroll-target="#changepoint_alpha_beta">changepoint_alpha_beta</a></li>
  <li><a href="#jaccard_index" id="toc-jaccard_index" class="nav-link" data-scroll-target="#jaccard_index">jaccard_index</a></li>
  <li><a href="#single_changepoint_error" id="toc-single_changepoint_error" class="nav-link" data-scroll-target="#single_changepoint_error">single_changepoint_error</a></li>
  <li><a href="#ensemble_changepoint_error" id="toc-ensemble_changepoint_error" class="nav-link" data-scroll-target="#ensemble_changepoint_error">ensemble_changepoint_error</a></li>
  </ul></li>
  <li><a href="#segments-pairing" id="toc-segments-pairing" class="nav-link" data-scroll-target="#segments-pairing">Segments pairing</a>
  <ul class="collapse">
  <li><a href="#create_binary_segment" id="toc-create_binary_segment" class="nav-link" data-scroll-target="#create_binary_segment">create_binary_segment</a></li>
  <li><a href="#jaccard_between_segments" id="toc-jaccard_between_segments" class="nav-link" data-scroll-target="#jaccard_between_segments">jaccard_between_segments</a></li>
  <li><a href="#segment_assignment" id="toc-segment_assignment" class="nav-link" data-scroll-target="#segment_assignment">segment_assignment</a></li>
  </ul></li>
  <li><a href="#segment-properties-comparison" id="toc-segment-properties-comparison" class="nav-link" data-scroll-target="#segment-properties-comparison">Segment properties comparison</a>
  <ul class="collapse">
  <li><a href="#metrics-of-segment-properties" id="toc-metrics-of-segment-properties" class="nav-link" data-scroll-target="#metrics-of-segment-properties">Metrics of segment properties</a></li>
  <li><a href="#metric_diffusive_state" id="toc-metric_diffusive_state" class="nav-link" data-scroll-target="#metric_diffusive_state">metric_diffusive_state</a></li>
  <li><a href="#metric_diffusion_coefficient" id="toc-metric_diffusion_coefficient" class="nav-link" data-scroll-target="#metric_diffusion_coefficient">metric_diffusion_coefficient</a></li>
  <li><a href="#metric_anomalous_exponent" id="toc-metric_anomalous_exponent" class="nav-link" data-scroll-target="#metric_anomalous_exponent">metric_anomalous_exponent</a></li>
  <li><a href="#pairing-and-metrics-calculation" id="toc-pairing-and-metrics-calculation" class="nav-link" data-scroll-target="#pairing-and-metrics-calculation">Pairing and metrics calculation</a></li>
  <li><a href="#check_no_changepoints" id="toc-check_no_changepoints" class="nav-link" data-scroll-target="#check_no_changepoints">check_no_changepoints</a></li>
  <li><a href="#segment_property_errors" id="toc-segment_property_errors" class="nav-link" data-scroll-target="#segment_property_errors">segment_property_errors</a></li>
  </ul></li>
  <li><a href="#ensemble-metrics" id="toc-ensemble-metrics" class="nav-link" data-scroll-target="#ensemble-metrics">Ensemble metrics</a>
  <ul class="collapse">
  <li><a href="#extract_ensemble" id="toc-extract_ensemble" class="nav-link" data-scroll-target="#extract_ensemble">extract_ensemble</a></li>
  <li><a href="#multimode_dist" id="toc-multimode_dist" class="nav-link" data-scroll-target="#multimode_dist">multimode_dist</a></li>
  <li><a href="#distribution_distance" id="toc-distribution_distance" class="nav-link" data-scroll-target="#distribution_distance">distribution_distance</a></li>
  <li><a href="#calculate-ensemble-metric" id="toc-calculate-ensemble-metric" class="nav-link" data-scroll-target="#calculate-ensemble-metric">Calculate ensemble metric</a></li>
  <li><a href="#error_ensemble_dataset" id="toc-error_ensemble_dataset" class="nav-link" data-scroll-target="#error_ensemble_dataset">error_Ensemble_dataset</a></li>
  </ul></li>
  <li><a href="#single-trajectory-metrics" id="toc-single-trajectory-metrics" class="nav-link" data-scroll-target="#single-trajectory-metrics">Single trajectory metrics</a>
  <ul class="collapse">
  <li><a href="#check_prediction_length" id="toc-check_prediction_length" class="nav-link" data-scroll-target="#check_prediction_length">check_prediction_length</a></li>
  <li><a href="#separate_prediction_values" id="toc-separate_prediction_values" class="nav-link" data-scroll-target="#separate_prediction_values">separate_prediction_values</a></li>
  <li><a href="#load_file_to_df" id="toc-load_file_to_df" class="nav-link" data-scroll-target="#load_file_to_df">load_file_to_df</a></li>
  <li><a href="#error_singletraj_dataset" id="toc-error_singletraj_dataset" class="nav-link" data-scroll-target="#error_singletraj_dataset">error_SingleTraj_dataset</a></li>
  </ul></li>
  </ul></li>
  <li><a href="#codalab-scoring-program" id="toc-codalab-scoring-program" class="nav-link" data-scroll-target="#codalab-scoring-program">Codalab scoring program</a>
  <ul class="collapse">
  <li><a href="#codalab_scoring" id="toc-codalab_scoring" class="nav-link" data-scroll-target="#codalab_scoring">codalab_scoring</a></li>
  </ul></li>
  </ul>
<div class="toc-actions"><div><i class="bi bi-github"></i></div><div class="action-links"><p><a href="https://github.com/andichallenge/andi_datasets/issues/new" class="toc-action">Report an issue</a></p></div></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title d-none d-lg-block">Help functions</h1>
</div>



<div class="quarto-title-meta">

    
    
  </div>
  

</header>

<!-- WARNING: THIS FILE WAS AUTOGENERATED! DO NOT EDIT! -->
<section id="managing-data" class="level1">
<h1>Managing data</h1>
<section id="smoothing-labels" class="level2">
<h2 class="anchored" data-anchor-id="smoothing-labels">Smoothing labels</h2>
<p>These functions are used to smooth a given vector of labels of heterogeneous processes by means of majority filter. It allows to define a minimum segment length.</p>
<hr>
<p><a href="https://github.com/gorka.munoz/andi_datasets/blob/master/andi_datasets/utils_challenge.py#L42" target="_blank" style="float:right; font-size:smaller">source</a></p>
<section id="label_filter" class="level3">
<h3 class="anchored" data-anchor-id="label_filter">label_filter</h3>
<blockquote class="blockquote">
<pre><code> label_filter (label, window_size=5, min_seg=3)</code></pre>
</blockquote>
<p>Given a vector of changing labels, applies a majority filter such that the minimum segment of a particular label is bigger than the minimum set segment.</p>
<table class="table">
<colgroup>
<col style="width: 6%">
<col style="width: 25%">
<col style="width: 34%">
<col style="width: 34%">
</colgroup>
<thead>
<tr class="header">
<th></th>
<th><strong>Type</strong></th>
<th><strong>Default</strong></th>
<th><strong>Details</strong></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>label</td>
<td>list</td>
<td></td>
<td>label vector to filter.</td>
</tr>
<tr class="even">
<td>window_size</td>
<td>int</td>
<td>5</td>
<td>Size of the window in which the majority filter is applied.</td>
</tr>
<tr class="odd">
<td>min_seg</td>
<td>int</td>
<td>3</td>
<td>Minimum segment size after filtering.</td>
</tr>
<tr class="even">
<td><strong>Returns</strong></td>
<td><strong>np.array</strong></td>
<td></td>
<td><strong>Filtered label vector</strong></td>
</tr>
</tbody>
</table>
<hr>
<p><a href="https://github.com/gorka.munoz/andi_datasets/blob/master/andi_datasets/utils_challenge.py#L21" target="_blank" style="float:right; font-size:smaller">source</a></p>
</section>
<section id="majority_filter" class="level3">
<h3 class="anchored" data-anchor-id="majority_filter">majority_filter</h3>
<blockquote class="blockquote">
<pre><code> majority_filter (seq, width)</code></pre>
</blockquote>
<p>Given a vector, applies a majority filter of given width.</p>
<table class="table">
<thead>
<tr class="header">
<th></th>
<th><strong>Type</strong></th>
<th><strong>Details</strong></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>seq</td>
<td>list</td>
<td>Vector to filter.</td>
</tr>
<tr class="even">
<td>width</td>
<td>int</td>
<td>Size of the window in which the filter is applied.</td>
</tr>
<tr class="odd">
<td><strong>Returns</strong></td>
<td><strong>list</strong></td>
<td><strong>Filtered vector</strong></td>
</tr>
</tbody>
</table>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>fig, axs <span class="op">=</span> plt.subplots(<span class="dv">3</span>, <span class="dv">3</span>, figsize <span class="op">=</span> (<span class="dv">9</span>, <span class="dv">5</span>), tight_layout <span class="op">=</span> <span class="va">True</span>)</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> ax <span class="kw">in</span> axs.flatten():    </span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>    traj, labs <span class="op">=</span> models_phenom()._multiple_state_traj(alphas <span class="op">=</span> [<span class="fl">0.7</span>, <span class="fl">0.8</span>], Ds <span class="op">=</span> [<span class="fl">0.01</span>, <span class="fl">0.1</span>])</span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>    filtered_d <span class="op">=</span> label_filter(labs[:,<span class="dv">1</span>])</span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>    ax.plot(labs[:, <span class="dv">1</span>], <span class="st">'.'</span>, label <span class="op">=</span> <span class="st">'True label'</span>)</span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a>    ax.plot(filtered_d, label <span class="op">=</span> <span class="vs">r'Filtered label'</span>)</span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a>axs[<span class="dv">0</span>,<span class="dv">0</span>].set_title(<span class="ss">f'Majority filter with window size = </span><span class="sc">{</span>window_size<span class="sc">}</span><span class="ss">'</span>)</span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a>axs[<span class="dv">0</span>,<span class="dv">0</span>].legend()</span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a>plt.setp(axs, xticklabels <span class="op">=</span> [], yticklabels <span class="op">=</span> [])<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="utils_challenge_files/figure-html/cell-4-output-1.png" class="img-fluid"></p>
</div>
</div>
</section>
<section id="new-population-percentages-after-filtering" class="level3">
<h3 class="anchored" data-anchor-id="new-population-percentages-after-filtering">New population percentages after filtering</h3>
<p>Note that smoothing the signal will have an effect on the actual proportion of time a particle spends in each state. This will be taken into account in the challenge. Here we showcase this effect:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>T <span class="op">=</span> <span class="dv">100</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>traj, labs <span class="op">=</span> models_phenom().multi_state(N <span class="op">=</span> <span class="dv">500</span>, alphas <span class="op">=</span> [[<span class="fl">0.7</span>, <span class="dv">1</span>],[<span class="fl">0.4</span>,<span class="dv">2</span>]], Ds <span class="op">=</span> [[<span class="dv">0</span>, <span class="dv">1</span>], [<span class="dv">1</span>, <span class="dv">0</span>]], T <span class="op">=</span> T)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>res_t <span class="op">=</span> np.array([])</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>res_ft <span class="op">=</span> np.array([])</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> label <span class="kw">in</span> tqdm(labs.transpose(<span class="dv">1</span>,<span class="dv">0</span>,<span class="dv">2</span>)[:,:,<span class="dv">0</span>]):</span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>    <span class="co"># raw labels</span></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>    CP <span class="op">=</span> np.argwhere(label[<span class="dv">1</span>:] <span class="op">!=</span> label[:<span class="op">-</span><span class="dv">1</span>]).flatten()</span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> CP[<span class="op">-</span><span class="dv">1</span>] <span class="op">!=</span> <span class="dv">199</span>: CP <span class="op">=</span> np.append(CP, T<span class="op">-</span><span class="dv">1</span>)</span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a>    CP <span class="op">=</span> np.append(<span class="dv">0</span>, CP)</span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a>    res_t <span class="op">=</span> np.append(res_t, CP[<span class="dv">1</span>:] <span class="op">-</span> CP[:<span class="op">-</span><span class="dv">1</span>])</span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb5-13"><a href="#cb5-13" aria-hidden="true" tabindex="-1"></a>    <span class="co"># filtered labels</span></span>
<span id="cb5-14"><a href="#cb5-14" aria-hidden="true" tabindex="-1"></a>    filt <span class="op">=</span> label_filter(label)</span>
<span id="cb5-15"><a href="#cb5-15" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb5-16"><a href="#cb5-16" aria-hidden="true" tabindex="-1"></a>    CP_f <span class="op">=</span> np.argwhere(filt[<span class="dv">1</span>:] <span class="op">!=</span> filt[:<span class="op">-</span><span class="dv">1</span>]).flatten()</span>
<span id="cb5-17"><a href="#cb5-17" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> CP_f[<span class="op">-</span><span class="dv">1</span>] <span class="op">!=</span> <span class="dv">199</span>: CP_f <span class="op">=</span> np.append(CP_f, T<span class="op">-</span><span class="dv">1</span>)</span>
<span id="cb5-18"><a href="#cb5-18" aria-hidden="true" tabindex="-1"></a>    CP_f <span class="op">=</span> np.append(<span class="dv">0</span>, CP_f)</span>
<span id="cb5-19"><a href="#cb5-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-20"><a href="#cb5-20" aria-hidden="true" tabindex="-1"></a>    res_ft <span class="op">=</span> np.append(res_ft, CP_f[<span class="dv">1</span>:] <span class="op">-</span> CP_f[:<span class="op">-</span><span class="dv">1</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"496e152990ff4498b3cfcfb87078c5d7","version_major":2,"version_minor":0}
</script>
</div>
</div>
<p>We show now the new transition rates (e.g.&nbsp;1 over the residence time of a given state). Because we are minimum segment length of 3, we can actually approximate the filtered transition rate as the original times 2/3:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f' True transition rate: </span><span class="sc">{</span><span class="dv">1</span><span class="op">/</span>np<span class="sc">.</span>mean(res_t)<span class="sc">}</span><span class="ch">\n</span><span class="ss">'</span>,</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>      <span class="ss">f'Filtered transition rate: </span><span class="sc">{</span><span class="dv">1</span><span class="op">/</span>np<span class="sc">.</span>mean(res_ft)<span class="sc">}</span><span class="ch">\n</span><span class="ss">'</span>,</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>      <span class="ss">f'True rate x 2/3: </span><span class="sc">{</span><span class="dv">1</span><span class="op">/</span>np<span class="sc">.</span>mean(res_t)<span class="op">*</span>(<span class="dv">2</span><span class="op">/</span><span class="dv">3</span>)<span class="sc">}</span><span class="ss">'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> True transition rate: 0.10947474747474747
 Filtered transition rate: 0.07402020202020201
 True rate x 2/3: 0.07298316498316498</code></pre>
</div>
</div>
</section>
</section>
<section id="continuous-labels-to-list-of-features" class="level2">
<h2 class="anchored" data-anchor-id="continuous-labels-to-list-of-features">Continuous labels to list of features</h2>
<p>The labels in the challenge will be the list of <span class="math inline">\(n\)</span> changepoints as well as the <span class="math inline">\(n+1\)</span> diffusion properties (<span class="math inline">\(D\)</span> and <span class="math inline">\(\alpha\)</span>) for each segment. This function transforms the stepwise labels into three lists: CPs, <span class="math inline">\(\alpha\)</span>s and <span class="math inline">\(D\)</span>s.</p>
<hr>
<p><a href="https://github.com/gorka.munoz/andi_datasets/blob/master/andi_datasets/utils_challenge.py#L127" target="_blank" style="float:right; font-size:smaller">source</a></p>
<section id="label_continuous_to_list" class="level3">
<h3 class="anchored" data-anchor-id="label_continuous_to_list">label_continuous_to_list</h3>
<blockquote class="blockquote">
<pre><code> label_continuous_to_list (labs)</code></pre>
</blockquote>
<p>Given an array of T x 2 labels containing the anomalous exponent and diffusion coefficient at each timestep, returns 3 arrays, each containing the changepoints, exponents and coefficient, respectively. If labs is size T x 3, then we consider that diffusive states are given and also return those.</p>
<table class="table">
<colgroup>
<col style="width: 9%">
<col style="width: 38%">
<col style="width: 52%">
</colgroup>
<thead>
<tr class="header">
<th></th>
<th><strong>Type</strong></th>
<th><strong>Details</strong></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>labs</td>
<td>array</td>
<td>T x 2 or T x 3 labels containing the anomalous exponent, diffusion <br>and diffusive state.</td>
</tr>
<tr class="even">
<td><strong>Returns</strong></td>
<td><strong>tuple</strong></td>
<td><strong>- First element is the list of change points<br>- The rest are corresponding segment properties (order: alpha, Ds and states) </strong></td>
</tr>
</tbody>
</table>
<div class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Generate the trajectory</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>trajs, labels <span class="op">=</span> models_phenom().multi_state(N <span class="op">=</span> <span class="dv">1</span>, T <span class="op">=</span> <span class="dv">50</span>)</span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Transform the labels:</span></span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>CP, alphas, Ds, _ <span class="op">=</span> label_continuous _to_list(labels[:,<span class="op">-</span><span class="dv">1</span>,:])</span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">5</span>, <span class="dv">3</span>))</span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a>plt.plot(labels[:, <span class="op">-</span><span class="dv">1</span>, <span class="dv">1</span>], <span class="st">'o'</span>, alpha <span class="op">=</span> <span class="fl">0.4</span>, label <span class="op">=</span> <span class="st">'Continuous label'</span>)</span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a>plt.scatter(CP<span class="op">-</span><span class="dv">1</span>, Ds, c <span class="op">=</span> <span class="st">'C1'</span>, label <span class="op">=</span> <span class="st">'CP-1 and value of previous segment'</span>)</span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a>plt.legend()<span class="op">;</span> plt.xlabel(<span class="st">'T'</span>)<span class="op">;</span> plt.ylabel(<span class="vs">r'$\alpha$'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>Text(0, 0.5, '$\\alpha$')</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="utils_challenge_files/figure-html/cell-9-output-2.png" class="img-fluid"></p>
</div>
</div>
</section>
</section>
<section id="list-of-features-to-continuous-labels" class="level2">
<h2 class="anchored" data-anchor-id="list-of-features-to-continuous-labels">List of features to continuous labels</h2>
<p>This function does the opposite from than <code>label_continuous _to_list</code>. From a list of properties as the one used in ANDI 2022, creates continuous labels</p>
<hr>
<p><a href="https://github.com/gorka.munoz/andi_datasets/blob/master/andi_datasets/utils_challenge.py#L174" target="_blank" style="float:right; font-size:smaller">source</a></p>
<section id="label_list_to_continuous" class="level3">
<h3 class="anchored" data-anchor-id="label_list_to_continuous">label_list_to_continuous</h3>
<blockquote class="blockquote">
<pre><code> label_list_to_continuous (CP, label)</code></pre>
</blockquote>
<p>Given a list of change points and the labels of the diffusion properties of the resulting segments, generates and array of continuous labels. The last change point indicates the array length.</p>
<table class="table">
<colgroup>
<col style="width: 9%">
<col style="width: 38%">
<col style="width: 52%">
</colgroup>
<thead>
<tr class="header">
<th></th>
<th><strong>Type</strong></th>
<th><strong>Details</strong></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>CP</td>
<td>array, list</td>
<td>list of change points. Last change point indicates label length.</td>
</tr>
<tr class="even">
<td>label</td>
<td>array, list</td>
<td>list of segment properties</td>
</tr>
<tr class="odd">
<td><strong>Returns</strong></td>
<td><strong>array</strong></td>
<td><strong>Continuous label created from the given change points and segment properties</strong></td>
</tr>
</tbody>
</table>
<div class="cell">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>CP <span class="op">=</span> [<span class="dv">3</span>,<span class="dv">24</span>,<span class="dv">34</span>]</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>label <span class="op">=</span> [<span class="fl">0.5</span>, <span class="fl">0.4</span>, <span class="dv">1</span>]</span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>cont <span class="op">=</span> label_list_to_continuous(CP, label)</span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize <span class="op">=</span> (<span class="dv">3</span>,<span class="dv">1</span>))</span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>plt.plot(cont, c <span class="op">=</span> <span class="st">'C1'</span>)</span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>[plt.axvline(c, c <span class="op">=</span> <span class="st">'k'</span>, ls <span class="op">=</span> <span class="st">'--'</span>) <span class="cf">for</span> c <span class="kw">in</span> CP[:<span class="op">-</span><span class="dv">1</span>]]<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="utils_challenge_files/figure-html/cell-11-output-1.png" class="img-fluid"></p>
</div>
</div>
</section>
</section>
<section id="storing-array-data-in-dataframe" class="level2">
<h2 class="anchored" data-anchor-id="storing-array-data-in-dataframe">Storing array data in dataframe</h2>
<hr>
<p><a href="https://github.com/gorka.munoz/andi_datasets/blob/master/andi_datasets/utils_challenge.py#L202" target="_blank" style="float:right; font-size:smaller">source</a></p>
<section id="array_to_df" class="level3">
<h3 class="anchored" data-anchor-id="array_to_df">array_to_df</h3>
<blockquote class="blockquote">
<pre><code> array_to_df (trajs, labels, min_length=10, fov_origin=[0, 0],
              fov_length=100.0, cutoff_length=10)</code></pre>
</blockquote>
<p>Given arrays for the position and labels of trajectories, creates a dataframe with that data. The function also applies the demanded FOV. If you don’t want a field of view, chose a FOV length bigger (smaller) that your maximum (minimum) trajectory position.</p>
<table class="table">
<colgroup>
<col style="width: 6%">
<col style="width: 25%">
<col style="width: 34%">
<col style="width: 34%">
</colgroup>
<thead>
<tr class="header">
<th></th>
<th><strong>Type</strong></th>
<th><strong>Default</strong></th>
<th><strong>Details</strong></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>trajs</td>
<td>array</td>
<td></td>
<td>Trajectories to store in the df (dimension: T x N x 3)</td>
</tr>
<tr class="even">
<td>labels</td>
<td>array</td>
<td></td>
<td>Labels to store in the df (dimension: T x N x 3)</td>
</tr>
<tr class="odd">
<td>min_length</td>
<td>int</td>
<td>10</td>
<td></td>
</tr>
<tr class="even">
<td>fov_origin</td>
<td>list</td>
<td>[0, 0]</td>
<td>Bottom left point of the square defining the FOV.</td>
</tr>
<tr class="odd">
<td>fov_length</td>
<td>float</td>
<td>100.0</td>
<td>Size of the box defining the FOV.</td>
</tr>
<tr class="even">
<td>cutoff_length</td>
<td>int</td>
<td>10</td>
<td>Minimum length of a trajectory inside the FOV to be considered in the output dataset.</td>
</tr>
<tr class="odd">
<td><strong>Returns</strong></td>
<td><strong>tuple</strong></td>
<td></td>
<td><strong>- df_in (dataframe): dataframe with trajectories<br>- df_out (datafram): dataframe with labels </strong></td>
</tr>
</tbody>
</table>
<div class="cell">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="co">#trajs, labels = models_phenom().multi_state(T = 200, N = 10, alphas=[0.5, 1], Ds = [1,1], L = 100)</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>trajs, labels <span class="op">=</span> models_phenom().single_state(T <span class="op">=</span> <span class="dv">200</span>, N <span class="op">=</span> <span class="dv">10</span>)</span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Changing dimensions</span></span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a>trajs <span class="op">=</span> trajs.transpose((<span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">2</span>)).copy()</span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a>labels <span class="op">=</span> labels.transpose(<span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">2</span>)</span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a>df_in, df_out <span class="op">=</span> array_to_df(trajs, labels)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>df_out.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th>traj_idx</th>
      <th>Ds</th>
      <th>alphas</th>
      <th>states</th>
      <th>changepoints</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>0</td>
      <td>[1.0]</td>
      <td>[1.0]</td>
      <td>[2.0]</td>
      <td>[115]</td>
    </tr>
    <tr>
      <th>1</th>
      <td>1</td>
      <td>[1.0]</td>
      <td>[1.0]</td>
      <td>[2.0]</td>
      <td>[22]</td>
    </tr>
    <tr>
      <th>2</th>
      <td>2</td>
      <td>[1.0]</td>
      <td>[1.0]</td>
      <td>[2.0]</td>
      <td>[10]</td>
    </tr>
    <tr>
      <th>3</th>
      <td>3</td>
      <td>[1.0]</td>
      <td>[1.0]</td>
      <td>[2.0]</td>
      <td>[39]</td>
    </tr>
    <tr>
      <th>4</th>
      <td>4</td>
      <td>[1.0]</td>
      <td>[1.0]</td>
      <td>[2.0]</td>
      <td>[28]</td>
    </tr>
  </tbody>
</table>
</div>
</div>
</div>
</section>
</section>
<section id="transform-andi-dataframe-to-array-with-padding" class="level2">
<h2 class="anchored" data-anchor-id="transform-andi-dataframe-to-array-with-padding">Transform ANDI dataframe to array with padding</h2>
<hr>
<p><a href="https://github.com/gorka.munoz/andi_datasets/blob/master/andi_datasets/utils_challenge.py#L287" target="_blank" style="float:right; font-size:smaller">source</a></p>
<section id="df_to_array" class="level3">
<h3 class="anchored" data-anchor-id="df_to_array">df_to_array</h3>
<blockquote class="blockquote">
<pre><code> df_to_array (df, pad=-1)</code></pre>
</blockquote>
<p>Transform a dataframe as the ones given in the ANDI challenge 2 (i.e.&nbsp;4 columns: traj_idx, frame, x, y) into a numpy array. To deal with irregular temporal supports, we pad the array whenever the trajectory is not present. The output array has the typical shape of ANDI datasets: TxNx2</p>
<table class="table">
<colgroup>
<col style="width: 6%">
<col style="width: 25%">
<col style="width: 34%">
<col style="width: 34%">
</colgroup>
<thead>
<tr class="header">
<th></th>
<th><strong>Type</strong></th>
<th><strong>Default</strong></th>
<th><strong>Details</strong></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>df</td>
<td>dataframe</td>
<td></td>
<td>Dataframe with four columns ‘traj_idx’: the trajectory index, ‘frame’ the time frame and <br>‘x’ and ‘y’ the positions of the particle.</td>
</tr>
<tr class="even">
<td>pad</td>
<td>int</td>
<td>-1</td>
<td>Number to use as padding.</td>
</tr>
<tr class="odd">
<td><strong>Returns</strong></td>
<td><strong>array</strong></td>
<td></td>
<td><strong>Array containing the trajectories from the dataframe, with usual ANDI shape (TxNx2).</strong></td>
</tr>
</tbody>
</table>
</section>
</section>
</section>
<section id="isolate-vip-particles" class="level1">
<h1>Isolate VIP particles</h1>
<hr>
<p><a href="https://github.com/gorka.munoz/andi_datasets/blob/master/andi_datasets/utils_challenge.py#L327" target="_blank" style="float:right; font-size:smaller">source</a></p>
<section id="get_vip" class="level3">
<h3 class="anchored" data-anchor-id="get_vip">get_VIP</h3>
<blockquote class="blockquote">
<pre><code> get_VIP (array_trajs, num_vip=5, min_distance=2, pad=-1)</code></pre>
</blockquote>
<p>Given an array of trajectories, finds the particles VIP particles that participants will need to characterize in the video trakcl.</p>
<p>The function first finds the particles that exist at frame 0 (i.e.&nbsp;that their first value is different from pad). Then, iterates over this particles to find num_vip that are at distance &gt; than min_distance in the first frame.</p>
<table class="table">
<colgroup>
<col style="width: 6%">
<col style="width: 25%">
<col style="width: 34%">
<col style="width: 34%">
</colgroup>
<thead>
<tr class="header">
<th></th>
<th><strong>Type</strong></th>
<th><strong>Default</strong></th>
<th><strong>Details</strong></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>array_trajs</td>
<td>array</td>
<td></td>
<td>Position of the trajectories that will be considered for the VIP search.</td>
</tr>
<tr class="even">
<td>num_vip</td>
<td>int</td>
<td>5</td>
<td>Number of VIP particles to flag.</td>
</tr>
<tr class="odd">
<td>min_distance</td>
<td>int</td>
<td>2</td>
<td>Minimum distance between two VIP particles.</td>
</tr>
<tr class="even">
<td>pad</td>
<td>int</td>
<td>-1</td>
<td>Number used to indicate in the temporal support that the particle is outside of the FOV.</td>
</tr>
<tr class="odd">
<td><strong>Returns</strong></td>
<td><strong>list</strong></td>
<td></td>
<td><strong>List of indices of the chosen VIP particles</strong></td>
</tr>
</tbody>
</table>
</section>
</section>
<section id="challenge-2022-metrics" class="level1">
<h1>Challenge 2022 metrics</h1>
<section id="changepoint-pairing" class="level2">
<h2 class="anchored" data-anchor-id="changepoint-pairing">Changepoint pairing</h2>
<p>We use an assignment algorithm to pair predicted and groundtruth changepoints. From there, we will calculate the various metrics of the challenge.</p>
<hr>
<p><a href="https://github.com/gorka.munoz/andi_datasets/blob/master/andi_datasets/utils_challenge.py#L389" target="_blank" style="float:right; font-size:smaller">source</a></p>
<section id="changepoint_assignment" class="level3">
<h3 class="anchored" data-anchor-id="changepoint_assignment">changepoint_assignment</h3>
<blockquote class="blockquote">
<pre><code> changepoint_assignment (GT, preds)</code></pre>
</blockquote>
<p>Given a list of groundtruth and predicted changepoints, solves the assignment problem via the Munkres algorithm (aka Hungarian algorithm) and returns two arrays containing the index of the paired groundtruth and predicted changepoints, respectively.</p>
<p>The distance between change point is the Euclidean distance.</p>
<table class="table">
<colgroup>
<col style="width: 9%">
<col style="width: 38%">
<col style="width: 52%">
</colgroup>
<thead>
<tr class="header">
<th></th>
<th><strong>Type</strong></th>
<th><strong>Details</strong></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>GT</td>
<td>list</td>
<td>List of groundtruth change points.</td>
</tr>
<tr class="even">
<td>preds</td>
<td>list</td>
<td>List of predicted change points.</td>
</tr>
<tr class="odd">
<td><strong>Returns</strong></td>
<td><strong>tuple</strong></td>
<td><strong>- tuple of two arrays, each corresponding to the assigned GT and pred changepoints<br>- Cost matrix</strong></td>
</tr>
</tbody>
</table>
<div class="cell">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>ngts <span class="op">=</span> <span class="dv">10</span><span class="op">;</span> npreds <span class="op">=</span> <span class="dv">6</span><span class="op">;</span> T <span class="op">=</span> <span class="dv">100</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>GT <span class="op">=</span> np.sort(np.random.choice(np.arange(<span class="dv">1</span>,T), ngts, replace <span class="op">=</span> <span class="va">False</span>))</span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>preds <span class="op">=</span> np.sort(np.random.choice(np.arange(<span class="dv">1</span>,T)<span class="op">*</span><span class="fl">0.5</span>, npreds, replace <span class="op">=</span> <span class="va">False</span>)).astype(<span class="bu">int</span>)</span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">'GT:'</span>, GT)</span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">'Pred:'</span>, preds)</span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a>changepoint_assignment(GT, preds)[<span class="dv">0</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>GT: [ 2  8 24 33 34 54 55 64 73 85]
Pred: [ 8 11 16 30 36 47]</code></pre>
</div>
<div class="cell-output cell-output-display">
<pre><code>(array([0, 1, 2, 3, 4, 5], dtype=int64),
 array([1, 0, 2, 3, 4, 5], dtype=int64))</code></pre>
</div>
</div>
<hr>
<p><a href="https://github.com/gorka.munoz/andi_datasets/blob/master/andi_datasets/utils_challenge.py#L421" target="_blank" style="float:right; font-size:smaller">source</a></p>
</section>
<section id="changepoint_alpha_beta" class="level3">
<h3 class="anchored" data-anchor-id="changepoint_alpha_beta">changepoint_alpha_beta</h3>
<blockquote class="blockquote">
<pre><code> changepoint_alpha_beta (GT, preds, threshold=10)</code></pre>
</blockquote>
<p>Calculate the alpha and beta measure of paired changepoints. Inspired from Supplemantary Note 3 in https://www.nature.com/articles/nmeth.2808</p>
<table class="table">
<colgroup>
<col style="width: 6%">
<col style="width: 25%">
<col style="width: 34%">
<col style="width: 34%">
</colgroup>
<thead>
<tr class="header">
<th></th>
<th><strong>Type</strong></th>
<th><strong>Default</strong></th>
<th><strong>Details</strong></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>GT</td>
<td>list</td>
<td></td>
<td>List of groundtruth change points.</td>
</tr>
<tr class="even">
<td>preds</td>
<td>list</td>
<td></td>
<td>List of predicted change points.</td>
</tr>
<tr class="odd">
<td>threshold</td>
<td>int</td>
<td>10</td>
<td>Distance from which predictions are considered to have failed. They are then assigned this number.</td>
</tr>
<tr class="even">
<td><strong>Returns</strong></td>
<td><strong>tuple</strong></td>
<td></td>
<td><strong>alpha, beta</strong></td>
</tr>
</tbody>
</table>
<div class="cell">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>labels <span class="op">=</span> [<span class="vs">r'Random Guess + $N_p&gt;N_</span><span class="sc">{gt}</span><span class="vs">$'</span>,</span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>          <span class="vs">r'Random Guess + $N_p&lt;N_</span><span class="sc">{gt}</span><span class="vs">$'</span>,</span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a>          <span class="vs">r'GT + rand $\in [-3, 3]$'</span>,</span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a>          <span class="vs">r'GT + rand $\in [-1, 1]$'</span>]</span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots(figsize <span class="op">=</span> (<span class="dv">4</span>,<span class="dv">3</span>))</span>
<span id="cb23-7"><a href="#cb23-7" aria-hidden="true" tabindex="-1"></a>alpha <span class="op">=</span> <span class="fl">0.2</span></span>
<span id="cb23-8"><a href="#cb23-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-9"><a href="#cb23-9" aria-hidden="true" tabindex="-1"></a>T <span class="op">=</span> <span class="dv">200</span><span class="op">;</span> ngts <span class="op">=</span> <span class="dv">15</span><span class="op">;</span> </span>
<span id="cb23-10"><a href="#cb23-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-11"><a href="#cb23-11" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> case, (label, color) <span class="kw">in</span> <span class="bu">enumerate</span>(<span class="bu">zip</span>(labels, [<span class="st">'C0'</span>, <span class="st">'C1'</span>, <span class="st">'C2'</span>, <span class="st">'C3'</span>])):</span>
<span id="cb23-12"><a href="#cb23-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-13"><a href="#cb23-13" aria-hidden="true" tabindex="-1"></a>    alphas, betas <span class="op">=</span> [], []</span>
<span id="cb23-14"><a href="#cb23-14" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> _ <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">100</span>):</span>
<span id="cb23-15"><a href="#cb23-15" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb23-16"><a href="#cb23-16" aria-hidden="true" tabindex="-1"></a>        GT <span class="op">=</span> np.sort(np.random.choice(np.arange(<span class="dv">1</span>,T), ngts, replace <span class="op">=</span> <span class="va">False</span>))</span>
<span id="cb23-17"><a href="#cb23-17" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> case <span class="op">==</span> <span class="dv">0</span>:</span>
<span id="cb23-18"><a href="#cb23-18" aria-hidden="true" tabindex="-1"></a>            npreds <span class="op">=</span> np.random.randint(low <span class="op">=</span> ngts, high <span class="op">=</span> ngts<span class="op">*</span><span class="dv">2</span>)</span>
<span id="cb23-19"><a href="#cb23-19" aria-hidden="true" tabindex="-1"></a>            preds <span class="op">=</span> np.sort(np.random.choice(np.arange(<span class="dv">1</span>,T), npreds, replace <span class="op">=</span> <span class="va">False</span>)) </span>
<span id="cb23-20"><a href="#cb23-20" aria-hidden="true" tabindex="-1"></a>        <span class="cf">elif</span> case <span class="op">==</span> <span class="dv">1</span>:</span>
<span id="cb23-21"><a href="#cb23-21" aria-hidden="true" tabindex="-1"></a>            npreds <span class="op">=</span> np.random.randint(low <span class="op">=</span> <span class="dv">1</span>, high <span class="op">=</span> ngts)</span>
<span id="cb23-22"><a href="#cb23-22" aria-hidden="true" tabindex="-1"></a>            preds <span class="op">=</span> np.sort(np.random.choice(np.arange(<span class="dv">1</span>,T), npreds, replace <span class="op">=</span> <span class="va">False</span>))     </span>
<span id="cb23-23"><a href="#cb23-23" aria-hidden="true" tabindex="-1"></a>        <span class="cf">elif</span> case <span class="op">==</span> <span class="dv">2</span>:</span>
<span id="cb23-24"><a href="#cb23-24" aria-hidden="true" tabindex="-1"></a>            preds <span class="op">=</span> GT <span class="op">+</span> np.random.randint(<span class="op">-</span><span class="dv">3</span>, <span class="dv">3</span>, ngts)</span>
<span id="cb23-25"><a href="#cb23-25" aria-hidden="true" tabindex="-1"></a>        <span class="cf">elif</span> case <span class="op">==</span> <span class="dv">3</span>:</span>
<span id="cb23-26"><a href="#cb23-26" aria-hidden="true" tabindex="-1"></a>            preds <span class="op">=</span> GT <span class="op">+</span> np.random.randint(<span class="op">-</span><span class="dv">1</span>, <span class="dv">1</span>, ngts)</span>
<span id="cb23-27"><a href="#cb23-27" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb23-28"><a href="#cb23-28" aria-hidden="true" tabindex="-1"></a>        alpha, beta <span class="op">=</span> changepoint_alpha_beta(GT, preds)</span>
<span id="cb23-29"><a href="#cb23-29" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb23-30"><a href="#cb23-30" aria-hidden="true" tabindex="-1"></a>        alphas.append(alpha)</span>
<span id="cb23-31"><a href="#cb23-31" aria-hidden="true" tabindex="-1"></a>        betas.append(beta)</span>
<span id="cb23-32"><a href="#cb23-32" aria-hidden="true" tabindex="-1"></a>     </span>
<span id="cb23-33"><a href="#cb23-33" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb23-34"><a href="#cb23-34" aria-hidden="true" tabindex="-1"></a>    ax.scatter(alphas, betas, c <span class="op">=</span> color, alpha <span class="op">=</span> alpha)</span>
<span id="cb23-35"><a href="#cb23-35" aria-hidden="true" tabindex="-1"></a>    ax.scatter(np.mean(alphas), np.mean(betas), c <span class="op">=</span> color, label <span class="op">=</span> label, s <span class="op">=</span> <span class="dv">50</span>, marker <span class="op">=</span> <span class="st">'s'</span>, edgecolors <span class="op">=</span> <span class="st">'k'</span>)</span>
<span id="cb23-36"><a href="#cb23-36" aria-hidden="true" tabindex="-1"></a>plt.setp(ax, xlabel <span class="op">=</span> <span class="vs">r'$\alpha$'</span>, ylabel <span class="op">=</span> <span class="vs">r'$\beta$'</span>)</span>
<span id="cb23-37"><a href="#cb23-37" aria-hidden="true" tabindex="-1"></a>ax.legend(loc <span class="op">=</span> (<span class="fl">1.01</span>,<span class="fl">0.4</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>&lt;matplotlib.legend.Legend&gt;</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="utils_challenge_files/figure-html/cell-20-output-2.png" class="img-fluid"></p>
</div>
</div>
<hr>
<p><a href="https://github.com/gorka.munoz/andi_datasets/blob/master/andi_datasets/utils_challenge.py#L459" target="_blank" style="float:right; font-size:smaller">source</a></p>
</section>
<section id="jaccard_index" class="level3">
<h3 class="anchored" data-anchor-id="jaccard_index">jaccard_index</h3>
<blockquote class="blockquote">
<pre><code> jaccard_index (TP:int, FP:int, FN:int)</code></pre>
</blockquote>
<p>Given the true positive, false positive and false negative rates, calculates the Jaccard Index</p>
<table class="table">
<thead>
<tr class="header">
<th></th>
<th><strong>Type</strong></th>
<th><strong>Details</strong></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>TP</td>
<td>int</td>
<td>true positive</td>
</tr>
<tr class="even">
<td>FP</td>
<td>int</td>
<td>false positive</td>
</tr>
<tr class="odd">
<td>FN</td>
<td>int</td>
<td>false negative</td>
</tr>
<tr class="even">
<td><strong>Returns</strong></td>
<td><strong>float</strong></td>
<td><strong>Jaccard Index</strong></td>
</tr>
</tbody>
</table>
<hr>
<p><a href="https://github.com/gorka.munoz/andi_datasets/blob/master/andi_datasets/utils_challenge.py#L469" target="_blank" style="float:right; font-size:smaller">source</a></p>
</section>
<section id="single_changepoint_error" class="level3">
<h3 class="anchored" data-anchor-id="single_changepoint_error">single_changepoint_error</h3>
<blockquote class="blockquote">
<pre><code> single_changepoint_error (GT, preds, threshold=5)</code></pre>
</blockquote>
<p>Given the groundtruth and predicted changepoints for a single trajectory, first solves the assignment problem between changepoints, then calculates the RMSE of the true positive pairs and the Jaccard index.</p>
<table class="table">
<colgroup>
<col style="width: 6%">
<col style="width: 25%">
<col style="width: 34%">
<col style="width: 34%">
</colgroup>
<thead>
<tr class="header">
<th></th>
<th><strong>Type</strong></th>
<th><strong>Default</strong></th>
<th><strong>Details</strong></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>GT</td>
<td>list</td>
<td></td>
<td>List of groundtruth change points.</td>
</tr>
<tr class="even">
<td>preds</td>
<td>list</td>
<td></td>
<td>List of predicted change points.</td>
</tr>
<tr class="odd">
<td>threshold</td>
<td>int</td>
<td>5</td>
<td>Distance from which predictions are considered to have failed. They are then assigned this number.</td>
</tr>
<tr class="even">
<td><strong>Returns</strong></td>
<td><strong>tuple</strong></td>
<td></td>
<td><strong>- TP_rmse: root mean square error of the true positive change points.<br>- Jaccard Index of the ensemble predictions </strong></td>
</tr>
</tbody>
</table>
<hr>
<p><a href="https://github.com/gorka.munoz/andi_datasets/blob/master/andi_datasets/utils_challenge.py#L516" target="_blank" style="float:right; font-size:smaller">source</a></p>
</section>
<section id="ensemble_changepoint_error" class="level3">
<h3 class="anchored" data-anchor-id="ensemble_changepoint_error">ensemble_changepoint_error</h3>
<blockquote class="blockquote">
<pre><code> ensemble_changepoint_error (GT_ensemble, pred_ensemble, threshold=5)</code></pre>
</blockquote>
<p>Given an ensemble of groundtruth and predicted change points, iterates over each trajectory’s changepoints. For each, it solves the assignment problem between changepoints. Then, calculates the RMSE of the true positive pairs and the Jaccard index over the ensemble of changepoints (i.e.&nbsp;not the mean of them w.r.t. to the trajectories)</p>
<table class="table">
<colgroup>
<col style="width: 6%">
<col style="width: 25%">
<col style="width: 34%">
<col style="width: 34%">
</colgroup>
<thead>
<tr class="header">
<th></th>
<th><strong>Type</strong></th>
<th><strong>Default</strong></th>
<th><strong>Details</strong></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>GT_ensemble</td>
<td>list, array</td>
<td></td>
<td>Ensemble of groutruth change points.</td>
</tr>
<tr class="even">
<td>pred_ensemble</td>
<td>list</td>
<td></td>
<td>Ensemble of predicted change points.</td>
</tr>
<tr class="odd">
<td>threshold</td>
<td>int</td>
<td>5</td>
<td>Distance from which predictions are considered to have failed. They are then assigned this number.</td>
</tr>
<tr class="even">
<td><strong>Returns</strong></td>
<td><strong>tuple</strong></td>
<td></td>
<td><strong>- TP_rmse: root mean square error of the true positive change points.<br>- Jaccard Index of the ensemble predictions</strong></td>
</tr>
</tbody>
</table>
<div class="cell">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a>labels <span class="op">=</span> [<span class="st">'Random Guess + Incorrect number'</span>,</span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a>          <span class="vs">r'GT + rand $\in [-3, 3]$'</span>,</span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a>          <span class="vs">r'GT + rand $\in [-1, 1]$'</span>]</span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots(figsize <span class="op">=</span> (<span class="dv">3</span>,<span class="dv">3</span>))</span>
<span id="cb28-6"><a href="#cb28-6" aria-hidden="true" tabindex="-1"></a>alpha <span class="op">=</span> <span class="fl">0.2</span></span>
<span id="cb28-7"><a href="#cb28-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-8"><a href="#cb28-8" aria-hidden="true" tabindex="-1"></a>T <span class="op">=</span> <span class="dv">200</span><span class="op">;</span> ngts <span class="op">=</span> <span class="dv">10</span><span class="op">;</span> npreds <span class="op">=</span> <span class="dv">8</span></span>
<span id="cb28-9"><a href="#cb28-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-10"><a href="#cb28-10" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> case, (label, color) <span class="kw">in</span> <span class="bu">enumerate</span>(<span class="bu">zip</span>(labels, [<span class="st">'C0'</span>, <span class="st">'C1'</span>, <span class="st">'C2'</span>])):</span>
<span id="cb28-11"><a href="#cb28-11" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb28-12"><a href="#cb28-12" aria-hidden="true" tabindex="-1"></a>    rmse, ji <span class="op">=</span> [], []</span>
<span id="cb28-13"><a href="#cb28-13" aria-hidden="true" tabindex="-1"></a>    GT, preds <span class="op">=</span> [], []</span>
<span id="cb28-14"><a href="#cb28-14" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> _ <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">100</span>):</span>
<span id="cb28-15"><a href="#cb28-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-16"><a href="#cb28-16" aria-hidden="true" tabindex="-1"></a>        GT.append(np.sort(np.random.choice(np.arange(<span class="dv">1</span>,T), ngts, replace <span class="op">=</span> <span class="va">False</span>)))</span>
<span id="cb28-17"><a href="#cb28-17" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> case <span class="op">==</span> <span class="dv">0</span>:</span>
<span id="cb28-18"><a href="#cb28-18" aria-hidden="true" tabindex="-1"></a>            preds.append(np.sort(np.random.choice(np.arange(<span class="dv">1</span>,T), npreds, replace <span class="op">=</span> <span class="va">False</span>)))                  </span>
<span id="cb28-19"><a href="#cb28-19" aria-hidden="true" tabindex="-1"></a>        <span class="cf">elif</span> case <span class="op">==</span> <span class="dv">1</span>:</span>
<span id="cb28-20"><a href="#cb28-20" aria-hidden="true" tabindex="-1"></a>            preds.append(GT[<span class="op">-</span><span class="dv">1</span>] <span class="op">+</span> np.random.randint(<span class="op">-</span><span class="dv">3</span>, <span class="dv">3</span>, ngts))</span>
<span id="cb28-21"><a href="#cb28-21" aria-hidden="true" tabindex="-1"></a>        <span class="cf">elif</span> case <span class="op">==</span> <span class="dv">2</span>:</span>
<span id="cb28-22"><a href="#cb28-22" aria-hidden="true" tabindex="-1"></a>            preds.append(GT[<span class="op">-</span><span class="dv">1</span>] <span class="op">+</span> np.random.randint(<span class="op">-</span><span class="dv">1</span>, <span class="dv">1</span>, ngts))</span>
<span id="cb28-23"><a href="#cb28-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-24"><a href="#cb28-24" aria-hidden="true" tabindex="-1"></a>        assignment, _ <span class="op">=</span> changepoint_assignment(GT[<span class="op">-</span><span class="dv">1</span>], preds[<span class="op">-</span><span class="dv">1</span>])</span>
<span id="cb28-25"><a href="#cb28-25" aria-hidden="true" tabindex="-1"></a>        assignment <span class="op">=</span> np.array(assignment)</span>
<span id="cb28-26"><a href="#cb28-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-27"><a href="#cb28-27" aria-hidden="true" tabindex="-1"></a>        RMSE, JI <span class="op">=</span> single_changepoint_error(GT[<span class="op">-</span><span class="dv">1</span>], preds[<span class="op">-</span><span class="dv">1</span>], threshold <span class="op">=</span> <span class="dv">5</span>)     </span>
<span id="cb28-28"><a href="#cb28-28" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb28-29"><a href="#cb28-29" aria-hidden="true" tabindex="-1"></a>        rmse.append(RMSE)</span>
<span id="cb28-30"><a href="#cb28-30" aria-hidden="true" tabindex="-1"></a>        ji.append(JI)</span>
<span id="cb28-31"><a href="#cb28-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-32"><a href="#cb28-32" aria-hidden="true" tabindex="-1"></a>    rmse_e, ji_e <span class="op">=</span> ensemble_changepoint_error(GT, preds, threshold <span class="op">=</span> <span class="dv">5</span>)</span>
<span id="cb28-33"><a href="#cb28-33" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb28-34"><a href="#cb28-34" aria-hidden="true" tabindex="-1"></a>    ax.scatter(rmse, ji, c <span class="op">=</span> color, alpha <span class="op">=</span> alpha)</span>
<span id="cb28-35"><a href="#cb28-35" aria-hidden="true" tabindex="-1"></a>    ax.scatter(rmse_e, ji_e, c <span class="op">=</span> color, label <span class="op">=</span> label, s <span class="op">=</span> <span class="dv">50</span>, marker <span class="op">=</span> <span class="st">'s'</span>, edgecolors <span class="op">=</span> <span class="st">'k'</span>)</span>
<span id="cb28-36"><a href="#cb28-36" aria-hidden="true" tabindex="-1"></a>plt.setp(ax, xlabel <span class="op">=</span> <span class="st">'TP RMSE'</span>, ylabel <span class="op">=</span> <span class="st">'Jaccard'</span>)</span>
<span id="cb28-37"><a href="#cb28-37" aria-hidden="true" tabindex="-1"></a>ax.legend(loc <span class="op">=</span> (<span class="fl">0.91</span>,<span class="fl">0.4</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>&lt;matplotlib.legend.Legend&gt;</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="utils_challenge_files/figure-html/cell-24-output-2.png" class="img-fluid"></p>
</div>
</div>
</section>
</section>
<section id="segments-pairing" class="level2">
<h2 class="anchored" data-anchor-id="segments-pairing">Segments pairing</h2>
<p>Here we focus on pairing the segments arising from a list of changepoints. We will use this to latter compare the predicted physical properties for each segment</p>
<hr>
<p><a href="https://github.com/gorka.munoz/andi_datasets/blob/master/andi_datasets/utils_challenge.py#L577" target="_blank" style="float:right; font-size:smaller">source</a></p>
<section id="create_binary_segment" class="level3">
<h3 class="anchored" data-anchor-id="create_binary_segment">create_binary_segment</h3>
<blockquote class="blockquote">
<pre><code> create_binary_segment (CP:list, T:int)</code></pre>
</blockquote>
<p>Given a set of changepoints and the lenght of the trajectory, create segments which are equal to one if the segment takes place at that position and zero otherwise.</p>
<table class="table">
<colgroup>
<col style="width: 9%">
<col style="width: 38%">
<col style="width: 52%">
</colgroup>
<thead>
<tr class="header">
<th></th>
<th><strong>Type</strong></th>
<th><strong>Details</strong></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>CP</td>
<td>list</td>
<td>list of changepoints</td>
</tr>
<tr class="even">
<td>T</td>
<td>int</td>
<td>length of the trajectory</td>
</tr>
<tr class="odd">
<td><strong>Returns</strong></td>
<td><strong>list</strong></td>
<td><strong>list of arrays with value 1 in the temporal support of the current segment.</strong></td>
</tr>
</tbody>
</table>
<div class="cell">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a>T<span class="op">=</span> <span class="dv">50</span></span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a>GT <span class="op">=</span> np.sort(np.random.choice(np.arange(<span class="dv">1</span>,T), <span class="dv">10</span>, replace <span class="op">=</span> <span class="va">False</span>))</span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize <span class="op">=</span> (<span class="dv">4</span>,<span class="dv">3</span>))</span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> idx, x <span class="kw">in</span> <span class="bu">enumerate</span>(create_binary_segment(GT, T)):</span>
<span id="cb31-5"><a href="#cb31-5" aria-hidden="true" tabindex="-1"></a>    plt.plot(x<span class="op">*</span>idx, <span class="st">'o'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="utils_challenge_files/figure-html/cell-26-output-1.png" class="img-fluid"></p>
</div>
</div>
<hr>
<p><a href="https://github.com/gorka.munoz/andi_datasets/blob/master/andi_datasets/utils_challenge.py#L593" target="_blank" style="float:right; font-size:smaller">source</a></p>
</section>
<section id="jaccard_between_segments" class="level3">
<h3 class="anchored" data-anchor-id="jaccard_between_segments">jaccard_between_segments</h3>
<blockquote class="blockquote">
<pre><code> jaccard_between_segments (gt, pred)</code></pre>
</blockquote>
<p>Given two segments, calculates the Jaccard index between them by considering TP as correct labeling, FN as missed events and FP leftover predictions.</p>
<table class="table">
<colgroup>
<col style="width: 9%">
<col style="width: 38%">
<col style="width: 52%">
</colgroup>
<thead>
<tr class="header">
<th></th>
<th><strong>Type</strong></th>
<th><strong>Details</strong></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>gt</td>
<td>array</td>
<td>groundtruth segment, equal to one in the temporal support of the given segment, zero otherwise.</td>
</tr>
<tr class="even">
<td>pred</td>
<td>array</td>
<td>predicted segment, equal to one in the temporal support of the given segment, zero otherwise.</td>
</tr>
<tr class="odd">
<td><strong>Returns</strong></td>
<td><strong>float</strong></td>
<td><strong>Jaccard index between the given segments.</strong></td>
</tr>
</tbody>
</table>
<hr>
<p><a href="https://github.com/gorka.munoz/andi_datasets/blob/master/andi_datasets/utils_challenge.py#L626" target="_blank" style="float:right; font-size:smaller">source</a></p>
</section>
<section id="segment_assignment" class="level3">
<h3 class="anchored" data-anchor-id="segment_assignment">segment_assignment</h3>
<blockquote class="blockquote">
<pre><code> segment_assignment (GT, preds, T:int=None)</code></pre>
</blockquote>
<p>Given a list of groundtruth and predicted changepoints, generates a set of segments. Then constructs a cost matrix by calculting the Jaccard Index between segments. From this cost matrix, we solve the assignment problem via the Munkres algorithm (aka Hungarian algorithm) and returns two arrays containing the index of the groundtruth and predicted segments, respectively.</p>
<p>If T = None, then we consider that GT and preds may have different lenghts. In that case, the end of the segments is the the last CP of each set of CPs.</p>
<table class="table">
<colgroup>
<col style="width: 6%">
<col style="width: 25%">
<col style="width: 34%">
<col style="width: 34%">
</colgroup>
<thead>
<tr class="header">
<th></th>
<th><strong>Type</strong></th>
<th><strong>Default</strong></th>
<th><strong>Details</strong></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>GT</td>
<td>list</td>
<td></td>
<td>List of groundtruth change points.</td>
</tr>
<tr class="even">
<td>preds</td>
<td>list</td>
<td></td>
<td>List of predicted change points.</td>
</tr>
<tr class="odd">
<td>T</td>
<td>int</td>
<td>None</td>
<td>Length of the trajectory. If None, considers different GT and preds length.</td>
</tr>
<tr class="even">
<td><strong>Returns</strong></td>
<td><strong>tuple</strong></td>
<td></td>
<td><strong>- tuple of two arrays, each corresponding to the assigned GT and pred changepoints<br>- Cost matrix calculated via JI of segments </strong></td>
</tr>
</tbody>
</table>
<section id="examples" class="level4">
<h4 class="anchored" data-anchor-id="examples">Examples</h4>
<p><strong>Predictions close to groundtruth</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a>T <span class="op">=</span> <span class="dv">200</span><span class="op">;</span> </span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a>ngts <span class="op">=</span> <span class="dv">10</span><span class="op">;</span> </span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a>GT <span class="op">=</span> np.sort(np.random.choice(np.arange(<span class="dv">1</span>,T), ngts, replace <span class="op">=</span> <span class="va">False</span>))</span>
<span id="cb34-4"><a href="#cb34-4" aria-hidden="true" tabindex="-1"></a>preds <span class="op">=</span> np.sort(GT <span class="op">+</span> np.random.randint(<span class="op">-</span><span class="dv">5</span>, <span class="dv">5</span>, <span class="dv">1</span>) )</span>
<span id="cb34-5"><a href="#cb34-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-6"><a href="#cb34-6" aria-hidden="true" tabindex="-1"></a>seg_GT <span class="op">=</span> create_binary_segment(GT, T)</span>
<span id="cb34-7"><a href="#cb34-7" aria-hidden="true" tabindex="-1"></a>seg_preds <span class="op">=</span> create_binary_segment(preds, T)   </span>
<span id="cb34-8"><a href="#cb34-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-9"><a href="#cb34-9" aria-hidden="true" tabindex="-1"></a>[row_ind, col_ind], cost_matrix <span class="op">=</span> segment_assignment(GT, preds, T)</span>
<span id="cb34-10"><a href="#cb34-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-11"><a href="#cb34-11" aria-hidden="true" tabindex="-1"></a>fig, axs <span class="op">=</span> plt.subplots(<span class="dv">2</span>, <span class="dv">5</span>, figsize <span class="op">=</span> (<span class="dv">15</span>, <span class="dv">6</span>))</span>
<span id="cb34-12"><a href="#cb34-12" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> r, c, ax <span class="kw">in</span> <span class="bu">zip</span>(row_ind, col_ind, axs.flatten()):</span>
<span id="cb34-13"><a href="#cb34-13" aria-hidden="true" tabindex="-1"></a>    ax.set_title(<span class="ss">f'1 - JI = </span><span class="sc">{</span>np<span class="sc">.</span><span class="bu">round</span>(cost_matrix[r, c], <span class="dv">2</span>)<span class="sc">}</span><span class="ss">'</span>)</span>
<span id="cb34-14"><a href="#cb34-14" aria-hidden="true" tabindex="-1"></a>    ax.plot(seg_GT[r], label <span class="op">=</span> <span class="st">'Groundtruth'</span>)</span>
<span id="cb34-15"><a href="#cb34-15" aria-hidden="true" tabindex="-1"></a>    ax.plot(seg_preds[c], label <span class="op">=</span> <span class="st">'Prediction'</span>)</span>
<span id="cb34-16"><a href="#cb34-16" aria-hidden="true" tabindex="-1"></a>axs[<span class="dv">0</span>,<span class="dv">0</span>].legend()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>&lt;matplotlib.legend.Legend&gt;</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="utils_challenge_files/figure-html/cell-29-output-2.png" class="img-fluid"></p>
</div>
</div>
<p><strong>Different size between predictions and trues</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a>T1 <span class="op">=</span> <span class="dv">200</span><span class="op">;</span> T2 <span class="op">=</span> <span class="dv">100</span></span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a>ngts <span class="op">=</span> <span class="dv">10</span><span class="op">;</span> </span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a>GT <span class="op">=</span> np.sort(np.random.choice(np.arange(<span class="dv">1</span>,T1), ngts, replace <span class="op">=</span> <span class="va">False</span>))</span>
<span id="cb36-4"><a href="#cb36-4" aria-hidden="true" tabindex="-1"></a>preds <span class="op">=</span> np.sort(np.random.choice(np.arange(<span class="dv">1</span>,T2), <span class="dv">5</span>, replace <span class="op">=</span> <span class="va">False</span>))</span>
<span id="cb36-5"><a href="#cb36-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-6"><a href="#cb36-6" aria-hidden="true" tabindex="-1"></a>seg_GT <span class="op">=</span> create_binary_segment(GT, T1)</span>
<span id="cb36-7"><a href="#cb36-7" aria-hidden="true" tabindex="-1"></a>seg_preds <span class="op">=</span> create_binary_segment(preds, T2)   </span>
<span id="cb36-8"><a href="#cb36-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-9"><a href="#cb36-9" aria-hidden="true" tabindex="-1"></a>[row_ind, col_ind], cost_matrix <span class="op">=</span> segment_assignment(GT, preds)</span>
<span id="cb36-10"><a href="#cb36-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-11"><a href="#cb36-11" aria-hidden="true" tabindex="-1"></a>fig, axs <span class="op">=</span> plt.subplots(<span class="dv">1</span>, <span class="dv">5</span>, figsize <span class="op">=</span> (<span class="dv">15</span>, <span class="dv">3</span>))</span>
<span id="cb36-12"><a href="#cb36-12" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> r, c, ax <span class="kw">in</span> <span class="bu">zip</span>(row_ind, col_ind, axs.flatten()):</span>
<span id="cb36-13"><a href="#cb36-13" aria-hidden="true" tabindex="-1"></a>    ax.set_title(<span class="ss">f'1 - JI = </span><span class="sc">{</span>np<span class="sc">.</span><span class="bu">round</span>(cost_matrix[r, c], <span class="dv">2</span>)<span class="sc">}</span><span class="ss">'</span>)</span>
<span id="cb36-14"><a href="#cb36-14" aria-hidden="true" tabindex="-1"></a>    ax.plot(seg_GT[r], label <span class="op">=</span> <span class="st">'Groundtruth'</span>)</span>
<span id="cb36-15"><a href="#cb36-15" aria-hidden="true" tabindex="-1"></a>    ax.plot(seg_preds[c], label <span class="op">=</span> <span class="st">'Prediction'</span>)</span>
<span id="cb36-16"><a href="#cb36-16" aria-hidden="true" tabindex="-1"></a>axs[<span class="dv">0</span>].legend()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>&lt;matplotlib.legend.Legend&gt;</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="utils_challenge_files/figure-html/cell-30-output-2.png" class="img-fluid"></p>
</div>
</div>
<p><strong>Predictions very different to groundtruth</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a>T <span class="op">=</span> <span class="dv">200</span><span class="op">;</span></span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a>ngts <span class="op">=</span> <span class="dv">5</span><span class="op">;</span> npreds <span class="op">=</span> <span class="dv">5</span><span class="op">;</span></span>
<span id="cb38-3"><a href="#cb38-3" aria-hidden="true" tabindex="-1"></a>GT <span class="op">=</span> np.sort(np.random.choice(np.arange(<span class="dv">1</span>,T), ngts, replace <span class="op">=</span> <span class="va">False</span>))</span>
<span id="cb38-4"><a href="#cb38-4" aria-hidden="true" tabindex="-1"></a>preds <span class="op">=</span> np.sort(np.random.choice(np.arange(<span class="dv">1</span>,T), npreds, replace <span class="op">=</span> <span class="va">False</span>))  </span>
<span id="cb38-5"><a href="#cb38-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-6"><a href="#cb38-6" aria-hidden="true" tabindex="-1"></a>seg_GT <span class="op">=</span> create_binary_segment(GT, T)</span>
<span id="cb38-7"><a href="#cb38-7" aria-hidden="true" tabindex="-1"></a>seg_preds <span class="op">=</span> create_binary_segment(preds, T)</span>
<span id="cb38-8"><a href="#cb38-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-9"><a href="#cb38-9" aria-hidden="true" tabindex="-1"></a>[row_ind, col_ind], cost_matrix <span class="op">=</span> segment_assignment(GT, preds, T)</span>
<span id="cb38-10"><a href="#cb38-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-11"><a href="#cb38-11" aria-hidden="true" tabindex="-1"></a>fig, axs <span class="op">=</span> plt.subplots(<span class="dv">1</span>, <span class="dv">5</span>, figsize <span class="op">=</span> (<span class="dv">15</span>, <span class="dv">3</span>))</span>
<span id="cb38-12"><a href="#cb38-12" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> r, c, ax <span class="kw">in</span> <span class="bu">zip</span>(row_ind, col_ind, axs.flatten()):</span>
<span id="cb38-13"><a href="#cb38-13" aria-hidden="true" tabindex="-1"></a>    ax.set_title(<span class="ss">f'1 - JI = </span><span class="sc">{</span>np<span class="sc">.</span><span class="bu">round</span>(cost_matrix[r, c], <span class="dv">2</span>)<span class="sc">}</span><span class="ss">'</span>)</span>
<span id="cb38-14"><a href="#cb38-14" aria-hidden="true" tabindex="-1"></a>    ax.plot(seg_GT[r], label <span class="op">=</span> <span class="st">'Groundtruth'</span>)</span>
<span id="cb38-15"><a href="#cb38-15" aria-hidden="true" tabindex="-1"></a>    ax.plot(seg_preds[c], label <span class="op">=</span> <span class="st">'Prediction'</span>)</span>
<span id="cb38-16"><a href="#cb38-16" aria-hidden="true" tabindex="-1"></a>axs[<span class="dv">0</span>].legend()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>&lt;matplotlib.legend.Legend&gt;</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="utils_challenge_files/figure-html/cell-31-output-2.png" class="img-fluid"></p>
</div>
</div>
</section>
</section>
</section>
<section id="segment-properties-comparison" class="level2">
<h2 class="anchored" data-anchor-id="segment-properties-comparison">Segment properties comparison</h2>
<p>We use the segment pairing functions that we have defined above to compute various metrics between the properties of predicted and groundtruth segments.</p>
<section id="metrics-of-segment-properties" class="level3">
<h3 class="anchored" data-anchor-id="metrics-of-segment-properties">Metrics of segment properties</h3>
<hr>
<p><a href="https://github.com/gorka.munoz/andi_datasets/blob/master/andi_datasets/utils_challenge.py#L721" target="_blank" style="float:right; font-size:smaller">source</a></p>
</section>
<section id="metric_diffusive_state" class="level3">
<h3 class="anchored" data-anchor-id="metric_diffusive_state">metric_diffusive_state</h3>
<blockquote class="blockquote">
<pre><code> metric_diffusive_state (gt=None, pred=None, max_error=False)</code></pre>
</blockquote>
<p>Compute the F1 score between diffusive states.</p>
<hr>
<p><a href="https://github.com/gorka.munoz/andi_datasets/blob/master/andi_datasets/utils_challenge.py#L700" target="_blank" style="float:right; font-size:smaller">source</a></p>
</section>
<section id="metric_diffusion_coefficient" class="level3">
<h3 class="anchored" data-anchor-id="metric_diffusion_coefficient">metric_diffusion_coefficient</h3>
<blockquote class="blockquote">
<pre><code> metric_diffusion_coefficient (gt=None, pred=None, threshold_min=1e-12,
                               max_error=190.86835960820298)</code></pre>
</blockquote>
<p>Compute the mean squared log error (msle) between diffusion coefficients. Checks the current bounds of diffusion from models_phenom to calculate the maximum error.</p>
<hr>
<p><a href="https://github.com/gorka.munoz/andi_datasets/blob/master/andi_datasets/utils_challenge.py#L687" target="_blank" style="float:right; font-size:smaller">source</a></p>
</section>
<section id="metric_anomalous_exponent" class="level3">
<h3 class="anchored" data-anchor-id="metric_anomalous_exponent">metric_anomalous_exponent</h3>
<blockquote class="blockquote">
<pre><code> metric_anomalous_exponent (gt=None, pred=None, max_error=1.999)</code></pre>
</blockquote>
<p>Compute the mean absolute error (mae) between anomalous exponents. Checks the current bounds of anomalous exponents from models_phenom to calculate the maximum error.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a>x <span class="op">=</span> np.random.rand(<span class="dv">100</span>)</span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a>y <span class="op">=</span> np.random.rand(<span class="dv">100</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a>metric_diffusion_coefficient(x<span class="op">+</span><span class="dv">2</span>,y<span class="op">+</span><span class="dv">2</span>, threshold_min<span class="op">=-</span><span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>0.014261449910975834</code></pre>
</div>
</div>
</section>
<section id="pairing-and-metrics-calculation" class="level3">
<h3 class="anchored" data-anchor-id="pairing-and-metrics-calculation">Pairing and metrics calculation</h3>
<hr>
<p><a href="https://github.com/gorka.munoz/andi_datasets/blob/master/andi_datasets/utils_challenge.py#L728" target="_blank" style="float:right; font-size:smaller">source</a></p>
</section>
<section id="check_no_changepoints" class="level3">
<h3 class="anchored" data-anchor-id="check_no_changepoints">check_no_changepoints</h3>
<blockquote class="blockquote">
<pre><code> check_no_changepoints (GT_cp, GT_alpha, GT_D, GT_s, preds_cp,
                        preds_alpha, preds_D, preds_s, T:bool|int=None)</code></pre>
</blockquote>
<p>Given predicionts over changepoints and variables, checks if in both GT and preds there is an absence of change point. If so, takes that into account to pair variables.</p>
<table class="table">
<colgroup>
<col style="width: 6%">
<col style="width: 25%">
<col style="width: 34%">
<col style="width: 34%">
</colgroup>
<thead>
<tr class="header">
<th></th>
<th><strong>Type</strong></th>
<th><strong>Default</strong></th>
<th><strong>Details</strong></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>GT_cp</td>
<td>list, int, float</td>
<td></td>
<td>Groundtruth change points</td>
</tr>
<tr class="even">
<td>GT_alpha</td>
<td>list, float</td>
<td></td>
<td>Groundtruth anomalous exponent</td>
</tr>
<tr class="odd">
<td>GT_D</td>
<td>list, float</td>
<td></td>
<td>Groundtruth diffusion coefficient</td>
</tr>
<tr class="even">
<td>GT_s</td>
<td>list, float</td>
<td></td>
<td>Groundtruth diffusive state</td>
</tr>
<tr class="odd">
<td>preds_cp</td>
<td>list, int, float</td>
<td></td>
<td>Predicted change points</td>
</tr>
<tr class="even">
<td>preds_alpha</td>
<td>list, float</td>
<td></td>
<td>Predicted anomalous exponent</td>
</tr>
<tr class="odd">
<td>preds_D</td>
<td>list, float</td>
<td></td>
<td>Predicted diffusion coefficient</td>
</tr>
<tr class="even">
<td>preds_s</td>
<td>list, float</td>
<td></td>
<td>Predicted diffusive state</td>
</tr>
<tr class="odd">
<td>T</td>
<td>bool | int</td>
<td>None</td>
<td>(optional) Length of the trajectories. If none, last change point is length.</td>
</tr>
<tr class="even">
<td><strong>Returns</strong></td>
<td><strong>tuple</strong></td>
<td></td>
<td><strong>- False if there are change points. True if there were missing change points.<br>- Next three are either all Nones if change points were detected, or paired exponents, <br>coefficient and states if some change points were missing.</strong></td>
</tr>
</tbody>
</table>
<hr>
<p><a href="https://github.com/gorka.munoz/andi_datasets/blob/master/andi_datasets/utils_challenge.py#L804" target="_blank" style="float:right; font-size:smaller">source</a></p>
</section>
<section id="segment_property_errors" class="level3">
<h3 class="anchored" data-anchor-id="segment_property_errors">segment_property_errors</h3>
<blockquote class="blockquote">
<pre><code> segment_property_errors (GT_cp, GT_alpha, GT_D, GT_s, preds_cp,
                          preds_alpha, preds_D, preds_s,
                          return_pairs=False, T=None)</code></pre>
</blockquote>
<p>Given predicionts over change points and the value of diffusion parameters in the generated segments, computes the defined metrics.</p>
<table class="table">
<colgroup>
<col style="width: 6%">
<col style="width: 25%">
<col style="width: 34%">
<col style="width: 34%">
</colgroup>
<thead>
<tr class="header">
<th></th>
<th><strong>Type</strong></th>
<th><strong>Default</strong></th>
<th><strong>Details</strong></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>GT_cp</td>
<td>list, int, float</td>
<td></td>
<td>Groundtruth change points</td>
</tr>
<tr class="even">
<td>GT_alpha</td>
<td>list, float</td>
<td></td>
<td>Groundtruth anomalous exponent</td>
</tr>
<tr class="odd">
<td>GT_D</td>
<td>list, float</td>
<td></td>
<td>Groundtruth diffusion coefficient</td>
</tr>
<tr class="even">
<td>GT_s</td>
<td>list, float</td>
<td></td>
<td>Groundtruth diffusive state</td>
</tr>
<tr class="odd">
<td>preds_cp</td>
<td>list, int, float</td>
<td></td>
<td>Predicted change points</td>
</tr>
<tr class="even">
<td>preds_alpha</td>
<td>list, float</td>
<td></td>
<td>Predicted anomalous exponent</td>
</tr>
<tr class="odd">
<td>preds_D</td>
<td>list, float</td>
<td></td>
<td>Predicted diffusion coefficient</td>
</tr>
<tr class="even">
<td>preds_s</td>
<td>list, float</td>
<td></td>
<td>Predicted diffusive state</td>
</tr>
<tr class="odd">
<td>return_pairs</td>
<td>bool</td>
<td>False</td>
<td>If True, returns the assigment pairs for each diffusive property.</td>
</tr>
<tr class="even">
<td>T</td>
<td>NoneType</td>
<td>None</td>
<td>(optional) Length of the trajectories. If none, last change point is length.</td>
</tr>
<tr class="odd">
<td><strong>Returns</strong></td>
<td><strong>tuple</strong></td>
<td></td>
<td><strong>- if return_pairs = True, returns the assigned pairs of diffusive properties<br>- if return_pairs = False, returns the errors for each diffusive property</strong></td>
</tr>
</tbody>
</table>
<p>We generate some random predictions to check how the metrics behave. We consider errors also in the change point predictions, hence there will be some segment mismatchings, which will affect the diffusive properties predictions:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a>T <span class="op">=</span> <span class="dv">200</span><span class="op">;</span> </span>
<span id="cb48-2"><a href="#cb48-2" aria-hidden="true" tabindex="-1"></a>ngts <span class="op">=</span> <span class="dv">10</span><span class="op">;</span> </span>
<span id="cb48-3"><a href="#cb48-3" aria-hidden="true" tabindex="-1"></a>errors_alpha <span class="op">=</span> np.linspace(<span class="dv">0</span>, <span class="dv">1</span>, ngts)</span>
<span id="cb48-4"><a href="#cb48-4" aria-hidden="true" tabindex="-1"></a>errors_d <span class="op">=</span> np.linspace(<span class="dv">0</span>, <span class="dv">10</span>, ngts)</span>
<span id="cb48-5"><a href="#cb48-5" aria-hidden="true" tabindex="-1"></a>errors_s <span class="op">=</span> np.linspace(<span class="dv">0</span>, <span class="dv">1</span>, ngts)</span>
<span id="cb48-6"><a href="#cb48-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-7"><a href="#cb48-7" aria-hidden="true" tabindex="-1"></a>metric_a, metric_d, metric_s <span class="op">=</span> [], [], []</span>
<span id="cb48-8"><a href="#cb48-8" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> error_a, error_d, error_s <span class="kw">in</span> <span class="bu">zip</span>(errors_alpha, errors_d, errors_s):</span>
<span id="cb48-9"><a href="#cb48-9" aria-hidden="true" tabindex="-1"></a>    la, ld, ls <span class="op">=</span> [], [], []</span>
<span id="cb48-10"><a href="#cb48-10" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> _ <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">100</span>):</span>
<span id="cb48-11"><a href="#cb48-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-12"><a href="#cb48-12" aria-hidden="true" tabindex="-1"></a>        GT_cp <span class="op">=</span> np.sort(np.random.choice(np.arange(<span class="dv">1</span>,T<span class="op">-</span><span class="dv">1</span>), ngts, replace <span class="op">=</span> <span class="va">False</span>))</span>
<span id="cb48-13"><a href="#cb48-13" aria-hidden="true" tabindex="-1"></a>        preds_cp <span class="op">=</span> np.sort(np.random.choice(np.arange(<span class="dv">1</span>,T<span class="op">-</span><span class="dv">1</span>), ngts, replace <span class="op">=</span> <span class="va">False</span>)) </span>
<span id="cb48-14"><a href="#cb48-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-15"><a href="#cb48-15" aria-hidden="true" tabindex="-1"></a>        GT_alpha <span class="op">=</span> np.random.rand(GT_cp.shape[<span class="dv">0</span>]<span class="op">+</span><span class="dv">1</span>)</span>
<span id="cb48-16"><a href="#cb48-16" aria-hidden="true" tabindex="-1"></a>        preds_alpha <span class="op">=</span> GT_alpha <span class="op">+</span> np.random.randn(preds_cp.shape[<span class="dv">0</span>]<span class="op">+</span><span class="dv">1</span>)<span class="op">*</span>error_a</span>
<span id="cb48-17"><a href="#cb48-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-18"><a href="#cb48-18" aria-hidden="true" tabindex="-1"></a>        GT_D <span class="op">=</span> np.<span class="bu">abs</span>(np.random.randn(GT_cp.shape[<span class="dv">0</span>]<span class="op">+</span><span class="dv">1</span>)<span class="op">*</span><span class="dv">10</span>)</span>
<span id="cb48-19"><a href="#cb48-19" aria-hidden="true" tabindex="-1"></a>        preds_D <span class="op">=</span> GT_D <span class="op">+</span> np.<span class="bu">abs</span>(np.random.randn(preds_cp.shape[<span class="dv">0</span>]<span class="op">+</span><span class="dv">1</span>))<span class="op">*</span>error_d</span>
<span id="cb48-20"><a href="#cb48-20" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb48-21"><a href="#cb48-21" aria-hidden="true" tabindex="-1"></a>        GT_s <span class="op">=</span> np.random.randint(<span class="dv">0</span>, <span class="dv">5</span>, GT_cp.shape[<span class="dv">0</span>]<span class="op">+</span><span class="dv">1</span>)</span>
<span id="cb48-22"><a href="#cb48-22" aria-hidden="true" tabindex="-1"></a>        coin <span class="op">=</span> np.random.rand(<span class="bu">len</span>(GT_s))</span>
<span id="cb48-23"><a href="#cb48-23" aria-hidden="true" tabindex="-1"></a>        preds_s <span class="op">=</span> GT_s.copy()</span>
<span id="cb48-24"><a href="#cb48-24" aria-hidden="true" tabindex="-1"></a>        preds_s[coin <span class="op">&lt;</span> error_s] <span class="op">=</span> np.random.randint(<span class="dv">0</span>, <span class="dv">5</span>, <span class="bu">len</span>(coin[coin <span class="op">&lt;</span> error_s]))</span>
<span id="cb48-25"><a href="#cb48-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-26"><a href="#cb48-26" aria-hidden="true" tabindex="-1"></a>        m_a, m_d, m_s <span class="op">=</span> segment_property_errors(GT_cp, GT_alpha, GT_D, GT_s, preds_cp, preds_alpha, preds_D, preds_s, T <span class="op">=</span> T)</span>
<span id="cb48-27"><a href="#cb48-27" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb48-28"><a href="#cb48-28" aria-hidden="true" tabindex="-1"></a>        la.append(m_a)<span class="op">;</span> ld.append(m_d)<span class="op">;</span> ls.append(m_s)</span>
<span id="cb48-29"><a href="#cb48-29" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb48-30"><a href="#cb48-30" aria-hidden="true" tabindex="-1"></a>    metric_a.append(np.mean(la))</span>
<span id="cb48-31"><a href="#cb48-31" aria-hidden="true" tabindex="-1"></a>    metric_d.append(np.mean(ld))    </span>
<span id="cb48-32"><a href="#cb48-32" aria-hidden="true" tabindex="-1"></a>    metric_s.append(np.mean(ls))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>With no error in the changepoint predicitions:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots(<span class="dv">1</span>, <span class="dv">3</span>, figsize <span class="op">=</span> (<span class="dv">9</span>, <span class="dv">3</span>), tight_layout <span class="op">=</span> <span class="va">True</span>)</span>
<span id="cb49-2"><a href="#cb49-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-3"><a href="#cb49-3" aria-hidden="true" tabindex="-1"></a>ax[<span class="dv">0</span>].plot(np.arange(ngts), errors_alpha, c <span class="op">=</span> <span class="st">'C0'</span>, ls <span class="op">=</span> <span class="st">'--'</span>, label <span class="op">=</span> <span class="st">'Expected with no assigment error'</span>)</span>
<span id="cb49-4"><a href="#cb49-4" aria-hidden="true" tabindex="-1"></a>ax[<span class="dv">0</span>].plot(np.arange(ngts), metric_a, c <span class="op">=</span> <span class="st">'C0'</span>)</span>
<span id="cb49-5"><a href="#cb49-5" aria-hidden="true" tabindex="-1"></a>ax[<span class="dv">0</span>].set_title(<span class="vs">r'Error in $\alpha$ (MAE)'</span>)</span>
<span id="cb49-6"><a href="#cb49-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-7"><a href="#cb49-7" aria-hidden="true" tabindex="-1"></a><span class="co">#ax[1].plot(np.arange(ngts), errors_d, c = 'C1', ls = '--')</span></span>
<span id="cb49-8"><a href="#cb49-8" aria-hidden="true" tabindex="-1"></a>ax[<span class="dv">1</span>].plot(np.arange(ngts), metric_d, c <span class="op">=</span> <span class="st">'C1'</span>)</span>
<span id="cb49-9"><a href="#cb49-9" aria-hidden="true" tabindex="-1"></a>ax[<span class="dv">1</span>].set_title(<span class="vs">r'Error in $D$ (MSLE)'</span>)</span>
<span id="cb49-10"><a href="#cb49-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-11"><a href="#cb49-11" aria-hidden="true" tabindex="-1"></a>ax[<span class="dv">2</span>].plot(np.arange(ngts), metric_s, c <span class="op">=</span> <span class="st">'C1'</span>)</span>
<span id="cb49-12"><a href="#cb49-12" aria-hidden="true" tabindex="-1"></a>ax[<span class="dv">2</span>].set_title(<span class="vs">r'Error in states (JI)'</span>)</span>
<span id="cb49-13"><a href="#cb49-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-14"><a href="#cb49-14" aria-hidden="true" tabindex="-1"></a>plt.setp(ax, xlabel <span class="op">=</span> <span class="st">'Error magnitude'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>[Text(0.5, 0, 'Error magnitude'),
 Text(0.5, 0, 'Error magnitude'),
 Text(0.5, 0, 'Error magnitude')]</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="utils_challenge_files/figure-html/cell-40-output-2.png" class="img-fluid"></p>
</div>
</div>
<p>With error in the changepoint predicitions:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots(<span class="dv">1</span>, <span class="dv">3</span>, figsize <span class="op">=</span> (<span class="dv">9</span>, <span class="dv">3</span>), tight_layout <span class="op">=</span> <span class="va">True</span>)</span>
<span id="cb51-2"><a href="#cb51-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-3"><a href="#cb51-3" aria-hidden="true" tabindex="-1"></a>ax[<span class="dv">0</span>].plot(np.arange(ngts), errors_alpha, c <span class="op">=</span> <span class="st">'C0'</span>, ls <span class="op">=</span> <span class="st">'--'</span>, label <span class="op">=</span> <span class="st">'Expected with no assigment error'</span>)</span>
<span id="cb51-4"><a href="#cb51-4" aria-hidden="true" tabindex="-1"></a>ax[<span class="dv">0</span>].plot(np.arange(ngts), metric_a, c <span class="op">=</span> <span class="st">'C0'</span>)</span>
<span id="cb51-5"><a href="#cb51-5" aria-hidden="true" tabindex="-1"></a>ax[<span class="dv">0</span>].set_title(<span class="vs">r'Error in $\alpha$ (MAE)'</span>)</span>
<span id="cb51-6"><a href="#cb51-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-7"><a href="#cb51-7" aria-hidden="true" tabindex="-1"></a><span class="co">#ax[1].plot(np.arange(ngts), errors_d, c = 'C1', ls = '--')</span></span>
<span id="cb51-8"><a href="#cb51-8" aria-hidden="true" tabindex="-1"></a>ax[<span class="dv">1</span>].plot(np.arange(ngts), metric_d, c <span class="op">=</span> <span class="st">'C1'</span>)</span>
<span id="cb51-9"><a href="#cb51-9" aria-hidden="true" tabindex="-1"></a>ax[<span class="dv">1</span>].set_title(<span class="vs">r'Error in $D$ (MSLE)'</span>)</span>
<span id="cb51-10"><a href="#cb51-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-11"><a href="#cb51-11" aria-hidden="true" tabindex="-1"></a>ax[<span class="dv">2</span>].plot(np.arange(ngts), metric_s, c <span class="op">=</span> <span class="st">'C1'</span>)</span>
<span id="cb51-12"><a href="#cb51-12" aria-hidden="true" tabindex="-1"></a>ax[<span class="dv">2</span>].set_title(<span class="vs">r'Error in states (JI)'</span>)</span>
<span id="cb51-13"><a href="#cb51-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-14"><a href="#cb51-14" aria-hidden="true" tabindex="-1"></a>plt.setp(ax, xlabel <span class="op">=</span> <span class="st">'Error magnitude'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>[Text(0.5, 0, 'Error magnitude'),
 Text(0.5, 0, 'Error magnitude'),
 Text(0.5, 0, 'Error magnitude')]</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="utils_challenge_files/figure-html/cell-41-output-2.png" class="img-fluid"></p>
</div>
</div>
</section>
</section>
<section id="ensemble-metrics" class="level2">
<h2 class="anchored" data-anchor-id="ensemble-metrics">Ensemble metrics</h2>
<hr>
<p><a href="https://github.com/gorka.munoz/andi_datasets/blob/master/andi_datasets/utils_challenge.py#L885" target="_blank" style="float:right; font-size:smaller">source</a></p>
<section id="extract_ensemble" class="level3">
<h3 class="anchored" data-anchor-id="extract_ensemble">extract_ensemble</h3>
<blockquote class="blockquote">
<pre><code> extract_ensemble (state_label, dic)</code></pre>
</blockquote>
<p>Given an array of the diffusive state and a dictionary with the diffusion information, returns a summary of the ensemble properties for the current dataset.</p>
<table class="table">
<colgroup>
<col style="width: 9%">
<col style="width: 38%">
<col style="width: 52%">
</colgroup>
<thead>
<tr class="header">
<th></th>
<th><strong>Type</strong></th>
<th><strong>Details</strong></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>state_label</td>
<td>array</td>
<td>Array containing the diffusive state of the particles in the dataset.<br>For multi-state and dimerization, this must be the number associated to the<br>state (for dimerization, 0 is free, 1 is dimerized). For the rest, we follow<br>the numeration of models_phenom().lab_state.</td>
</tr>
<tr class="even">
<td>dic</td>
<td>dict</td>
<td>Dictionary containing the information of the input dataset.</td>
</tr>
<tr class="odd">
<td><strong>Returns</strong></td>
<td><strong>array</strong></td>
<td><strong>Matrix containing the ensemble information of the input dataset. It has the following shape:<br> |mu_alpha1 mu_alpha2 … |<br> |sigma_alpha1 sigma_alpha2 … |<br> |mu_D1 mu_D1 … | <br> |sigma_D1 sigma_D2 … |<br> |counts_state1 counts_state2 … |</strong></td>
</tr>
</tbody>
</table>
<hr>
<p><a href="https://github.com/gorka.munoz/andi_datasets/blob/master/andi_datasets/utils_challenge.py#L972" target="_blank" style="float:right; font-size:smaller">source</a></p>
</section>
<section id="multimode_dist" class="level3">
<h3 class="anchored" data-anchor-id="multimode_dist">multimode_dist</h3>
<blockquote class="blockquote">
<pre><code> multimode_dist (params, weights, bound, x, normalized=False)</code></pre>
</blockquote>
<p>Generates a multimodal distribution with given parameters. Also accounts for single mode if weight is float or int.</p>
<table class="table">
<colgroup>
<col style="width: 6%">
<col style="width: 25%">
<col style="width: 34%">
<col style="width: 34%">
</colgroup>
<thead>
<tr class="header">
<th></th>
<th><strong>Type</strong></th>
<th><strong>Default</strong></th>
<th><strong>Details</strong></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>params</td>
<td>list</td>
<td></td>
<td>Mean and variances of every mode.</td>
</tr>
<tr class="even">
<td>weights</td>
<td>list, float</td>
<td></td>
<td>Weight of every mode. If float, we consider a single mode.</td>
</tr>
<tr class="odd">
<td>bound</td>
<td>tuple</td>
<td></td>
<td>Bounds (min, max) of the functions support.</td>
</tr>
<tr class="even">
<td>x</td>
<td>array</td>
<td></td>
<td>Support upon which the distribution is created.</td>
</tr>
<tr class="odd">
<td>normalized</td>
<td>bool</td>
<td>False</td>
<td></td>
</tr>
<tr class="even">
<td><strong>Returns</strong></td>
<td><strong>array</strong></td>
<td></td>
<td><strong>Value of the distribution in each point of the given support</strong></td>
</tr>
</tbody>
</table>
<hr>
<p><a href="https://github.com/gorka.munoz/andi_datasets/blob/master/andi_datasets/utils_challenge.py#L1021" target="_blank" style="float:right; font-size:smaller">source</a></p>
</section>
<section id="distribution_distance" class="level3">
<h3 class="anchored" data-anchor-id="distribution_distance">distribution_distance</h3>
<blockquote class="blockquote">
<pre><code> distribution_distance (p:&lt;built-infunctionarray&gt;, q:&lt;built-
                        infunctionarray&gt;)</code></pre>
</blockquote>
<p>Calculates mean absolute error between two distributions.</p>
<table class="table">
<thead>
<tr class="header">
<th></th>
<th><strong>Type</strong></th>
<th><strong>Details</strong></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>p</td>
<td>array</td>
<td>distribution 1</td>
</tr>
<tr class="even">
<td>q</td>
<td>array</td>
<td>distribution 2</td>
</tr>
<tr class="odd">
<td><strong>Returns</strong></td>
<td><strong>float</strong></td>
<td><strong>distance between distributions</strong></td>
</tr>
</tbody>
</table>
<div class="cell">
<div class="sourceCode cell-code" id="cb56"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a>means <span class="op">=</span> np.linspace(<span class="dv">0</span>, <span class="dv">2</span>, <span class="dv">30</span>)</span>
<span id="cb56-2"><a href="#cb56-2" aria-hidden="true" tabindex="-1"></a>normalize <span class="op">=</span> <span class="va">False</span></span>
<span id="cb56-3"><a href="#cb56-3" aria-hidden="true" tabindex="-1"></a>fig <span class="op">=</span> plt.figure(figsize<span class="op">=</span>(<span class="dv">20</span>, <span class="dv">5</span>))</span>
<span id="cb56-4"><a href="#cb56-4" aria-hidden="true" tabindex="-1"></a>gs <span class="op">=</span> fig.add_gridspec(<span class="dv">2</span>, <span class="dv">10</span>)</span>
<span id="cb56-5"><a href="#cb56-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-6"><a href="#cb56-6" aria-hidden="true" tabindex="-1"></a><span class="co"># True distribution</span></span>
<span id="cb56-7"><a href="#cb56-7" aria-hidden="true" tabindex="-1"></a>x <span class="op">=</span> np.arange(<span class="dv">0</span>, <span class="dv">3</span>, <span class="fl">0.01</span>)</span>
<span id="cb56-8"><a href="#cb56-8" aria-hidden="true" tabindex="-1"></a>params <span class="op">=</span> [[<span class="fl">1.7</span>,<span class="fl">0.01</span>]]</span>
<span id="cb56-9"><a href="#cb56-9" aria-hidden="true" tabindex="-1"></a>weights <span class="op">=</span> [<span class="dv">1</span>]</span>
<span id="cb56-10"><a href="#cb56-10" aria-hidden="true" tabindex="-1"></a>true <span class="op">=</span> multimode_dist(params, weights, bound <span class="op">=</span> [<span class="dv">0</span>, <span class="dv">3</span>], x <span class="op">=</span> x, normalized <span class="op">=</span> normalize)</span>
<span id="cb56-11"><a href="#cb56-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-12"><a href="#cb56-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-13"><a href="#cb56-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-14"><a href="#cb56-14" aria-hidden="true" tabindex="-1"></a>KL <span class="op">=</span> []</span>
<span id="cb56-15"><a href="#cb56-15" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> idx, mean <span class="kw">in</span> <span class="bu">enumerate</span>(means):</span>
<span id="cb56-16"><a href="#cb56-16" aria-hidden="true" tabindex="-1"></a>    params <span class="op">=</span> [[mean, <span class="fl">0.01</span>]]</span>
<span id="cb56-17"><a href="#cb56-17" aria-hidden="true" tabindex="-1"></a>    weights <span class="op">=</span> [<span class="dv">1</span>]</span>
<span id="cb56-18"><a href="#cb56-18" aria-hidden="true" tabindex="-1"></a>    pred <span class="op">=</span> multimode_dist(params, weights, bound <span class="op">=</span> [<span class="dv">0</span>, <span class="dv">3</span>], x <span class="op">=</span> x, normalized <span class="op">=</span> normalize)  </span>
<span id="cb56-19"><a href="#cb56-19" aria-hidden="true" tabindex="-1"></a>    KL.append(distribution_distance(true, pred))  </span>
<span id="cb56-20"><a href="#cb56-20" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb56-21"><a href="#cb56-21" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> idx <span class="op">%</span> <span class="dv">3</span> <span class="op">==</span> <span class="dv">0</span>:</span>
<span id="cb56-22"><a href="#cb56-22" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb56-23"><a href="#cb56-23" aria-hidden="true" tabindex="-1"></a>        ax <span class="op">=</span> fig.add_subplot(gs[<span class="dv">0</span>, <span class="bu">int</span>(idx<span class="op">/</span><span class="dv">3</span>)])</span>
<span id="cb56-24"><a href="#cb56-24" aria-hidden="true" tabindex="-1"></a>        ax.plot(x, true, label <span class="op">=</span> <span class="st">'True'</span>)</span>
<span id="cb56-25"><a href="#cb56-25" aria-hidden="true" tabindex="-1"></a>        ax.plot(x, pred, label <span class="op">=</span> <span class="st">'Predicted'</span>)        </span>
<span id="cb56-26"><a href="#cb56-26" aria-hidden="true" tabindex="-1"></a>        plt.setp(ax, yticks <span class="op">=</span> [])<span class="op">;</span></span>
<span id="cb56-27"><a href="#cb56-27" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb56-28"><a href="#cb56-28" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb56-29"><a href="#cb56-29" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> idx <span class="op">==</span> <span class="dv">0</span>:</span>
<span id="cb56-30"><a href="#cb56-30" aria-hidden="true" tabindex="-1"></a>        ax.legend()</span>
<span id="cb56-31"><a href="#cb56-31" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb56-32"><a href="#cb56-32" aria-hidden="true" tabindex="-1"></a>ax_kl <span class="op">=</span> fig.add_subplot(gs[<span class="dv">1</span>, :])</span>
<span id="cb56-33"><a href="#cb56-33" aria-hidden="true" tabindex="-1"></a>ax_kl.plot(KL, <span class="st">'-o'</span>)</span>
<span id="cb56-34"><a href="#cb56-34" aria-hidden="true" tabindex="-1"></a>plt.setp(ax_kl, ylabel <span class="op">=</span> <span class="st">'MAE'</span>)</span>
<span id="cb56-35"><a href="#cb56-35" aria-hidden="true" tabindex="-1"></a>ax_kl.grid()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="utils_challenge_files/figure-html/cell-45-output-1.png" class="img-fluid"></p>
</div>
</div>
</section>
<section id="calculate-ensemble-metric" class="level3">
<h3 class="anchored" data-anchor-id="calculate-ensemble-metric">Calculate ensemble metric</h3>
<hr>
<p><a href="https://github.com/gorka.munoz/andi_datasets/blob/master/andi_datasets/utils_challenge.py#L1031" target="_blank" style="float:right; font-size:smaller">source</a></p>
</section>
<section id="error_ensemble_dataset" class="level3">
<h3 class="anchored" data-anchor-id="error_ensemble_dataset">error_Ensemble_dataset</h3>
<blockquote class="blockquote">
<pre><code> error_Ensemble_dataset (true_data, pred_data, return_distributions=False)</code></pre>
</blockquote>
<p>Calculates the ensemble metrics for the ANDI 2022 challenge. The input are matrices of shape:</p>
<table class="table">
<thead>
<tr class="header">
<th style="text-align: center;">col1 (state 1)</th>
<th style="text-align: center;">col2 (state 2)</th>
<th style="text-align: center;">col3 (state 3)</th>
<th style="text-align: center;">…</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: center;"><span class="math inline">\(\mu_a^1\)</span></td>
<td style="text-align: center;"><span class="math inline">\(\mu_a^2\)</span></td>
<td style="text-align: center;"><span class="math inline">\(\mu_a^3\)</span></td>
<td style="text-align: center;">…</td>
</tr>
<tr class="even">
<td style="text-align: center;"><span class="math inline">\(\sigma_a^1\)</span></td>
<td style="text-align: center;"><span class="math inline">\(\sigma_a^2\)</span></td>
<td style="text-align: center;"><span class="math inline">\(\sigma_a^3\)</span></td>
<td style="text-align: center;">…</td>
</tr>
<tr class="odd">
<td style="text-align: center;"><span class="math inline">\(\mu_D^1\)</span></td>
<td style="text-align: center;"><span class="math inline">\(\mu_D^2\)</span></td>
<td style="text-align: center;"><span class="math inline">\(\mu_D^3\)</span></td>
<td style="text-align: center;">…</td>
</tr>
<tr class="even">
<td style="text-align: center;"><span class="math inline">\(\sigma_D^1\)</span></td>
<td style="text-align: center;"><span class="math inline">\(\sigma_D^2\)</span></td>
<td style="text-align: center;"><span class="math inline">\(\sigma_D^3\)</span></td>
<td style="text-align: center;">…</td>
</tr>
<tr class="odd">
<td style="text-align: center;"><span class="math inline">\(N_1\)</span></td>
<td style="text-align: center;"><span class="math inline">\(N_2\)</span></td>
<td style="text-align: center;"><span class="math inline">\(N_3\)</span></td>
<td style="text-align: center;">…</td>
</tr>
</tbody>
</table>
<table class="table">
<colgroup>
<col style="width: 6%">
<col style="width: 25%">
<col style="width: 34%">
<col style="width: 34%">
</colgroup>
<thead>
<tr class="header">
<th></th>
<th><strong>Type</strong></th>
<th><strong>Default</strong></th>
<th><strong>Details</strong></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>true_data</td>
<td>array</td>
<td></td>
<td>Matrix containing the groundtruth data.</td>
</tr>
<tr class="even">
<td>pred_data</td>
<td>array</td>
<td></td>
<td>Matrix containing the predicted data.</td>
</tr>
<tr class="odd">
<td>return_distributions</td>
<td>bool</td>
<td>False</td>
<td>If True, the function also outputs the generated distributions.</td>
</tr>
<tr class="even">
<td><strong>Returns</strong></td>
<td><strong>tuple</strong></td>
<td></td>
<td><strong>- distance_alpha: distance between anomalous exponents<br>- distance_D: distance between diffusion coefficients<br>- dists (if asked): distributions of both groundtruth and predicted data. </strong></td>
</tr>
</tbody>
</table>
</section>
</section>
<section id="single-trajectory-metrics" class="level2">
<h2 class="anchored" data-anchor-id="single-trajectory-metrics">Single trajectory metrics</h2>
<p>The participants will have to output predictions in a .txt file were each line corresponds to the predictions of a trajectory. The latter have to be ordered as:</p>
<p>0, d<span class="math inline">\(_0\)</span>, a<span class="math inline">\(_0\)</span>, s<span class="math inline">\(_0\)</span>, t<span class="math inline">\(_1\)</span>, d<span class="math inline">\(_1\)</span>, a<span class="math inline">\(_1\)</span>, s<span class="math inline">\(_1\)</span>, t<span class="math inline">\(_2\)</span>, d<span class="math inline">\(_2\)</span>, a<span class="math inline">\(_2\)</span>, s<span class="math inline">\(_2\)</span>, …. t<span class="math inline">\(_n\)</span>, d<span class="math inline">\(_n\)</span>, a<span class="math inline">\(_n\)</span>, s<span class="math inline">\(_n\)</span>,<span class="math inline">\(T\)</span></p>
<p>where the first number corresponds to the trajectory index, then d<span class="math inline">\(_i\)</span>, a<span class="math inline">\(_i\)</span>, s<span class="math inline">\(_i\)</span> correspond to the diffusion coefficient, anomalous exponent and diffusive state of the <span class="math inline">\(i\)</span>-th segment. For the latter, we have the following code: - 0: immobile - 1: confined - 2: brownian - 3: anomalous</p>
<p>Last, t<span class="math inline">\(_j\)</span> corresponds to the <span class="math inline">\(j\)</span>-th changepoints. The last changepoint <span class="math inline">\(T\)</span> corresponds to the length of the trajectory. Each prediction <strong>must</strong> contain <span class="math inline">\(C\)</span> changepoints and <span class="math inline">\(C\)</span> segments property values. If this is not fulfilled, the whole trajectory is considered as mispredicted.</p>
<p>The .txt file will be first inspected. The data will then be collected into a dataframe</p>
<hr>
<p><a href="https://github.com/gorka.munoz/andi_datasets/blob/master/andi_datasets/utils_challenge.py#L1090" target="_blank" style="float:right; font-size:smaller">source</a></p>
<section id="check_prediction_length" class="level3">
<h3 class="anchored" data-anchor-id="check_prediction_length">check_prediction_length</h3>
<blockquote class="blockquote">
<pre><code> check_prediction_length (pred)</code></pre>
</blockquote>
<p>Given a trajectory segments prediction, checks whether it has C changepoints and C+1 segments properties values. As it must also contain the index of the trajectory, this is summarized by being multiple of 4. In some cases, the user needs to also predict the final point of the trajectory. In this case, we will have a residu of 1.</p>
<hr>
<p><a href="https://github.com/gorka.munoz/andi_datasets/blob/master/andi_datasets/utils_challenge.py#L1103" target="_blank" style="float:right; font-size:smaller">source</a></p>
</section>
<section id="separate_prediction_values" class="level3">
<h3 class="anchored" data-anchor-id="separate_prediction_values">separate_prediction_values</h3>
<blockquote class="blockquote">
<pre><code> separate_prediction_values (pred)</code></pre>
</blockquote>
<p>Given a prediction over trjaectory segments, extracts the predictions for each segment property as well as the changepoint values.</p>
<hr>
<p><a href="https://github.com/gorka.munoz/andi_datasets/blob/master/andi_datasets/utils_challenge.py#L1115" target="_blank" style="float:right; font-size:smaller">source</a></p>
</section>
<section id="load_file_to_df" class="level3">
<h3 class="anchored" data-anchor-id="load_file_to_df">load_file_to_df</h3>
<blockquote class="blockquote">
<pre><code> load_file_to_df (path_file, columns=['traj_idx', 'Ds', 'alphas',
                  'states', 'changepoints'])</code></pre>
</blockquote>
<p>Given the path of a .txt file, extract the segmentation predictions based on the rules of the ANDI Challenge 2022</p>
<p>Saving fake data for test</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb61"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a>file_gt, file_p <span class="op">=</span> [], []</span>
<span id="cb61-2"><a href="#cb61-2" aria-hidden="true" tabindex="-1"></a>T <span class="op">=</span> <span class="dv">200</span><span class="op">;</span> ngts <span class="op">=</span> <span class="dv">10</span><span class="op">;</span></span>
<span id="cb61-3"><a href="#cb61-3" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> traj <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">100</span>):</span>
<span id="cb61-4"><a href="#cb61-4" aria-hidden="true" tabindex="-1"></a>    GT_cp <span class="op">=</span> np.sort(np.random.choice(np.arange(<span class="dv">1</span>,T), ngts, replace <span class="op">=</span> <span class="va">False</span>))</span>
<span id="cb61-5"><a href="#cb61-5" aria-hidden="true" tabindex="-1"></a>    preds_cp <span class="op">=</span> np.sort(np.random.choice(np.arange(<span class="dv">1</span>,T<span class="op">+</span><span class="dv">50</span>), ngts, replace <span class="op">=</span> <span class="va">False</span>)) </span>
<span id="cb61-6"><a href="#cb61-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-7"><a href="#cb61-7" aria-hidden="true" tabindex="-1"></a>    GT_alpha <span class="op">=</span> np.random.rand(GT_cp.shape[<span class="dv">0</span>]<span class="op">+</span><span class="dv">1</span>)</span>
<span id="cb61-8"><a href="#cb61-8" aria-hidden="true" tabindex="-1"></a>    preds_alpha <span class="op">=</span> GT_alpha<span class="co"># + 0.1 #np.random.randn(preds_cp.shape[0]+1)*0.1</span></span>
<span id="cb61-9"><a href="#cb61-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-10"><a href="#cb61-10" aria-hidden="true" tabindex="-1"></a>    GT_D <span class="op">=</span> np.<span class="bu">abs</span>(np.random.randn(GT_cp.shape[<span class="dv">0</span>]<span class="op">+</span><span class="dv">1</span>)<span class="op">*</span><span class="dv">10</span>)</span>
<span id="cb61-11"><a href="#cb61-11" aria-hidden="true" tabindex="-1"></a>    preds_D <span class="op">=</span> GT_D <span class="op">+</span> <span class="fl">1.5</span> <span class="co">#np.abs(np.random.randn(preds_cp.shape[0]+1))*1.6</span></span>
<span id="cb61-12"><a href="#cb61-12" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb61-13"><a href="#cb61-13" aria-hidden="true" tabindex="-1"></a>    GT_state <span class="op">=</span> np.random.randint(<span class="dv">0</span>, high <span class="op">=</span> <span class="dv">5</span>, size <span class="op">=</span> GT_cp.shape[<span class="dv">0</span>]<span class="op">+</span><span class="dv">1</span>)</span>
<span id="cb61-14"><a href="#cb61-14" aria-hidden="true" tabindex="-1"></a>    preds_state <span class="op">=</span> np.random.randint(<span class="dv">0</span>, high <span class="op">=</span> <span class="dv">5</span>, size <span class="op">=</span> preds_cp.shape[<span class="dv">0</span>]<span class="op">+</span><span class="dv">1</span>)</span>
<span id="cb61-15"><a href="#cb61-15" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb61-16"><a href="#cb61-16" aria-hidden="true" tabindex="-1"></a>    list_gt, list_p <span class="op">=</span> [traj, GT_D[<span class="dv">0</span>], GT_alpha[<span class="dv">0</span>], GT_state[<span class="dv">0</span>]], [traj, preds_D[<span class="dv">0</span>], preds_alpha[<span class="dv">0</span>], preds_state[<span class="dv">0</span>]]</span>
<span id="cb61-17"><a href="#cb61-17" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> gtc, gta, gtd, gts, pc, pa, pd, ps <span class="kw">in</span> <span class="bu">zip</span>(GT_cp, GT_alpha[<span class="dv">1</span>:], GT_D[<span class="dv">1</span>:], GT_state[<span class="dv">1</span>:], preds_cp, preds_alpha[<span class="dv">1</span>:], preds_D[<span class="dv">1</span>:], preds_state[<span class="dv">1</span>:]):</span>
<span id="cb61-18"><a href="#cb61-18" aria-hidden="true" tabindex="-1"></a>        list_gt <span class="op">+=</span> [gtc, gtd, gta, gts]</span>
<span id="cb61-19"><a href="#cb61-19" aria-hidden="true" tabindex="-1"></a>        list_p <span class="op">+=</span> [pc, pd, pa, ps]</span>
<span id="cb61-20"><a href="#cb61-20" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb61-21"><a href="#cb61-21" aria-hidden="true" tabindex="-1"></a>    file_gt.append(list_gt)</span>
<span id="cb61-22"><a href="#cb61-22" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> traj <span class="op">!=</span> <span class="dv">6</span>:</span>
<span id="cb61-23"><a href="#cb61-23" aria-hidden="true" tabindex="-1"></a>        file_p.append(list_p)</span>
<span id="cb61-24"><a href="#cb61-24" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb61-25"><a href="#cb61-25" aria-hidden="true" tabindex="-1"></a>pred_path, true_path <span class="op">=</span> <span class="st">'pred_test.txt'</span>, <span class="st">'true_test.txt'</span></span>
<span id="cb61-26"><a href="#cb61-26" aria-hidden="true" tabindex="-1"></a>np.savetxt(true_path, file_gt, delimiter<span class="op">=</span><span class="st">','</span>)</span>
<span id="cb61-27"><a href="#cb61-27" aria-hidden="true" tabindex="-1"></a>np.savetxt(pred_path, file_p, delimiter<span class="op">=</span><span class="st">','</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Recovering the data</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb62"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb62-1"><a href="#cb62-1" aria-hidden="true" tabindex="-1"></a>pred_path, true_path <span class="op">=</span> <span class="st">'pred_test.txt'</span>, <span class="st">'true_test.txt'</span></span>
<span id="cb62-2"><a href="#cb62-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-3"><a href="#cb62-3" aria-hidden="true" tabindex="-1"></a>df_pred <span class="op">=</span> load_file_to_df(pred_path)</span>
<span id="cb62-4"><a href="#cb62-4" aria-hidden="true" tabindex="-1"></a>df_true <span class="op">=</span> load_file_to_df(true_path)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<hr>
<p><a href="https://github.com/gorka.munoz/andi_datasets/blob/master/andi_datasets/utils_challenge.py#L1158" target="_blank" style="float:right; font-size:smaller">source</a></p>
</section>
<section id="error_singletraj_dataset" class="level3">
<h3 class="anchored" data-anchor-id="error_singletraj_dataset">error_SingleTraj_dataset</h3>
<blockquote class="blockquote">
<pre><code> error_SingleTraj_dataset (df_pred, df_true, threshold_error_alpha=2,
                           max_val_alpha=2, min_val_alpha=0,
                           threshold_error_D=100000.0,
                           max_val_D=1000000.0, min_val_D=1e-06,
                           threshold_error_s=-1, threshold_cp=10,
                           prints=True, disable_tqdm=False)</code></pre>
</blockquote>
<p>Given two dataframes, corresponding to the predictions and true labels of a set of trajectories from the ANDI challenge 2022, calculates the corresponding metrics Columns must be for both (no order needed): traj_idx | alphas | Ds | changepoints | states df_true must also contain a column ‘T’.</p>
<table class="table">
<colgroup>
<col style="width: 6%">
<col style="width: 25%">
<col style="width: 34%">
<col style="width: 34%">
</colgroup>
<thead>
<tr class="header">
<th></th>
<th><strong>Type</strong></th>
<th><strong>Default</strong></th>
<th><strong>Details</strong></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>df_pred</td>
<td>dataframe</td>
<td></td>
<td>Predictions</td>
</tr>
<tr class="even">
<td>df_true</td>
<td>dataframe</td>
<td></td>
<td>Groundtruth</td>
</tr>
<tr class="odd">
<td>threshold_error_alpha</td>
<td>int</td>
<td>2</td>
<td>(same for D, s, cp) Maximum possible error allowed. If bigger, it is substituted by this error.</td>
</tr>
<tr class="even">
<td>max_val_alpha</td>
<td>int</td>
<td>2</td>
<td>(same for D, s, cp) Maximum value of the parameter.</td>
</tr>
<tr class="odd">
<td>min_val_alpha</td>
<td>int</td>
<td>0</td>
<td>(same for D, s, cp) Minimum value of the parameter.</td>
</tr>
<tr class="even">
<td>threshold_error_D</td>
<td>float</td>
<td>100000.0</td>
<td></td>
</tr>
<tr class="odd">
<td>max_val_D</td>
<td>float</td>
<td>1000000.0</td>
<td></td>
</tr>
<tr class="even">
<td>min_val_D</td>
<td>float</td>
<td>1e-06</td>
<td></td>
</tr>
<tr class="odd">
<td>threshold_error_s</td>
<td>int</td>
<td>-1</td>
<td></td>
</tr>
<tr class="even">
<td>threshold_cp</td>
<td>int</td>
<td>10</td>
<td></td>
</tr>
<tr class="odd">
<td>prints</td>
<td>bool</td>
<td>True</td>
<td></td>
</tr>
<tr class="even">
<td>disable_tqdm</td>
<td>bool</td>
<td>False</td>
<td>If True, disables the progress bar.</td>
</tr>
<tr class="odd">
<td><strong>Returns</strong></td>
<td><strong>tuple</strong></td>
<td></td>
<td><strong>- rmse_CP: root mean squared error change points<br>- JI: Jaccard index change points<br>- error_alpha: mean absolute error anomalous exponents<br>- error_D: mean square log error diffusion coefficients<br>- error_s: Jaccar index diffusive states</strong></td>
</tr>
</tbody>
</table>
<section id="test" class="level4">
<h4 class="anchored" data-anchor-id="test">Test</h4>
<p><strong>Two datasets with same number of trajs</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb64"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb64-1"><a href="#cb64-1" aria-hidden="true" tabindex="-1"></a>trajs, labels <span class="op">=</span> models_phenom().immobile_traps(T <span class="op">=</span> <span class="dv">200</span>, N <span class="op">=</span> <span class="dv">250</span>, alphas<span class="op">=</span><span class="fl">0.5</span>, Ds <span class="op">=</span> <span class="dv">1</span>, L <span class="op">=</span> <span class="dv">20</span>, Nt <span class="op">=</span> <span class="dv">100</span>, Pb <span class="op">=</span> <span class="dv">1</span>, Pu <span class="op">=</span> <span class="fl">0.5</span>)</span>
<span id="cb64-2"><a href="#cb64-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-3"><a href="#cb64-3" aria-hidden="true" tabindex="-1"></a>trajs <span class="op">=</span> trajs.transpose((<span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">2</span>)).copy()</span>
<span id="cb64-4"><a href="#cb64-4" aria-hidden="true" tabindex="-1"></a>labels <span class="op">=</span> labels.transpose(<span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">2</span>)</span>
<span id="cb64-5"><a href="#cb64-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-6"><a href="#cb64-6" aria-hidden="true" tabindex="-1"></a>df_in, df_trues <span class="op">=</span> array_to_df(trajs, labels)</span>
<span id="cb64-7"><a href="#cb64-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-8"><a href="#cb64-8" aria-hidden="true" tabindex="-1"></a>trajs, labels <span class="op">=</span> models_phenom().immobile_traps(T <span class="op">=</span> <span class="dv">200</span>, N <span class="op">=</span> <span class="dv">250</span>, alphas<span class="op">=</span>[<span class="fl">0.5</span>, <span class="fl">0.1</span>], Ds <span class="op">=</span> <span class="dv">1</span>, L <span class="op">=</span> <span class="dv">20</span>, Nt <span class="op">=</span> <span class="dv">100</span>, Pb <span class="op">=</span> <span class="dv">1</span>, Pu <span class="op">=</span> <span class="fl">0.5</span>)</span>
<span id="cb64-9"><a href="#cb64-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-10"><a href="#cb64-10" aria-hidden="true" tabindex="-1"></a>trajs <span class="op">=</span> trajs.transpose((<span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">2</span>)).copy()</span>
<span id="cb64-11"><a href="#cb64-11" aria-hidden="true" tabindex="-1"></a>labels <span class="op">=</span> labels.transpose(<span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">2</span>)</span>
<span id="cb64-12"><a href="#cb64-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-13"><a href="#cb64-13" aria-hidden="true" tabindex="-1"></a>df_in, df_preds <span class="op">=</span> array_to_df(trajs, labels)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"8ef46efe5638454c870655fc1a8cb419","version_major":2,"version_minor":0}
</script>
</div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"8dfca3309a874824a204bfaf2f22f667","version_major":2,"version_minor":0}
</script>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb65"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb65-1"><a href="#cb65-1" aria-hidden="true" tabindex="-1"></a>error_SingleTraj_dataset(df_preds, df_trues, prints <span class="op">=</span> <span class="va">True</span>, disable_tqdm<span class="op">=</span><span class="va">True</span>)<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Summary of metrics assesments:

Changepoint Metrics 
RMSE: 4.222 
Jaccard Index: 0.402 

Diffusion property metrics 
Metric anomalous exponent: 0.3187475166785641 
Metric diffusion coefficient: 0.2407373554580533 
Metric diffusive state: 0.49893673577884107</code></pre>
</div>
</div>
<p><strong>Two datasets with different number of trajectories</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb67"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb67-1"><a href="#cb67-1" aria-hidden="true" tabindex="-1"></a>trajs, labels <span class="op">=</span> models_phenom().immobile_traps(T <span class="op">=</span> <span class="dv">200</span>, N <span class="op">=</span> <span class="dv">350</span>, alphas<span class="op">=</span>[<span class="fl">0.5</span>,<span class="fl">0.01</span>], Ds <span class="op">=</span> [<span class="fl">1.</span>, <span class="fl">0.1</span>], L <span class="op">=</span> <span class="dv">20</span>, Nt <span class="op">=</span> <span class="dv">100</span>, Pb <span class="op">=</span> <span class="dv">1</span>, Pu <span class="op">=</span> <span class="fl">0.5</span>)</span>
<span id="cb67-2"><a href="#cb67-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb67-3"><a href="#cb67-3" aria-hidden="true" tabindex="-1"></a>trajs <span class="op">=</span> trajs.transpose((<span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">2</span>)).copy()</span>
<span id="cb67-4"><a href="#cb67-4" aria-hidden="true" tabindex="-1"></a>labels <span class="op">=</span> labels.transpose(<span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">2</span>)</span>
<span id="cb67-5"><a href="#cb67-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb67-6"><a href="#cb67-6" aria-hidden="true" tabindex="-1"></a>df_in, df_trues <span class="op">=</span> array_to_df(trajs, labels, label_values<span class="op">=</span>[<span class="fl">0.5</span>, <span class="dv">1</span>], diff_states<span class="op">=</span>[<span class="dv">3</span>, <span class="dv">2</span>])</span>
<span id="cb67-7"><a href="#cb67-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb67-8"><a href="#cb67-8" aria-hidden="true" tabindex="-1"></a>trajs, labels <span class="op">=</span> models_phenom().immobile_traps(T <span class="op">=</span> <span class="dv">200</span>, N <span class="op">=</span> <span class="dv">250</span>, alphas<span class="op">=</span>[<span class="fl">0.5</span>, <span class="fl">0.1</span>], Ds <span class="op">=</span> <span class="dv">1</span>, L <span class="op">=</span> <span class="dv">20</span>, Nt <span class="op">=</span> <span class="dv">100</span>, Pb <span class="op">=</span> <span class="dv">1</span>, Pu <span class="op">=</span> <span class="fl">0.5</span>)</span>
<span id="cb67-9"><a href="#cb67-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb67-10"><a href="#cb67-10" aria-hidden="true" tabindex="-1"></a>trajs <span class="op">=</span> trajs.transpose((<span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">2</span>)).copy()</span>
<span id="cb67-11"><a href="#cb67-11" aria-hidden="true" tabindex="-1"></a>labels <span class="op">=</span> labels.transpose(<span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">2</span>)</span>
<span id="cb67-12"><a href="#cb67-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb67-13"><a href="#cb67-13" aria-hidden="true" tabindex="-1"></a>df_in, df_preds <span class="op">=</span> array_to_df(trajs, labels, label_values<span class="op">=</span>[<span class="fl">0.5</span>, <span class="dv">1</span>], diff_states<span class="op">=</span>[<span class="dv">3</span>, <span class="dv">2</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"722f2ef9f7d54fd3a6f961ac438180cb","version_major":2,"version_minor":0}
</script>
</div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"382ad7f1f9404a3b8280ad939e0971eb","version_major":2,"version_minor":0}
</script>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb68"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb68-1"><a href="#cb68-1" aria-hidden="true" tabindex="-1"></a>error_SingleTraj_dataset(df_preds, df_trues, prints <span class="op">=</span> <span class="va">True</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"32b2c930add14fe0a78d340fc2095149","version_major":2,"version_minor":0}
</script>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Summary of metrics assesments:

100 missing trajectory/ies. 

Changepoint Metrics 
RMSE: 4.051 
Jaccard Index: 0.441 

Diffusion property metrics 
Metric anomalous exponent: 0.35483874584715985 
Metric diffusion coefficient: 3.1690909054732668 
Metric diffusive state: 0.4913685263947961</code></pre>
</div>
<div class="cell-output cell-output-display">
<pre><code>(4.050708208970335,
 0.4407643312101911,
 0.35483874584715985,
 3.1690909054732668,
 0.4913685263947961)</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb71"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb71-1"><a href="#cb71-1" aria-hidden="true" tabindex="-1"></a>trajs, labels <span class="op">=</span> models_phenom().immobile_traps(T <span class="op">=</span> <span class="dv">200</span>, N <span class="op">=</span> <span class="dv">5</span>, alphas<span class="op">=</span>[<span class="fl">0.5</span>,<span class="fl">0.01</span>], Ds <span class="op">=</span> [<span class="fl">1.</span>, <span class="fl">0.1</span>], L <span class="op">=</span> <span class="dv">20</span>, Nt <span class="op">=</span> <span class="dv">100</span>, Pb <span class="op">=</span> <span class="dv">1</span>, Pu <span class="op">=</span> <span class="fl">0.5</span>)</span>
<span id="cb71-2"><a href="#cb71-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-3"><a href="#cb71-3" aria-hidden="true" tabindex="-1"></a>trajs <span class="op">=</span> trajs.transpose((<span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">2</span>)).copy()</span>
<span id="cb71-4"><a href="#cb71-4" aria-hidden="true" tabindex="-1"></a>labels <span class="op">=</span> labels.transpose(<span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">2</span>)</span>
<span id="cb71-5"><a href="#cb71-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-6"><a href="#cb71-6" aria-hidden="true" tabindex="-1"></a>df_in, df_preds  <span class="op">=</span> array_to_df(trajs, labels, label_values<span class="op">=</span>[<span class="fl">0.5</span>, <span class="dv">1</span>], diff_states<span class="op">=</span>[<span class="dv">3</span>, <span class="dv">2</span>])</span>
<span id="cb71-7"><a href="#cb71-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-8"><a href="#cb71-8" aria-hidden="true" tabindex="-1"></a>trajs, labels <span class="op">=</span> models_phenom().multi_state(T <span class="op">=</span> <span class="dv">200</span>, N <span class="op">=</span> <span class="dv">7</span>, L <span class="op">=</span> <span class="dv">20</span>, M <span class="op">=</span> np.array([[<span class="fl">0.9</span>,<span class="fl">0.1</span>],[<span class="fl">0.9</span>,<span class="fl">0.1</span>]]))</span>
<span id="cb71-9"><a href="#cb71-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-10"><a href="#cb71-10" aria-hidden="true" tabindex="-1"></a>trajs <span class="op">=</span> trajs.transpose((<span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">2</span>)).copy()</span>
<span id="cb71-11"><a href="#cb71-11" aria-hidden="true" tabindex="-1"></a>labels <span class="op">=</span> labels.transpose(<span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">2</span>)</span>
<span id="cb71-12"><a href="#cb71-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-13"><a href="#cb71-13" aria-hidden="true" tabindex="-1"></a>df_in, df_trues  <span class="op">=</span> array_to_df(trajs, labels, label_values<span class="op">=</span>[<span class="fl">0.5</span>, <span class="dv">1</span>], diff_states<span class="op">=</span>[<span class="dv">3</span>, <span class="dv">2</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"e7158e67f9d74360a3dca327fbaf70ad","version_major":2,"version_minor":0}
</script>
</div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"047e0943b55341579c3ecbab3bd6aad5","version_major":2,"version_minor":0}
</script>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb72"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb72-1"><a href="#cb72-1" aria-hidden="true" tabindex="-1"></a>error_SingleTraj_dataset(df_preds, df_trues, prints <span class="op">=</span> <span class="va">True</span>)<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"00329cc314f149939b4c5971fbfb2ae9","version_major":2,"version_minor":0}
</script>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Summary of metrics assesments:

2 missing trajectory/ies. 

Changepoint Metrics 
RMSE: 2.903 
Jaccard Index: 0.188 

Diffusion property metrics 
Metric anomalous exponent: 0.8269399281523714 
Metric diffusion coefficient: 8.262443034681892 
Metric diffusive state: 0.41379310344827586</code></pre>
</div>
</div>
</section>
</section>
</section>
</section>
<section id="codalab-scoring-program" class="level1">
<h1>Codalab scoring program</h1>
<p>Here we prepare the program that will be uploaded to codalab in order to do the assesment of the participants predictions.</p>
<p><strong>File organization</strong></p>
<p>The files must have names: <code>Ti_ens_exp_XXX_fov_yyy.txt</code> and <code>Ti_st_exp_XXX_fov_yyy.txt</code>, where <code>i</code> refers to the track and can be 1 (video track) or 2 (trajectory track. <code>ens</code> refers to ensemble informations and <code>st</code> to single trajectory.</p>
<p><strong>Extra information</strong></p>
<p>We will have an extra reference file which gives the model of each experiment. This is also needed to avoid considering Single state in the averages of change point metrics.</p>
<hr>
<p><a href="https://github.com/gorka.munoz/andi_datasets/blob/master/andi_datasets/utils_challenge.py#L1308" target="_blank" style="float:right; font-size:smaller">source</a></p>
<section id="codalab_scoring" class="level3">
<h3 class="anchored" data-anchor-id="codalab_scoring">codalab_scoring</h3>
<blockquote class="blockquote">
<pre><code> codalab_scoring (input_dir, output_dir)</code></pre>
</blockquote>
<p>Given an input directoy where predictions and groundtruths for the ANDI 2 challenge can be found, calculates metrics and outputs the results in a file in the given output directory. This code is prepared to be run in Codalab.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb75"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb75-1"><a href="#cb75-1" aria-hidden="true" tabindex="-1"></a>input_dir <span class="op">=</span> <span class="st">'C:/Users/Gorka/github/ANDI_datasets/testing/codalab_data'</span></span>
<span id="cb75-2"><a href="#cb75-2" aria-hidden="true" tabindex="-1"></a>output_dir <span class="op">=</span> <span class="st">'C:/Users/Gorka/github/ANDI_datasets/testing/codalab_data'</span></span>
<span id="cb75-3"><a href="#cb75-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-4"><a href="#cb75-4" aria-hidden="true" tabindex="-1"></a>codalab_scoring(input_dir<span class="op">=</span>input_dir, output_dir<span class="op">=</span>output_dir)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"e980f849bcdf4c45b745663d6ddb0ebf","version_major":2,"version_minor":0}
</script>
</div>
</div>


</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    setTimeout(function() {
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const cites = ref.parentNode.getAttribute('data-cites').split(' ');
    tippyHover(ref, function() {
      var popup = window.document.createElement('div');
      cites.forEach(function(cite) {
        var citeDiv = window.document.createElement('div');
        citeDiv.classList.add('hanging-indent');
        citeDiv.classList.add('csl-entry');
        var biblioDiv = window.document.getElementById('ref-' + cite);
        if (biblioDiv) {
          citeDiv.innerHTML = biblioDiv.innerHTML;
        }
        popup.appendChild(citeDiv);
      });
      return popup.innerHTML;
    });
  }
});
</script>
</div> <!-- /content -->



</body></html>